function FABridge(e,n){return this.target=e,this.remoteTypeCache={},this.remoteInstanceCache={},this.remoteFunctionCache={},this.localFunctionCache={},this.bridgeID=FABridge.nextBridgeID++,this.name=n,this.nextLocalFuncID=0,FABridge.instances[this.name]=this,FABridge.idMap[this.bridgeID]=this,this}function instanceFactory(e){return this.fb_instance_id=e,this}function FABridge__invokeJSFunction(e){var n=e[0],t=e.concat();t.shift();var l=FABridge.extractBridgeFromID(n);return l.invokeLocalFunction(n,t)}function FABridge__bridgeInitialized(e){var n=document.getElementsByTagName("object"),t=n.length,l=[];if(t>0)for(var r=0;t>r;r++)"undefined"!=typeof n[r].SetVariable&&(l[l.length]=n[r]);var i=document.getElementsByTagName("embed"),o=i.length,s=[];if(o>0)for(var u=0;o>u;u++)"undefined"!=typeof i[u].SetVariable&&(s[s.length]=i[u]);var a=l.length,c=s.length,h="bridgeName="+e;if(1==a&&!c||1==a&&1==c)FABridge.attachBridge(l[0],e);else if(1!=c||a){var d=!1;if(a>1)for(var f=0;a>f;f++){for(var p=l[f].childNodes,g=0;g<p.length;g++){var v=p[g];if(1==v.nodeType&&"param"==v.tagName.toLowerCase()&&"flashvars"==v.name.toLowerCase()&&v.value.indexOf(h)>=0){FABridge.attachBridge(l[f],e),d=!0;break}}if(d)break}if(!d&&c>1)for(var m=0;c>m;m++){var _=s[m].attributes.getNamedItem("flashVars").nodeValue;if(_.indexOf(h)>=0){FABridge.attachBridge(s[m],e);break}}}else FABridge.attachBridge(s[0],e);return!0}var BrowserDetect={init:function(){this.browser=this.searchString(this.dataBrowser)||"An unknown browser",this.version=this.searchVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.fullVersion=this.searchFullVersion(navigator.userAgent)||this.searchVersion(navigator.appVersion)||"an unknown version",this.OS=this.searchString(this.dataOS)||"an unknown OS",this.fullOS=this.searchOSVersion()||void 0},searchString:function(e){for(var n=0;n<e.length;n++){var t=e[n].string,l=e[n].prop;if(this.versionSearchString=e[n].versionSearch||e[n].identity,t){if(-1!=t.indexOf(e[n].subString))return e[n].identity}else if(l)return e[n].identity}},searchOSVersion:function(){var e,n,t,l=navigator.userAgent.indexOf(this.OS);return n=t=navigator.userAgent.indexOf(")",l),"Windows"==this.OS&&(e=navigator.userAgent.indexOf(";",l),e>0&&(n=t>e?e:t)),navigator.userAgent.substring(l,n)},searchVersion:function(e){var n=e.indexOf(this.versionSearchString);return-1!=n?parseFloat(e.substring(n+this.versionSearchString.length+1)):void 0},searchFullVersion:function(e){var n=e.indexOf(this.versionSearchString);if(-1!=n){var t=e.substring(n+this.versionSearchString.length+1),l=t.indexOf(" ");if(0>=l)return t;var r=t.substring(0,l);return r}},dataBrowser:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera",versionSearch:"Version"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],dataOS:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}],isWebrtcSupported:function(){var e=window.PeerConnection||window.webkitPeerConnection00||window.webkitRTCPeerConnection||window.mozRTCPeerConnection;return!!(e&&"Chrome"==this.browser&&this.version>=25)}};BrowserDetect.init();var CryptoJS=CryptoJS||function(e,n){var t={},l=t.lib={},r=l.Base=function(){function e(){}return{extend:function(n){e.prototype=this;var t=new e;return n&&t.mixIn(n),t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var n in e)e.hasOwnProperty(n)&&(this[n]=e[n]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.$super.extend(this)}}}(),i=l.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=t!=n?t:4*e.length},toString:function(e){return(e||s).stringify(this)},concat:function(e){var n=this.words,t=e.words,l=this.sigBytes,e=e.sigBytes;if(this.clamp(),l%4)for(var r=0;e>r;r++)n[l+r>>>2]|=(t[r>>>2]>>>24-8*(r%4)&255)<<24-8*((l+r)%4);else if(65535<t.length)for(r=0;e>r;r+=4)n[l+r>>>2]=t[r>>>2];else n.push.apply(n,t);return this.sigBytes+=e,this},clamp:function(){var n=this.words,t=this.sigBytes;n[t>>>2]&=4294967295<<32-8*(t%4),n.length=e.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(n){for(var t=[],l=0;n>l;l+=4)t.push(4294967296*e.random()|0);return i.create(t,n)}}),o=t.enc={},s=o.Hex={stringify:function(e){for(var n=e.words,e=e.sigBytes,t=[],l=0;e>l;l++){var r=n[l>>>2]>>>24-8*(l%4)&255;t.push((r>>>4).toString(16)),t.push((15&r).toString(16))}return t.join("")},parse:function(e){for(var n=e.length,t=[],l=0;n>l;l+=2)t[l>>>3]|=parseInt(e.substr(l,2),16)<<24-4*(l%8);return i.create(t,n/2)}},u=o.Latin1={stringify:function(e){for(var n=e.words,e=e.sigBytes,t=[],l=0;e>l;l++)t.push(String.fromCharCode(n[l>>>2]>>>24-8*(l%4)&255));return t.join("")},parse:function(e){for(var n=e.length,t=[],l=0;n>l;l++)t[l>>>2]|=(255&e.charCodeAt(l))<<24-8*(l%4);return i.create(t,n)}},a=o.Utf8={stringify:function(e){try{return decodeURIComponent(escape(u.stringify(e)))}catch(n){throw Error("Malformed UTF-8 data")}},parse:function(e){return u.parse(unescape(encodeURIComponent(e)))}},c=l.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=i.create(),this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=a.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(n){var t=this._data,l=t.words,r=t.sigBytes,o=this.blockSize,s=r/(4*o),s=n?e.ceil(s):e.max((0|s)-this._minBufferSize,0),n=s*o,r=e.min(4*n,r);if(n){for(var u=0;n>u;u+=o)this._doProcessBlock(l,u);u=l.splice(0,n),t.sigBytes-=r}return i.create(u,r)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});l.Hasher=c.extend({init:function(){this.reset()},reset:function(){c.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize(),this._hash},clone:function(){var e=c.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:16,_createHelper:function(e){return function(n,t){return e.create(t).finalize(n)}},_createHmacHelper:function(e){return function(n,t){return h.HMAC.create(e,t).finalize(n)}}});var h=t.algo={};return t}(Math);!function(e){function n(e,n,t,l,r,i,o){return e=e+(n&t|~n&l)+r+o,(e<<i|e>>>32-i)+n}function t(e,n,t,l,r,i,o){return e=e+(n&l|t&~l)+r+o,(e<<i|e>>>32-i)+n}function l(e,n,t,l,r,i,o){return e=e+(n^t^l)+r+o,(e<<i|e>>>32-i)+n}function r(e,n,t,l,r,i,o){return e=e+(t^(n|~l))+r+o,(e<<i|e>>>32-i)+n}var i=CryptoJS,o=i.lib,s=o.WordArray,o=o.Hasher,u=i.algo,a=[];!function(){for(var n=0;64>n;n++)a[n]=4294967296*e.abs(e.sin(n+1))|0}(),u=u.MD5=o.extend({_doReset:function(){this._hash=s.create([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,i){for(var o=0;16>o;o++){var s=i+o,u=e[s];e[s]=16711935&(u<<8|u>>>24)|4278255360&(u<<24|u>>>8)}for(var s=this._hash.words,u=s[0],c=s[1],h=s[2],d=s[3],o=0;64>o;o+=4)16>o?(u=n(u,c,h,d,e[i+o],7,a[o]),d=n(d,u,c,h,e[i+o+1],12,a[o+1]),h=n(h,d,u,c,e[i+o+2],17,a[o+2]),c=n(c,h,d,u,e[i+o+3],22,a[o+3])):32>o?(u=t(u,c,h,d,e[i+(o+1)%16],5,a[o]),d=t(d,u,c,h,e[i+(o+6)%16],9,a[o+1]),h=t(h,d,u,c,e[i+(o+11)%16],14,a[o+2]),c=t(c,h,d,u,e[i+o%16],20,a[o+3])):48>o?(u=l(u,c,h,d,e[i+(3*o+5)%16],4,a[o]),d=l(d,u,c,h,e[i+(3*o+8)%16],11,a[o+1]),h=l(h,d,u,c,e[i+(3*o+11)%16],16,a[o+2]),c=l(c,h,d,u,e[i+(3*o+14)%16],23,a[o+3])):(u=r(u,c,h,d,e[i+3*o%16],6,a[o]),d=r(d,u,c,h,e[i+(3*o+7)%16],10,a[o+1]),h=r(h,d,u,c,e[i+(3*o+14)%16],15,a[o+2]),c=r(c,h,d,u,e[i+(3*o+5)%16],21,a[o+3]));s[0]=s[0]+u|0,s[1]=s[1]+c|0,s[2]=s[2]+h|0,s[3]=s[3]+d|0},_doFinalize:function(){var e=this._data,n=e.words,t=8*this._nDataBytes,l=8*e.sigBytes;for(n[l>>>5]|=128<<24-l%32,n[(l+64>>>9<<4)+14]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8),e.sigBytes=4*(n.length+1),this._process(),e=this._hash.words,n=0;4>n;n++)t=e[n],e[n]=16711935&(t<<8|t>>>24)|4278255360&(t<<24|t>>>8)}}),i.MD5=o._createHelper(u),i.HmacMD5=o._createHmacHelper(u)}(Math),function(){if(!BrowserDetect.isWebrtcSupported()){var e;e=function(){function e(e){var t=n.getFlashPlayerVersion();return Plivo.logDebug("- Flash Version : "+t.major+"."+t.minor+"."+t.release),0===t.major?void Plivo.onFlashNotInstalled():(Plivo.logDebug("Initializing flash engine"),h=e,void b(e))}function t(){B("_onInit")}function l(){Plivo.logDebug("_onDisconnected"),Plivo.onLogout()}function r(){Plivo.logNull("_onPrivPopUpClosed"),Plivo.config.mask_page_on_perm&&Plivo.unmaskPage(),x(),m.isMuted()?Plivo.onMediaPermission(!1):(Plivo.onMediaPermission(!0),Plivo.config.perm_on_click&&("IN"==_?Plivo.conn.answer():Plivo.conn.call(E,y)))}function i(){var e=document.createElement("div");e.id="plivo_flash_placeholder",document.body.insertBefore(e,document.body.firstChild)}var o,s,u,a,c,h,d="phone.plivo.com",f="rtmp.plivo.com",p={rtmp_url:"rtmp://"+f+"/phone",bridgeName:"flex",codec:"speex",aec:"yes",init_tone:"no"},g={allowScriptAccess:"always"},v={},m=null,_=null,T="",C=!1,A=!1,S=!1,E=null,y=null,b=function(e){i(),p.init_tone="yes",e.flash_aec===!1&&(p.aec="no"),""===e.swf_path?(Plivo.logDebug("Before Embedding ..."),n.embedSWF("//s3.amazonaws.com/plivosdk/web/plivo.v0.18.8.swf","plivo_flash_placeholder","215","138","10.0.0","",p,g,v,function(e){console.log(e&&e.success?"Embed Success!":"Embed Event not Success."+e)})):(Plivo.logDebug("Before Embedding "+e.swf_path),n.embedSWF(e.swf_path,"plivo_flash_placeholder","215","138","10.0.0","",p,g,v,function(e){console.log(e&&e.success?"Embed Success!":"Embed Event not Success."+e)})),Plivo.logDebug("Post Embedding ..."),FABridge.addInitializationCallback("flex",R);try{FABridge.instance&&FABridge.instances.flex||Plivo.logDebug("Unable to initialize. Ensure Flash Plugin is permitted by Browser.")}catch(t){Plivo.logDebug("Unknown Initialization Error.")}},w=function(){Plivo.config.mask_page_on_perm&&Plivo.maskThePage(),F(),Plivo.onRequirePermission(),m.showPrivacy()},R=function(){Plivo.logNull("plivo_flash initCallback"),m=FABridge.flex.root(),m.addEventListener("EvtInit",t),m.addEventListener("EvtConnected",U),m.addEventListener("EvtLogin",O),m.addEventListener("EvtLogout",M),m.addEventListener("EvtMakeCall",D),m.addEventListener("EvtCallState",N),m.addEventListener("EvtHangup",P),m.addEventListener("EvtIncomingCall",I),m.addEventListener("EvtDisconnected",l),m.addEventListener("EvtPrivPopUpClosed",r),m.addEventListener("EvtLog",L),m.addEventListener("EvtMicAvailable",k),m.addEventListener("EvtMicNotAvailable",q),m.isMuted()&&!Plivo.config.listen_mode?(Plivo.logDebug("mic is muted"),document.getElementById("plivo_flash_placeholder").style.zIndex="999",Plivo.config.perm_on_click?x():w()):(Plivo.logDebug("mic permission is OK"),x())};e.prototype.login=function(e,n){if(!A)return Plivo.logDebug("error : flash backend is not ready yet. You need to wait for onReady event to be fired before login."),!1;if(void 0===e||void 0===n||null===e||null===n)return Plivo.logDebug("username & password cant be null"),!1;if(e.length<=0||0>=n)return Plivo.logDebug("username & password length should be more than 0"),!1;s=e+"@"+d,c=e;var t=CryptoJS.MD5(e+":"+d+":"+n).toString();return m.login(s,t),!0},e.prototype.logout=function(){return Plivo.conn.ringToneStop(),Plivo.conn.ringBackToneStop(),m.unregister(s,c),m.logout(s),!0},e.prototype.call=function(e,n){if(!A)return Plivo.logDebug("error : flash backend is not ready yet"),!1;if(!S)return Plivo.logDebug("error : you need to be logged in before make a call"),!1;if(void 0===e||null===e||e.length<=0)return Plivo.logDebug("destination address can't be null and it's lenght must be > 0"),!1;if(m.isMuted()&&!Plivo.config.listen_mode)return Plivo.logDebug("Mic is muted, show privacy page"),w(),E=e,y=n,!0;e.indexOf("@")<0&&(e=e+"@"+d),0!==e.indexOf("sip:")&&(e="sip:"+e),Plivo.conn.ringBackTonePlay(),n=n||{};var t={};for(var l in n){var r=n[l].toString();Plivo.checkExtraHeader(l,r)===!0&&(t[l]=r)}return m.makeCall(e,s,t),!0},e.prototype.hangup=function(){return Plivo.conn.ringBackToneStop(),m.hangup(u),!0},e.prototype.send_dtmf=function(e){return void 0===e||null===e?(Plivo.logDebug("DTMF digit can't be null"),!1):(m.sendDTMF(e,2e3),Plivo.conn.dtmfTonePlay(e),!0)},e.prototype.answer=function(){return m.isMuted()&&!Plivo.config.listen_mode?(Plivo.logDebug("Mic is muted, show privacy page"),w(),!0):(Plivo.logNull("answering="+a),Plivo.conn.ringToneStop(),m.answer(a),!0)},e.prototype.reject=function(){return Plivo.conn.ringToneStop(),m.hangup(a),!0},e.prototype.mute=function(){return Plivo.logNull("mute the mic"),m.setMute(),!0},e.prototype.unmute=function(){return Plivo.logNull("unmute"),m.setUnMute(),!0},e.prototype.setTone=function(e){return m.toneSet("ring_tone",e,""),!0},e.prototype.setRingToneBack=function(e){return m.toneSet("ring_back_tone",e,""),!0},e.prototype.setDtmfTone=function(e,n){return m.toneSet("dtmf_tone",e,n),!0},e.prototype.checkMic=function(){return m.checkMicStatus(),!0},e.prototype.getCallStats=function(){return m.getStats(),!0};var I=function(e){var n,t={};if(a=e.getUuid(),Plivo.logDebug("_onIncomingCall.uuid="+a),_)return Plivo.logNull("Another call in progress/active, reject new call"),m.hangup(a);_="IN",n=JSON.parse(e.getExtraHeaders());for(var l in n)0===l.indexOf("rtmp_u__")&&(t[l.substring(8)]=n[l]);Plivo.conn.ringTonePlay(),Plivo.onIncomingCall(e.getName(),t)},P=function(){Plivo.logNull("_onHangup"),C===!0?(C=!1,Plivo.conn.ringToneStop(),Plivo.onCallTerminated()):"IN"==_?(Plivo.logNull("hangup.not in call.IN"),Plivo.conn.ringToneStop(),Plivo.onIncomingCallCanceled()):(Plivo.logNull("hangup.not in call.OUT"),Plivo.conn.ringBackToneStop(),Plivo.onCallFailed()),_=null},N=function(e){uuid=e.getUuid();var n=e.getState();return Plivo.logNull("new call state="+n),n===T?void Plivo.logNull("new_state == old state. Ignore it"):(T=n,void("ACTIVE"==T?(C=!0,Plivo.conn.ringBackToneStop(),Plivo.conn.ringToneStop(),Plivo.onCallAnswered()):"RINGING"==T?"OUT"==_&&Plivo.onCallRemoteRinging():"HANGUP"==T?P():"EARLY"==T&&Plivo.conn.ringBackToneStop()))},D=function(e){_="OUT",number=e.getNumber(),s=e.getAccount(),u=e.getUuid(),Plivo.conn.ringBackTonePlay(),Plivo.onCalling()},U=function(e){Plivo.logDebug("___onConnected"),o=e.getSid(),A=!0,Plivo.onReady()},O=function(e){result=e.getResult(),user=e.getUser(),"success"!=result?(S=!1,Plivo.logNull("login failed"),Plivo.onLoginFailed()):(S=!0,Plivo.logNull("login OK."),m.register(s,c),Plivo.onLogin())},M=function(){S=!1,B("onLogout"),Plivo.onLogout()},L=function(e){Plivo.logNull(e.getMessage())},x=function(){Plivo.logDebug("_moveBackFlashObject");var e=document.getElementById("plivo_flash_placeholder");e.style.zIndex="-99","Safari"!=BrowserDetect.browser&&(e.style.position="relative"),e.style.top="0",e.style.left="0","Explorer"==BrowserDetect.browser||"Safari"==BrowserDetect.browser?(e.width="1",e.height="1"):(e.width="0",e.height="0")},F=function(){Plivo.logDebug("resurrect flash object");var e=document.getElementById("plivo_flash_placeholder");e.style.zIndex="999",e.style.position="absolute",e.style.visibility="visible",window.self==window.top?(e.style.top="40%",e.style.left="40%"):(e.style.top="0",e.style.left="0"),e.width="215",e.height="138"},k=function(){Plivo.logDebug("_onMicAvailable"),Plivo.onMicAvailable()},q=function(){Plivo.logDebug("_onMicNotAvailable"),Plivo.onMicNotAvailable()},B=function(e){Plivo.logNull(e)};return e.prototype.ringTonePlay=function(){Plivo.ringToneFlag!==!1&&(Plivo.logNull("send play ringtone command to flash"),m.toneCtrl("ring_tone","play",""))},e.prototype.ringToneStop=function(){Plivo.ringToneFlag!==!1&&m.toneCtrl("ring_tone","stop","")},e.prototype.ringBackTonePlay=function(){Plivo.ringToneBackFlag!==!1&&m.toneCtrl("ring_back_tone","play","")},e.prototype.ringBackToneStop=function(){Plivo.ringToneBackFlag!==!1&&m.toneCtrl("ring_back_tone","stop","")},e.prototype.dtmfTonePlay=function(e){return Plivo.logNull("play dtmf tone:"+e),Plivo.getDtmfToneFlag(e)===!1?void Plivo.logNull("dtmfToneFlag == false"):void m.toneCtrl("dtmf_tone","play",e)},e}(),window.plivo_flash=e;var n=function(){function e(){if(!W){try{var e=F.getElementsByTagName("body")[0].appendChild(m("span"));e.parentNode.removeChild(e)}catch(n){return}W=!0;for(var t=B.length,l=0;t>l;l++)B[l]()}}function t(e){W?e():B[B.length]=e}function l(e){if(typeof x.addEventListener!=P)x.addEventListener("load",e,!1);else if(typeof F.addEventListener!=P)F.addEventListener("load",e,!1);else if(typeof x.attachEvent!=P)_(x,"onload",e);else if("function"==typeof x.onload){var n=x.onload;x.onload=function(){n(),e()}}else x.onload=e}function r(){q?i():o()}function i(){var e=F.getElementsByTagName("body")[0],n=m(N);n.setAttribute("type",O);var t=e.appendChild(n);if(t){var l=0;!function(){if(typeof t.GetVariable!=P){var r=t.GetVariable("$version");r&&(r=r.split(" ")[1].split(","),K.pv=[parseInt(r[0],10),parseInt(r[1],10),parseInt(r[2],10)])}else if(10>l)return l++,void setTimeout(arguments.callee,10);e.removeChild(n),t=null,o()}()}else o()}function o(){var e=H.length;if(e>0)for(var n=0;e>n;n++){var t=H[n].id,l=H[n].callbackFn,r={success:!1,id:t};if(K.pv[0]>0){var i=v(t);if(i)if(!T(H[n].swfVersion)||K.wk&&K.wk<312)if(H[n].expressInstall&&u()){var o={};o.data=H[n].expressInstall,o.width=i.getAttribute("width")||"0",o.height=i.getAttribute("height")||"0",i.getAttribute("class")&&(o.styleclass=i.getAttribute("class")),i.getAttribute("align")&&(o.align=i.getAttribute("align"));for(var h={},d=i.getElementsByTagName("param"),f=d.length,p=0;f>p;p++)"movie"!=d[p].getAttribute("name").toLowerCase()&&(h[d[p].getAttribute("name")]=d[p].getAttribute("value"));a(o,h,t,l)}else c(i),l&&l(r);else A(t,!0),l&&(r.success=!0,r.ref=s(t),l(r))}else if(A(t,!0),l){var g=s(t);g&&typeof g.SetVariable!=P&&(r.success=!0,r.ref=g),l(r)}}}function s(e){var n=null,t=v(e);if(t&&"OBJECT"==t.nodeName)if(typeof t.SetVariable!=P)n=t;else{var l=t.getElementsByTagName(N)[0];l&&(n=l)}return n}function u(){return!z&&T("6.0.65")&&(K.win||K.mac)&&!(K.wk&&K.wk<312)}function a(e,n,t,l){z=!0,b=l||null,w={success:!1,id:t};var r=v(t);if(r){"OBJECT"==r.nodeName?(E=h(r),y=null):(E=r,y=t),e.id=M,(typeof e.width==P||!/%$/.test(e.width)&&parseInt(e.width,10)<310)&&(e.width="310"),(typeof e.height==P||!/%$/.test(e.height)&&parseInt(e.height,10)<137)&&(e.height="137"),F.title=F.title.slice(0,47)+" - Flash Player Installation";var i=K.ie&&K.win?"ActiveX":"PlugIn",o="MMredirectURL="+encodeURI(window.location).toString().replace(/&/g,"%26")+"&MMplayerType="+i+"&MMdoctitle="+F.title;if(typeof n.flashvars!=P?n.flashvars+="&"+o:n.flashvars=o,K.ie&&K.win&&4!=r.readyState){var s=m("div");t+="SWFObjectNew",s.setAttribute("id",t),r.parentNode.insertBefore(s,r),r.style.display="none",function(){4==r.readyState?r.parentNode.removeChild(r):setTimeout(arguments.callee,10)}()}d(e,n,t)}}function c(e){if(K.ie&&K.win&&4!=e.readyState){var n=m("div");e.parentNode.insertBefore(n,e),n.parentNode.replaceChild(h(e),n),e.style.display="none",function(){4==e.readyState?e.parentNode.removeChild(e):setTimeout(arguments.callee,10)}()}else e.parentNode.replaceChild(h(e),e)}function h(e){var n=m("div");if(K.win&&K.ie)n.innerHTML=e.innerHTML;else{var t=e.getElementsByTagName(N)[0];if(t){var l=t.childNodes;if(l)for(var r=l.length,i=0;r>i;i++)1==l[i].nodeType&&"PARAM"==l[i].nodeName||8==l[i].nodeType||n.appendChild(l[i].cloneNode(!0))}}return n}function d(e,n,t){var l,r=v(t);if(K.wk&&K.wk<312)return l;if(r)if(typeof e.id==P&&(e.id=t),K.ie&&K.win){var i="";for(var o in e)e[o]!=Object.prototype[o]&&("data"==o.toLowerCase()?n.movie=e[o]:"styleclass"==o.toLowerCase()?i+=' class="'+e[o]+'"':"classid"!=o.toLowerCase()&&(i+=" "+o+'="'+e[o]+'"'));var s="";for(var u in n)n[u]!=Object.prototype[u]&&(s+='<param name="'+u+'" value="'+n[u]+'" />');r.outerHTML='<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"'+i+">"+s+"</object>",G[G.length]=e.id,l=v(e.id)}else{var a=m(N);a.setAttribute("type",O);for(var c in e)e[c]!=Object.prototype[c]&&("styleclass"==c.toLowerCase()?a.setAttribute("class",e[c]):"classid"!=c.toLowerCase()&&a.setAttribute(c,e[c]));for(var h in n)n[h]!=Object.prototype[h]&&"movie"!=h.toLowerCase()&&f(a,h,n[h]);r.parentNode.replaceChild(a,r),l=a}return l}function f(e,n,t){var l=m("param");l.setAttribute("name",n),l.setAttribute("value",t),e.appendChild(l)}function p(e){var n=v(e);n&&"OBJECT"==n.nodeName&&(K.ie&&K.win?(n.style.display="none",function(){4==n.readyState?g(e):setTimeout(arguments.callee,10)}()):n.parentNode.removeChild(n))}function g(e){var n=v(e);if(n){for(var t in n)"function"==typeof n[t]&&(n[t]=null);n.parentNode.removeChild(n)}}function v(e){var n=null;try{n=F.getElementById(e)}catch(t){}return n}function m(e){return F.createElement(e)}function _(e,n,t){e.attachEvent(n,t),V[V.length]=[e,n,t]}function T(e){var n=K.pv,t=e.split(".");return t[0]=parseInt(t[0],10),t[1]=parseInt(t[1],10)||0,t[2]=parseInt(t[2],10)||0,n[0]>t[0]||n[0]==t[0]&&n[1]>t[1]||n[0]==t[0]&&n[1]==t[1]&&n[2]>=t[2]}function C(e,n,t,l){if(!K.ie||!K.mac){var r=F.getElementsByTagName("head")[0];if(r){var i=t&&"string"==typeof t?t:"screen";if(l&&(R=null,I=null),!R||I!=i){var o=m("style");o.setAttribute("type","text/css"),o.setAttribute("media",i),R=r.appendChild(o),K.ie&&K.win&&typeof F.styleSheets!=P&&F.styleSheets.length>0&&(R=F.styleSheets[F.styleSheets.length-1]),I=i}K.ie&&K.win?R&&typeof R.addRule==N&&R.addRule(e,n):R&&typeof F.createTextNode!=P&&R.appendChild(F.createTextNode(e+" {"+n+"}"))}}}function A(e,n){if(Y){var t=n?"visible":"hidden";if(W&&v(e)){var l=document.getElementById(e);l.style.visibility=t,l.style.position="absolute",l.style.top="-15000",l.style.left="-15000",l.style.zIndex="-999"}else C("#"+e,"visibility:"+t)}}function S(e){var n=/[\\\"<>\.;]/,t=null!==n.exec(e);return t&&typeof encodeURIComponent!=P?encodeURIComponent(e):e}var E,y,b,w,R,I,P="undefined",N="object",D="Shockwave Flash",U="ShockwaveFlash.ShockwaveFlash",O="application/x-shockwave-flash",M="SWFObjectExprInst",L="onreadystatechange",x=window,F=document,k=navigator,q=!1,B=[r],H=[],G=[],V=[],W=!1,z=!1,Y=!0,K=function(){var e=typeof F.getElementById!=P&&typeof F.getElementsByTagName!=P&&typeof F.createElement!=P,n=k.userAgent.toLowerCase(),t=k.platform.toLowerCase(),l=/win/.test(t?t:n),r=/mac/.test(t?t:n),i=/webkit/.test(n)?parseFloat(n.replace(/^.*webkit\/(\d+(\.\d+)?).*$/,"$1")):!1,o=!1,s=[0,0,0],u=null;if(typeof k.plugins!=P&&typeof k.plugins[D]==N)u=k.plugins[D].description,!u||typeof k.mimeTypes!=P&&k.mimeTypes[O]&&!k.mimeTypes[O].enabledPlugin||(q=!0,o=!1,u=u.replace(/^.*\s+(\S+\s+\S+$)/,"$1"),s[0]=parseInt(u.replace(/^(.*)\..*$/,"$1"),10),s[1]=parseInt(u.replace(/^.*\.(.*)\s.*$/,"$1"),10),s[2]=/[a-zA-Z]/.test(u)?parseInt(u.replace(/^.*[a-zA-Z]+(.*)$/,"$1"),10):0);else if(typeof x.ActiveXObject!=P)try{var a=new ActiveXObject(U);a&&(u=a.GetVariable("$version"),u&&(o=!0,u=u.split(" ")[1].split(","),s=[parseInt(u[0],10),parseInt(u[1],10),parseInt(u[2],10)]))}catch(c){}return{w3:e,pv:s,wk:i,ie:o,win:l,mac:r}}();return!function(){K.w3&&((typeof F.readyState!=P&&"complete"==F.readyState||typeof F.readyState==P&&(F.getElementsByTagName("body")[0]||F.body))&&e(),W||(typeof F.addEventListener!=P&&F.addEventListener("DOMContentLoaded",e,!1),K.ie&&K.win&&(F.attachEvent(L,function(){"complete"==F.readyState&&(F.detachEvent(L,arguments.callee),e())}),x==top&&!function(){if(!W){try{F.documentElement.doScroll("left")}catch(n){return void setTimeout(arguments.callee,0)}e()}}()),K.wk&&!function(){return W?void 0:/loaded|complete/.test(F.readyState)?void e():void setTimeout(arguments.callee,0)}(),l(e)))}(),function(){K.ie&&K.win&&window.attachEvent("onunload",function(){for(var e=V.length,t=0;e>t;t++)V[t][0].detachEvent(V[t][1],V[t][2]);for(var l=G.length,r=0;l>r;r++)p(G[r]);for(var i in K)K[i]=null;K=null;for(var o in n)n[o]=null;n=null})}(),{registerObject:function(e,n,t,l){if(K.w3&&e&&n){var r={};r.id=e,r.swfVersion=n,r.expressInstall=t,r.callbackFn=l,H[H.length]=r,A(e,!1)}else l&&l({success:!1,id:e})},getObjectById:function(e){return K.w3?s(e):void 0},embedSWF:function(e,n,l,r,i,o,s,c,h,f){var p={success:!1,id:n};K.w3&&!(K.wk&&K.wk<312)&&e&&n&&l&&r&&i?(A(n,!1),t(function(){l+="",r+="";var t={};if(h&&typeof h===N)for(var g in h)t[g]=h[g];t.data=e,t.width=l,t.height=r;var v={};if(c&&typeof c===N)for(var m in c)v[m]=c[m];if(s&&typeof s===N)for(var _ in s)typeof v.flashvars!=P?v.flashvars+="&"+_+"="+s[_]:v.flashvars=_+"="+s[_];if(T(i)){var C=d(t,v,n);t.id==n&&A(n,!0),p.success=!0,p.ref=C}else{if(o&&u())return t.data=o,void a(t,v,n,f);A(n,!0)}f&&f(p)})):f&&f(p)},switchOffAutoHideShow:function(){Y=!1},ua:K,getFlashPlayerVersion:function(){return{major:K.pv[0],minor:K.pv[1],release:K.pv[2]}},hasFlashPlayerVersion:T,createSWF:function(e,n,t){return K.w3?d(e,n,t):void 0},showExpressInstall:function(e,n,t,l){K.w3&&u()&&a(e,n,t,l)},removeSWF:function(e){K.w3&&p(e)},createCSS:function(e,n,t,l){K.w3&&C(e,n,t,l)},addDomLoadEvent:t,addLoadEvent:l,getQueryParamValue:function(e){var n=F.location.search||F.location.hash;if(n){if(/\?/.test(n)&&(n=n.split("?")[1]),null===e)return S(n);for(var t=n.split("&"),l=0;l<t.length;l++)if(t[l].substring(0,t[l].indexOf("="))==e)return S(t[l].substring(t[l].indexOf("=")+1))}return""},expressInstallCallback:function(){if(z){var e=v(M);e&&E&&(e.parentNode.replaceChild(E,e),y&&(A(y,!0),K.ie&&K.win&&(E.style.display="block")),b&&b(w)),z=!1}}}}()}}.call(this),FABridge.TYPE_ASINSTANCE=1,FABridge.TYPE_ASFUNCTION=2,FABridge.TYPE_JSFUNCTION=3,FABridge.TYPE_ANONYMOUS=4,FABridge.initCallbacks={},FABridge.argsToArray=function(e){for(var n=[],t=0;t<e.length;t++)n[t]=e[t];return n},FABridge.addInitializationCallback=function(e,n){var t=FABridge.instances[e];if(void 0!=t)return void n.call(t);var l=FABridge.initCallbacks[e];null==l&&(FABridge.initCallbacks[e]=l=[]),l.push(n)},FABridge.nextBridgeID=0,FABridge.instances={},FABridge.idMap={},FABridge.refCount=0,FABridge.extractBridgeFromID=function(e){var n=e>>16;return FABridge.idMap[n]},FABridge.attachBridge=function(e,n){var t=new FABridge(e,n);FABridge[n]=t;var l=FABridge.initCallbacks[n];if(null!=l){for(var r=0;r<l.length;r++)l[r].call(t);delete FABridge.initCallbacks[n]}},FABridge.blockedMethods={toString:!0,get:!0,set:!0,call:!0},FABridge.prototype={root:function(){return this.deserialize(this.target.getRoot())},releaseASObjects:function(){return this.target.releaseASObjects()},releaseNamedASObject:function(e){if("object"!=typeof e)return!1;var n=this.target.releaseNamedASObject(e.fb_instance_id);return n},create:function(e){return this.deserialize(this.target.create(e))},makeID:function(e){return(this.bridgeID<<16)+e},getPropertyFromAS:function(e,n){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.getPropFromAS(e,n),retVal=this.handleError(retVal),FABridge.refCount--,retVal},setPropertyInAS:function(e,n,t){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.setPropInAS(e,n,this.serialize(t)),retVal=this.handleError(retVal),FABridge.refCount--,retVal},callASFunction:function(e,n){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,retVal=this.target.invokeASFunction(e,this.serialize(n)),retVal=this.handleError(retVal),FABridge.refCount--,retVal},callASMethod:function(e,n,t){if(FABridge.refCount>0)throw new Error("You are trying to call recursively into the Flash Player which is not allowed. In most cases the JavaScript setTimeout function, can be used as a workaround.");return FABridge.refCount++,t=this.serialize(t),retVal=this.target.invokeASMethod(e,n,t),retVal=this.handleError(retVal),FABridge.refCount--,retVal},invokeLocalFunction:function(e,n){var t,l=this.localFunctionCache[e];return void 0!=l&&(t=this.serialize(l.apply(null,this.deserialize(n)))),t},getTypeFromName:function(e){return this.remoteTypeCache[e]},createProxy:function(e,n){var t=this.getTypeFromName(n);instanceFactory.prototype=t;var l=new instanceFactory(e);return this.remoteInstanceCache[e]=l,l},getProxy:function(e){return this.remoteInstanceCache[e]},addTypeDataToCache:function(e){newType=new ASProxy(this,e.name);for(var n=e.accessors,t=0;t<n.length;t++)this.addPropertyToType(newType,n[t]);for(var l=e.methods,t=0;t<l.length;t++)void 0==FABridge.blockedMethods[l[t]]&&this.addMethodToType(newType,l[t]);return this.remoteTypeCache[newType.typeName]=newType,newType},addPropertyToType:function(e,n){var t,l,r=n.charAt(0);r>="a"&&"z">=r?(l="get"+r.toUpperCase()+n.substr(1),t="set"+r.toUpperCase()+n.substr(1)):(l="get"+n,t="set"+n),e[t]=function(e){this.bridge.setPropertyInAS(this.fb_instance_id,n,e)},e[l]=function(){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,n))}},addMethodToType:function(e,n){e[n]=function(){return this.bridge.deserialize(this.bridge.callASMethod(this.fb_instance_id,n,FABridge.argsToArray(arguments)))}},getFunctionProxy:function(e){var n=this;return null==this.remoteFunctionCache[e]&&(this.remoteFunctionCache[e]=function(){n.callASFunction(e,FABridge.argsToArray(arguments))}),this.remoteFunctionCache[e]},getFunctionID:function(e){return void 0==e.__bridge_id__&&(e.__bridge_id__=this.makeID(this.nextLocalFuncID++),this.localFunctionCache[e.__bridge_id__]=e),e.__bridge_id__},serialize:function(e){var n={},t=typeof e;if("number"==t||"string"==t||"boolean"==t||null==t||void 0==t)n=e;else if(e instanceof Array){n=[];for(var l=0;l<e.length;l++)n[l]=this.serialize(e[l])}else"function"==t?(n.type=FABridge.TYPE_JSFUNCTION,n.value=this.getFunctionID(e)):e instanceof ASProxy?(n.type=FABridge.TYPE_ASINSTANCE,n.value=e.fb_instance_id):(n.type=FABridge.TYPE_ANONYMOUS,n.value=e);return n},deserialize:function(e){var n,t=typeof e;if("number"==t||"string"==t||"boolean"==t||null==e||void 0==e)n=this.handleError(e);else if(e instanceof Array){n=[];for(var l=0;l<e.length;l++)n[l]=this.deserialize(e[l])}else if("object"==t){for(var l=0;l<e.newTypes.length;l++)this.addTypeDataToCache(e.newTypes[l]);for(var r in e.newRefs)this.createProxy(r,e.newRefs[r]);e.type==FABridge.TYPE_PRIMITIVE?n=e.value:e.type==FABridge.TYPE_ASFUNCTION?n=this.getFunctionProxy(e.value):e.type==FABridge.TYPE_ASINSTANCE?n=this.getProxy(e.value):e.type==FABridge.TYPE_ANONYMOUS&&(n=e.value)}return n},addRef:function(e){this.target.incRef(e.fb_instance_id)},release:function(e){this.target.releaseRef(e.fb_instance_id)},handleError:function(e){if("string"==typeof e&&0==e.indexOf("__FLASHERROR")){var n=e.split("||");throw FABridge.refCount>0&&FABridge.refCount--,new Error(n[1])}return e}},ASProxy=function(e,n){return this.bridge=e,this.typeName=n,this},ASProxy.prototype={get:function(e){return this.bridge.deserialize(this.bridge.getPropertyFromAS(this.fb_instance_id,e));
},set:function(e,n){this.bridge.setPropertyInAS(this.fb_instance_id,e,n)},call:function(e,n){this.bridge.callASMethod(this.fb_instance_id,e,n)},addRef:function(){this.bridge.addRef(this)},release:function(){this.bridge.release(this)}},function(){var e;e=function(){function e(){}var n,t,l,r=null,i=!0,o=!0,s={0:!0,1:!0,2:!0,3:!0,4:!0,5:!0,6:!0,7:!0,8:!0,9:!0,"#":!0,"*":!0};e.prototype.onReady=function(){},e.prototype.onLogin=function(){},e.prototype.onLoginFailed=function(){},e.prototype.onLogout=function(){},e.prototype.onCalling=function(){},e.prototype.onCallRemoteRinging=function(){},e.prototype.onCallAnswered=function(){},e.prototype.onCallTerminated=function(){},e.prototype.onIncomingCall=function(){},e.prototype.onIncomingCallCanceled=function(){Plivo.logDevel("onIncomingCallCanceled stub")},e.prototype.onCallFailed=function(){Plivo.logDevel("onCallFailed stub")},e.prototype.onMediaPermission=function(){Plivo.logDevel("onMediaPermission")},e.prototype.onRequirePermission=function(){},e.prototype.onWebrtcNotSupported=function(){console.warn("your browser doesn't support webrtc")},e.prototype.onFlashNotInstalled=function(){console.warn("your browser doesn't have flash installed")},e.prototype.onMicAvailable=function(){},e.prototype.onMicNotAvailable=function(){};var u=function(e){return"undefined"==typeof e&&(e={}),"undefined"==typeof e.fallback_to_flash&&(e.fallback_to_flash=!0),"undefined"==typeof e.debug&&(e.debug=!0),"undefined"==typeof e.mask_page_on_perm&&(e.mask_page_on_perm=!1),"undefined"==typeof e.perm_on_click&&(e.perm_on_click=!1),"undefined"==typeof e.listen_mode&&(e.listen_mode=!1),"undefined"==typeof e.flash_aec&&(e.flash_aec=!0),"undefined"==typeof e.swf_path&&(e.swf_path=""),e};e.prototype.init=function(e){l=BrowserDetect.browser,t=BrowserDetect.version,"MSIE"==l&&g(),Plivo.config=r=u(e),Plivo.logDebug("Plivo SDK initialization"),Plivo.logDebug("- User Agent : "+navigator.userAgent),Plivo.logDebug("- Browser : "+l+"  "+t),Plivo.logDebug("- OS : "+BrowserDetect.OS),BrowserDetect.isWebrtcSupported()?(Plivo.conn=new plivojs(r),Plivo.conn.init(r),n="webrtc",a()):r.fallback_to_flash?(Plivo.conn=new plivo_flash(r),n="flash"):Plivo.onWebrtcNotSupported()};var a=function(){var e="https://s3.amazonaws.com/plivosdk/audio/us-ring.mp3";"Firefox"==l&&(e="https://s3.amazonaws.com/plivosdk/audio/us-ring.ogg"),p(),d(e),f(e)};e.prototype.setRingTone=function(e){if(e===!1||null===e)i=!1;else if("string"==typeof e){if(i="user","flash"==n)return Plivo.conn.setRingtone(e);var t=document.getElementById("plivo_ringtone");t.src=e}else i=!0;return!0},e.prototype.setRingToneBack=function(e){if(e===!1||null===e)o=!1;else if("string"==typeof e){if(o="user","flash"==n)return Plivo.conn.setRingToneBack(e);var t=document.getElementById("plivo_ringbacktone");t.src=e}else o=!0;return!0},e.prototype.setDtmfTone=function(e,t){if(t===!1||null===t)s[e]=!1;else if("string"==typeof t){if(s[e]="user","flash"==n)return Plivo.conn.setDtmfTone(t,e);var l="dtmf"+e,r=document.getElementById(l);r.src=t}else s[e]=!0;return!0},e.prototype.logNull=function(){},e.prototype.logDevel=function(e){var n=new Date,t=n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds();console.log("PlivoWebSDK | "+t+" | "+e)},e.prototype.logDebug=function(e){r.debug===!0&&console.log("PlivoWebSDK:"+e)},e.prototype.setDebug=function(e){r.debug=e},e.prototype.getDtmfToneFlag=function(e){return s[e]},e.prototype.maskThePage=function(){var e=document.createElement("div");e.id="plivo_mask",document.body.insertBefore(e,document.body.firstChild),e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.background="#000",e.style.opacity="0.8",e.style.filter="alpha(opacity=80)",e.style.zindex="50"},e.prototype.unmaskPage=function(){var e=document.getElementById("plivo_mask");e.parentNode.removeChild(e)},e.prototype.checkExtraHeader=function(e,n){return!(!c(e)||!h(n))};var c=function(e){if("X-Ph-"!=e.substr(0,5)&&"X-PH-"!=e.substr(0,5))return!1;var n=/^([a-z0-9A-Z]){1,19}$/;return n.test(e.substr(5))===!1?(Plivo.logDebug("invalid key = "+e),!1):!0},h=function(e){var n=/^([a-z0-9A-Z%]){1,48}$/;return n.test(e)===!1?(Plivo.logDebug("invalid value = "+e),!1):!0},d=function(e){var n=document.createElement("audio");n.id="plivo_ringbacktone",n.loop="loop",n.src=e,document.body.appendChild(n)},f=function(e){var n=document.createElement("audio");n.id="plivo_ringtone",n.loop="loop",n.src=e,document.body.appendChild(n)},p=function(){var e,n="https://s3.amazonaws.com/plivosdk/audio/dtmf-";e="Firefox"==l?"ogg":"mp3";for(var t=function(e,n,t){var l="dtmf"+n,r=e+n+"."+t,i=document.createElement("audio");i.id=l,i.src=r,document.body.appendChild(i)},r=0;9>=r;r++)t(n,r,e);t(n,"star",e),t(n,"pound",e)},g=function(){var e=document.createElement("meta");e.setAttribute("http-equiv","X-UA-Compatible"),e.content="chrome1",document.getElementsByTagName("head")[0].appendChild(e)};return e}(),window.plivo_stub=e}.call(this),window.Plivo=new plivo_stub,function(e){var n=function(){"use strict";var e={};return Object.defineProperties?Object.defineProperties(e,{version:{get:function(){return"0.3.1-devel-tag-v0.18.8"}},name:{get:function(){return"WebSDK"}}}):(e.version=function(){return"0.3.1-devel-tag-v0.18.8"},e.name=function(){return"WebSDK"}),e}();!function(e){var n,t,l=e.name+" | EVENT EMITTER | ";n=function(){},n.prototype={initEvents:function(e){var n=e.length;for(this.events={},this.onceNotFired=[],this.maxListeners=10,this.events.newListener=function(e){Plivo.logNull(l+"new listener added to event "+e)};n--;)Plivo.logNull(l+"adding event "+e[n]),this.events[e[n]]=[]},checkEvent:function(e){return this.events[e]?!0:(Plivo.logNull(l+"no event named "+e),!1)},addListener:function(e,n){this.checkEvent(e)&&(this.events[e].length>=this.maxListeners&&Plivo.logNull(l+"max listeners exceeded for event "+e),this.events[e].push(n),this.events.newListener.call(null,e))},on:function(e,n){this.addListener(e,n)},once:function(e,n){this.events[e].unshift(n),this.onceNotFired.push(e)},removeListener:function(e,n){if(this.checkEvent(e))for(var t=this.events[e],l=0,r=t.length;r>l;)t[l]&&t[l].toString()===n.toString()?t.splice(l,1):l++},removeAllListener:function(e){this.checkEvent(e)&&(this.events[e]=[])},setMaxListeners:function(e){Number(e)&&(this.maxListeners=e)},listeners:function(e){return this.events[e]},emit:function(n,t,r){var i,o,s=0;if(this.checkEvent(n)){Plivo.logNull(l+"emitting event "+n),i=this.events[n],o=i.length;var u=new e.Event(n,t,r);if(u)for(s;o>s;s++)i[s].apply(null,[u]);else for(s;o>s;s++)i[s].call();s=this.onceNotFired.indexOf(n),-1!==s&&(this.onceNotFired.splice(s,1),this.events[n].shift())}},newListener:function(e){this.events.newListener=e}},t=function(e,n,t){this.type=e,this.sender=n,this.data=t},e.EventEmitter=n,e.Event=t}(n),n.C={USER_AGENT:n.name+" "+n.version,SIP:"sip",INVALID_TARGET_URI:"sip:invalid@invalid",causes:{CONNECTION_ERROR:"Connection Error",REQUEST_TIMEOUT:"Request Timeout",SIP_FAILURE_CODE:"SIP Failure Code",INVALID_TARGET:"Invalid Target",INTERNAL_ERROR:"Internal Error",BUSY:"Busy",REJECTED:"Rejected",REDIRECTED:"Redirected",UNAVAILABLE:"Unavailable",NOT_FOUND:"Not Found",ADDRESS_INCOMPLETE:"Address Incomplete",INCOMPATIBLE_SDP:"Incompatible SDP",AUTHENTICATION_ERROR:"Authentication Error",DIALOG_ERROR:"Dialog Error",WEBRTC_NOT_SUPPORTED:"WebRTC Not Supported",WEBRTC_ERROR:"WebRTC Error",CANCELED:"Canceled",NO_ANSWER:"No Answer",EXPIRES:"Expires",NO_ACK:"No ACK",USER_DENIED_MEDIA_ACCESS:"User Denied Media Access",BAD_MEDIA_DESCRIPTION:"Bad Media Description",RTP_TIMEOUT:"RTP Timeout"},SIP_ERROR_CAUSES:{REDIRECTED:[300,301,302,305,380],BUSY:[486,600],REJECTED:[403,603],NOT_FOUND:[404,604],UNAVAILABLE:[480,410,408,430],ADDRESS_INCOMPLETE:[484],INCOMPATIBLE_SDP:[488,606],AUTHENTICATION_ERROR:[401,407]},ACK:"ACK",BYE:"BYE",CANCEL:"CANCEL",INFO:"INFO",INVITE:"INVITE",MESSAGE:"MESSAGE",NOTIFY:"NOTIFY",OPTIONS:"OPTIONS",REGISTER:"REGISTER",UPDATE:"UPDATE",SUBSCRIBE:"SUBSCRIBE",REASON_PHRASE:{100:"Trying",180:"Ringing",181:"Call Is Being Forwarded",182:"Queued",183:"Session Progress",199:"Early Dialog Terminated",200:"OK",202:"Accepted",204:"No Notification",300:"Multiple Choices",301:"Moved Permanently",302:"Moved Temporarily",305:"Use Proxy",380:"Alternative Service",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",410:"Gone",412:"Conditional Request Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Unsupported URI Scheme",417:"Unknown Resource-Priority",420:"Bad Extension",421:"Extension Required",422:"Session Interval Too Small",423:"Interval Too Brief",428:"Use Identity Header",429:"Provide Referrer Identity",430:"Flow Failed",433:"Anonymity Disallowed",436:"Bad Identity-Info",437:"Unsupported Certificate",438:"Invalid Identity Header",439:"First Hop Lacks Outbound Support",440:"Max-Breadth Exceeded",469:"Bad Info Package",470:"Consent Needed",478:"Unresolvable Destination",480:"Temporarily Unavailable",481:"Call/Transaction Does Not Exist",482:"Loop Detected",483:"Too Many Hops",484:"Address Incomplete",485:"Ambiguous",486:"Busy Here",487:"Request Terminated",488:"Not Acceptable Here",489:"Bad Event",491:"Request Pending",493:"Undecipherable",494:"Security Agreement Required",500:"Server Internal Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Server Time-out",505:"Version Not Supported",513:"Message Too Large",580:"Precondition Failure",600:"Busy Everywhere",603:"Decline",604:"Does Not Exist Anywhere",606:"Not Acceptable"}},function(n){var t;t={ConfigurationError:function(){var n=function(n,t){this.code=1,this.name="CONFIGURATION_ERROR",this.parameter=n,this.value=t,this.message=this.value?"Invalid value "+e.JSON.stringify(this.value)+' for parameter "'+this.parameter+'"':"Missing parameter: "+this.parameter};return n.prototype=new Error,n}(),InvalidTargetError:function(){var e=function(e){this.code=2,this.name="INVALID_TARGET_ERROR",this.target=e,this.message="Invalid target: "+this.target};return e.prototype=new Error,e}(),InvalidStateError:function(){var e=function(e){this.code=3,this.name="INVALID_STATE_ERROR",this.status=e};return e.prototype=new Error,e}()},n.Exceptions=t}(n),function(e){var n,t=500,l=4e3,r=5e3;n={T1:t,T2:l,T4:r,TIMER_B:64*t,TIMER_D:0*t,TIMER_F:64*t,TIMER_H:64*t,TIMER_I:0*t,TIMER_J:0*t,TIMER_K:0*r,TIMER_L:64*t,TIMER_M:64*t},e.Timers=n}(n),function(n){var t,l=n.name+" | TRANSPORT | ",r={STATUS_READY:0,STATUS_DISCONNECTED:1,STATUS_ERROR:2};t=function(e,n){this.ua=e,this.ws=null,this.server=n,this.reconnection_attempts=0,this.closed=!1,this.connected=!1,this.reconnectTimer=null,this.lastTransportError={},this.ua.transport=this,this.connect()},t.prototype={send:function(e){var n=e.toString();return this.ws&&this.ws.readyState===WebSocket.OPEN?(this.ua.configuration.trace_sip===!0&&Plivo.logNull(l+"sending WebSocket message:\n\n"+n+"\n"),this.ws.send(n),!0):(Plivo.logNull(l+"unable to send message, WebSocket is not open"),!1)},disconnect:function(){this.ws&&(this.closed=!0,Plivo.logNull(l+"closing WebSocket "+this.server.ws_uri),this.ws.close())},connect:function(){var e=this;if(this.ws&&(this.ws.readyState===WebSocket.OPEN||this.ws.readyState===WebSocket.CONNECTING))return Plivo.logNull(l+"WebSocket "+this.server.ws_uri+" is already connected"),!1;this.ws&&this.ws.close(),Plivo.logNull(l+"connecting to WebSocket "+this.server.ws_uri);try{this.ws=new WebSocket(this.server.ws_uri,"sip")}catch(n){Plivo.logNull(l+"error connecting to WebSocket "+this.server.ws_uri+": "+n)}this.ws.binaryType="arraybuffer",this.ws.onopen=function(){e.onOpen()},this.ws.onclose=function(n){e.onClose(n)},this.ws.onmessage=function(n){e.onMessage(n)},this.ws.onerror=function(n){e.onError(n)}},onOpen:function(){this.connected=!0,Plivo.logNull(l+"WebSocket "+this.server.ws_uri+" connected"),e.clearTimeout(this.reconnectTimer),this.closed=!1,this.ua.onTransportConnected(this)},onClose:function(e){var n=this.connected;this.connected=!1,this.lastTransportError.code=e.code,this.lastTransportError.reason=e.reason,Plivo.logNull(l+"WebSocket disconnected (code: "+e.code+(e.reason?"| reason: "+e.reason:"")+")"),e.wasClean===!1&&Plivo.logNull(l+"WebSocket abrupt disconnection"),n===!0?(this.ua.onTransportClosed(this),this.closed?this.ua.emit("disconnected",this.ua,{transport:this,code:this.lastTransportError.code,reason:this.lastTransportError.reason}):(this.reconnection_attempts=0,this.reConnect())):this.ua.onTransportError(this)},onMessage:function(e){var t,r,i=e.data;if("\r\n"===i)return void(this.ua.configuration.trace_sip===!0&&Plivo.logNull(l+"received WebSocket message with CRLF Keep Alive response"));if("string"!=typeof i){try{i=String.fromCharCode.apply(null,new Uint8Array(i))}catch(o){return void Plivo.logNull(l+"received WebSocket binary message failed to be converted into string, message discarded")}this.ua.configuration.trace_sip===!0&&Plivo.logNull(l+"received WebSocket binary message:\n\n"+i+"\n")}else this.ua.configuration.trace_sip===!0&&Plivo.logNull(l+"received WebSocket text message:\n\n"+i+"\n");if(t=n.Parser.parseMessage(i),!(this.ua.status===n.UA.C.STATUS_USER_CLOSED&&t instanceof n.IncomingRequest)&&t&&n.sanityCheck(t,this.ua,this))if(t instanceof n.IncomingRequest)t.transport=this,this.ua.receiveRequest(t);else if(t instanceof n.IncomingResponse)switch(t.method){case n.C.INVITE:r=this.ua.transactions.ict[t.via_branch],r&&r.receiveResponse(t);break;case n.C.ACK:break;default:r=this.ua.transactions.nict[t.via_branch],r&&r.receiveResponse(t)}},onError:function(e){Plivo.logNull(l+"WebSocket connection error: "+e)},reConnect:function(){var n=this;this.reconnection_attempts+=1,this.reconnection_attempts>this.ua.configuration.ws_server_max_reconnection?(Plivo.logNull(l+"maximum reconnection attempts for WebSocket "+this.server.ws_uri),this.ua.onTransportError(this)):(Plivo.logNull(l+"trying to reconnect to WebSocket "+this.server.ws_uri+" (reconnection attempt "+this.reconnection_attempts+")"),this.reconnectTimer=e.setTimeout(function(){n.connect()},1e3*this.ua.configuration.ws_server_reconnection_timeout))}},t.C=r,n.Transport=t}(n),function(e){function n(e,n){var t=n,l=0,r=0;if(e.substring(t,t+2).match(/(^\r\n)/))return-2;for(;0===l;){if(r=e.indexOf("\r\n",t),-1===r)return r;!e.substring(r+2,r+4).match(/(^\r\n)/)&&e.charAt(r+2).match(/(^\s+)/)?t=r+2:l=r}return l}function t(n,t,l,r){var i,o,s,u,a=t.indexOf(":",l),c=t.substring(l,a).trim(),h=t.substring(a+1,r).trim();switch(c.toLowerCase()){case"via":case"v":n.addHeader("via",h),1===n.countHeader("via")?(u=n.parseHeader("Via"),u&&(n.via=u,n.via_branch=u.branch)):u=0;break;case"from":case"f":n.setHeader("from",h),u=n.parseHeader("from"),u&&(n.from=u,n.from_tag=u.getParam("tag"));break;case"to":case"t":n.setHeader("to",h),u=n.parseHeader("to"),u&&(n.to=u,n.to_tag=u.getParam("tag"));break;case"record-route":for(u=e.Grammar.parse(h,"Record_Route"),-1===u&&(u=void 0),s=u.length,o=0;s>o;o++)i=u[o],n.addHeader("record-route",h.substring(i.possition,i.offset)),n.headers["Record-Route"][n.countHeader("record-route")-1].parsed=i.parsed;break;case"call-id":case"i":n.setHeader("call-id",h),u=n.parseHeader("call-id"),u&&(n.call_id=h);break;case"contact":case"m":for(u=e.Grammar.parse(h,"Contact"),-1===u&&(u=void 0),s=u.length,o=0;s>o;o++)i=u[o],n.addHeader("contact",h.substring(i.possition,i.offset)),n.headers.Contact[n.countHeader("contact")-1].parsed=i.parsed;break;case"content-length":case"l":n.setHeader("content-length",h),u=n.parseHeader("content-length");break;case"content-type":case"c":n.setHeader("content-type",h),u=n.parseHeader("content-type");break;case"cseq":n.setHeader("cseq",h),u=n.parseHeader("cseq"),u&&(n.cseq=u.value),n instanceof e.IncomingResponse&&(n.method=u.method);break;case"max-forwards":n.setHeader("max-forwards",h),u=n.parseHeader("max-forwards");break;case"www-authenticate":n.setHeader("www-authenticate",h),u=n.parseHeader("www-authenticate");break;case"proxy-authenticate":n.setHeader("proxy-authenticate",h),u=n.parseHeader("proxy-authenticate");break;default:n.setHeader(c,h),u=0}return void 0!==u}var l,r=e.name+" | PARSER | ";l={},l.parseMessage=function(l){var i,o,s,u,a,c=0,h=l.indexOf("\r\n");if(-1===h)return void Plivo.logNull(r+"no CRLF found, not a SIP message, discarded");if(o=l.substring(0,h),a=e.Grammar.parse(o,"Request_Response"),-1===a)return void Plivo.logNull(r+'error parsing first line of SIP message: "'+o+'"');for(a.status_code?(i=new e.IncomingResponse,i.status_code=a.status_code,i.reason_phrase=a.reason_phrase):(i=new e.IncomingRequest,i.method=a.method,i.ruri=a.uri),i.data=l,c=h+2;;){if(h=n(l,c),-2===h){u=c+2;break}if(-1===h)return;if(a=t(i,l,c,h),!a)return;c=h+2}return i.hasHeader("content-length")?(s=i.getHeader("content-length"),i.body=l.substr(u,s)):i.body=l.substring(u),i},e.Parser=l}(n),function(e){var n,t,l,r,i=e.name+" | SIP MESSAGE | ";n=function(n,t,l,r,i,o){var s,u,a,c;return r=r||{},n&&t&&l?(this.headers={},this.method=n,this.ruri=t,this.body=o,this.extraHeaders=i||[],r.route_set?this.setHeader("route",r.route_set):l.configuration.use_preloaded_route&&this.setHeader("route",l.transport.server.sip_uri),this.setHeader("via",""),this.setHeader("max-forwards",e.UA.C.MAX_FORWARDS),s=r.to_display_name||0===r.to_display_name?'"'+r.to_display_name+'" ':"",s+="<"+(r.to_uri||t)+">",s+=r.to_tag?";tag="+r.to_tag:"",this.to=new e.NameAddrHeader.parse(s),this.setHeader("to",s),u=r.from_display_name||0===r.from_display_name?'"'+r.from_display_name+'" ':l.configuration.display_name?'"'+l.configuration.display_name+'" ':"",u+="<"+(r.from_uri||l.configuration.uri)+">;tag=",u+=r.from_tag||e.Utils.newTag(),this.from=new e.NameAddrHeader.parse(u),this.setHeader("from",u),a=r.call_id||l.configuration.websdk_id+e.Utils.createRandomToken(15),this.call_id=a,this.setHeader("call-id",a),c=r.cseq||Math.floor(1e4*Math.random()),this.cseq=c,void this.setHeader("cseq",c+" "+n)):null},n.prototype={setHeader:function(n,t){this.headers[e.Utils.headerize(n)]=t instanceof Array?t:[t]},toString:function(){var n,t,l,r="";r+=this.method+" "+this.ruri+" SIP/2.0\r\n";for(n in this.headers)for(t=this.headers[n].length,l=0;t>l;l++)r+=n+": "+this.headers[n][l]+"\r\n";for(t=this.extraHeaders.length,l=0;t>l;l++)r+=this.extraHeaders[l]+"\r\n";return r+="Supported: "+e.UA.C.SUPPORTED+"\r\n",r+="User-Agent: "+e.C.USER_AGENT+"\r\n",this.body?(t=e.Utils.str_utf8_length(this.body),r+="Content-Length: "+t+"\r\n\r\n",r+=this.body):r+="Content-Length: 0\r\n\r\n",r}},t=function(){this.data=null,this.headers=null,this.method=null,this.via=null,this.via_branch=null,this.call_id=null,this.cseq=null,this.from=null,this.from_tag=null,this.to=null,this.to_tag=null,this.body=null},t.prototype={addHeader:function(n,t){var l={raw:t};n=e.Utils.headerize(n),this.headers[n]?this.headers[n].push(l):this.headers[n]=[l]},countHeader:function(n){var t=this.headers[e.Utils.headerize(n)];return t?t.length:0},getHeader:function(n,t){var l=this.headers[e.Utils.headerize(n)];return t=t||0,l&&l[t]?l[t].raw:void 0},getHeaderAll:function(n){var t,l,r=this.headers[e.Utils.headerize(n)],i=[];if(!r)return[];for(l=r.length,t=0;l>t;t++)i.push(r[t].raw);return i},hasHeader:function(n){return!!this.headers[e.Utils.headerize(n)]},parseHeader:function(n,t){var l,r,o;return n=e.Utils.headerize(n),t=t||0,this.headers[n]?t>=this.headers[n].length?void Plivo.logNull(i+'not so many "'+n+'" headers present'):(l=this.headers[n][t],r=l.raw,l.parsed?l.parsed:(o=e.Grammar.parse(r,n.replace(/-/g,"_")),-1===o?(this.headers[n].splice(t,1),void Plivo.logNull(i+'error parsing "'+n+'" header field with value "'+r+'"')):(l.parsed=o,o))):void Plivo.logNull(i+'header "'+n+'" not present')},s:function(e,n){return this.parseHeader(e,n)},setHeader:function(n,t){var l={raw:t};this.headers[e.Utils.headerize(n)]=[l]},toString:function(){return this.data}},l=function(){this.headers={},this.ruri=null,this.transport=null,this.server_transaction=null},l.prototype=new t,l.prototype.reply=function(n,t,l,r,i,o){var s,u,a,c,h,d=this.getHeader("To"),f=0,p=0;if(n=n||null,t=t||null,!n||100>n||n>699)throw new TypeError("Invalid status_code: "+n);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);if(t=t||e.C.REASON_PHRASE[n]||"",l=l||[],h="SIP/2.0 "+n+" "+t+"\r\n",this.method===e.C.INVITE&&n>100&&200>=n)for(s=this.countHeader("record-route"),f;s>f;f++)h+="Record-Route: "+this.getHeader("record-route",f)+"\r\n";for(u=this.countHeader("via"),p;u>p;p++)h+="Via: "+this.getHeader("via",p)+"\r\n";for(!this.to_tag&&n>100?d+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(d+=";tag="+this.to_tag),h+="To: "+d+"\r\n",h+="From: "+this.getHeader("From")+"\r\n",h+="Call-ID: "+this.call_id+"\r\n",h+="CSeq: "+this.cseq+" "+this.method+"\r\n",a=l.length,c=0;a>c;c++)h+=l[c]+"\r\n";r?(a=e.Utils.str_utf8_length(r),h+="Content-Type: application/sdp\r\n",h+="Content-Length: "+a+"\r\n\r\n",h+=r):h+="Content-Length: 0\r\n\r\n",this.server_transaction.receiveResponse(n,h,i,o)},l.prototype.reply_sl=function(n,t){var l,r,i=this.countHeader("via");if(n=n||null,t=t||null,!n||100>n||n>699)throw new TypeError("Invalid status_code: "+n);if(t&&"string"!=typeof t&&!(t instanceof String))throw new TypeError("Invalid reason_phrase: "+t);t=t||e.C.REASON_PHRASE[n]||"",r="SIP/2.0 "+n+" "+t+"\r\n";for(var o=0;i>o;o++)r+="Via: "+this.getHeader("via",o)+"\r\n";l=this.getHeader("To"),!this.to_tag&&n>100?l+=";tag="+e.Utils.newTag():this.to_tag&&!this.s("to").hasParam("tag")&&(l+=";tag="+this.to_tag),r+="To: "+l+"\r\n",r+="From: "+this.getHeader("From")+"\r\n",r+="Call-ID: "+this.call_id+"\r\n",r+="CSeq: "+this.cseq+" "+this.method+"\r\n",r+="Content-Length: 0\r\n\r\n",this.transport.send(r)},r=function(){this.headers={},this.status_code=null,this.reason_phrase=null},r.prototype=new t,e.OutgoingRequest=n,e.IncomingRequest=l,e.IncomingResponse=r}(n),function(n){var t;t=function(e,t,l,r,i,o){var s,u;if(!l)throw new TypeError('missing or invalid "host" parameter');e=e||n.C.SIP,this.parameters={},this.headers={};for(s in i)this.setParam(s,i[s]);for(u in o)this.setHeader(u,o[u]);Object.defineProperties(this,{scheme:{get:function(){return e},set:function(n){e=n.toLowerCase()}},user:{get:function(){return t},set:function(e){t=e}},host:{get:function(){return l},set:function(e){l=e.toLowerCase()}},port:{get:function(){return r},set:function(e){r=0===e?e:parseInt(e,10)||null}}})},t.prototype={setParam:function(e,n){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof n||null===n?null:n.toString().toLowerCase())},getParam:function(e){return e?this.parameters[e.toLowerCase()]:void 0},hasParam:function(e){return e?this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1:void 0},deleteParam:function(e){var n;return e=e.toLowerCase(),this.parameters.hasOwnProperty(e)?(n=this.parameters[e],delete this.parameters[e],n):void 0},clearParams:function(){this.parameters={}},setHeader:function(e,t){this.headers[n.Utils.headerize(e)]=t instanceof Array?t:[t]},getHeader:function(e){return e?this.headers[n.Utils.headerize(e)]:void 0},hasHeader:function(e){return e?this.headers.hasOwnProperty(n.Utils.headerize(e))&&!0||!1:void 0},deleteHeader:function(e){var t;return e=n.Utils.headerize(e),this.headers.hasOwnProperty(e)?(t=this.headers[e],delete this.headers[e],t):void 0},clearHeaders:function(){this.headers={}},clone:function(){return new t(this.scheme,this.user,this.host,this.port,e.JSON.parse(e.JSON.stringify(this.parameters)),e.JSON.parse(e.JSON.stringify(this.headers)))},toString:function(){var e,t,l,r,i=[];r=this.scheme+":",this.user&&(r+=n.Utils.escapeUser(this.user)+"@"),r+=this.host,(this.port||0===this.port)&&(r+=":"+this.port);for(t in this.parameters)r+=";"+t,null!==this.parameters[t]&&(r+="="+this.parameters[t]);for(e in this.headers)for(l in this.headers[e])i.push(e+"="+this.headers[e][l]);return i.length>0&&(r+="?"+i.join("&")),r},toAor:function(e){var t;return t=this.scheme+":",this.user&&(t+=n.Utils.escapeUser(this.user)+"@"),t+=this.host,e&&(this.port||0===this.port)&&(t+=":"+this.port),t}},t.parse=function(e){return e=n.Grammar.parse(e,"SIP_URI"),-1!==e?e:void 0},n.URI=t}(n),function(n){var t;t=function(e,t,l){var r;if(!(e&&e instanceof n.URI))throw new TypeError('missing or invalid "uri" parameter');this.uri=e,this.parameters={};for(r in l)this.setParam(r,l[r]);Object.defineProperties(this,{display_name:{get:function(){return t},set:function(e){t=0===e?"0":e}}})},t.prototype={setParam:function(e,n){e&&(this.parameters[e.toLowerCase()]="undefined"==typeof n||null===n?null:n.toString())},getParam:function(e){return e?this.parameters[e.toLowerCase()]:void 0},hasParam:function(e){return e?this.parameters.hasOwnProperty(e.toLowerCase())&&!0||!1:void 0},deleteParam:function(e){var n;return e=e.toLowerCase(),this.parameters.hasOwnProperty(e)?(n=this.parameters[e],delete this.parameters[e],n):void 0},clearParams:function(){this.parameters={}},clone:function(){return new t(this.uri.clone(),this.display_name,e.JSON.parse(e.JSON.stringify(this.parameters)))},toString:function(){var e,n;e=this.display_name||0===this.display_name?'"'+this.display_name+'" ':"",e+="<"+this.uri.toString()+">";for(n in this.parameters)e+=";"+n,null!==this.parameters[n]&&(e+="="+this.parameters[n]);return e}},t.parse=function(e){return e=n.Grammar.parse(e,"Name_Addr_Header"),-1!==e?e:void 0},n.NameAddrHeader=t}(n),function(n){var t,l=n.name+" | TRANSACTION | ",r={STATUS_TRYING:1,STATUS_PROCEEDING:2,STATUS_CALLING:3,STATUS_ACCEPTED:4,STATUS_COMPLETED:5,STATUS_TERMINATED:6,STATUS_CONFIRMED:7};t={};var i=function(){this.init=function(e,n,t){var l;this.transport=t,this.id="z9hG4bK"+Math.floor(1e7*Math.random()),this.request_sender=e,this.request=n,l="SIP/2.0/"+(e.ua.configuration.hack_via_tcp?"TCP":t.server.scheme),l+=" "+e.ua.configuration.via_host+";branch="+this.id,this.request.setHeader("via",l)}},o=function(){this.send=function(){var t=this;this.state=r.STATUS_TRYING,this.F=e.setTimeout(function(){t.timer_F()},n.Timers.TIMER_F),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){Plivo.logNull(l+"transport error occurred, deleting non-INVITE client transaction "+this.id),e.clearTimeout(this.F),e.clearTimeout(this.K),delete this.request_sender.ua.transactions.nict[this.id],this.request_sender.onTransportError()},this.timer_F=function(){Plivo.logNull(l+"Timer F expired for non-INVITE client transaction "+this.id),this.state=r.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.nict[this.id]},this.timer_K=function(){this.state=r.STATUS_TERMINATED,delete this.request_sender.ua.transactions.nict[this.id]},this.receiveResponse=function(t){var l=this,i=t.status_code;if(200>i)switch(this.state){case r.STATUS_TRYING:case r.STATUS_PROCEEDING:this.state=r.STATUS_PROCEEDING,this.request_sender.receiveResponse(t)}else switch(this.state){case r.STATUS_TRYING:case r.STATUS_PROCEEDING:this.state=r.STATUS_COMPLETED,e.clearTimeout(this.F),408===i?this.request_sender.onRequestTimeout():this.request_sender.receiveResponse(t),this.K=e.setTimeout(function(){l.timer_K()},n.Timers.TIMER_K);break;case r.STATUS_COMPLETED:}}};o.prototype=new i;var s=function(){this.send=function(){var t=this;this.state=r.STATUS_CALLING,this.B=e.setTimeout(function(){t.timer_B()},n.Timers.TIMER_B),this.transport.send(this.request)||this.onTransportError()},this.onTransportError=function(){Plivo.logNull(l+"transport error occurred, deleting INVITE client transaction "+this.id),e.clearTimeout(this.B),e.clearTimeout(this.D),e.clearTimeout(this.M),delete this.request_sender.ua.transactions.ict[this.id],this.request_sender.onTransportError()},this.timer_M=function(){Plivo.logNull(l+"Timer M expired for INVITE client transaction "+this.id),this.state===r.STATUS_ACCEPTED&&(this.state=r.STATUS_TERMINATED,e.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_B=function(){Plivo.logNull(l+"Timer B expired for INVITE client transaction "+this.id),this.state===r.STATUS_CALLING&&(Plivo.logNull("current status is calling..."),this.state=r.STATUS_TERMINATED,this.request_sender.onRequestTimeout(),delete this.request_sender.ua.transactions.ict[this.id])},this.timer_D=function(){Plivo.logNull(l+"Timer D expired for INVITE client transaction "+this.id),this.state=r.STATUS_TERMINATED,e.clearTimeout(this.B),delete this.request_sender.ua.transactions.ict[this.id]},this.sendACK=function(t){var l=this;this.ack="ACK "+this.request.ruri+" SIP/2.0\r\n",this.ack+="Via: "+this.request.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.ack+="Route: "+this.request.headers.Route.toString()+"\r\n"),this.ack+="To: "+t.getHeader("to")+"\r\n",this.ack+="From: "+this.request.headers.From.toString()+"\r\n",this.ack+="Call-ID: "+this.request.headers["Call-ID"].toString()+"\r\n",this.ack+="CSeq: "+this.request.headers.CSeq.toString().split(" ")[0],this.ack+=" ACK\r\n\r\n",this.D=e.setTimeout(function(){l.timer_D()},n.Timers.TIMER_D),this.transport.send(this.ack)},this.cancel_request=function(e,t){var l=e.request;this.cancel=n.C.CANCEL+" "+l.ruri+" SIP/2.0\r\n",this.cancel+="Via: "+l.headers.Via.toString()+"\r\n",this.request.headers.Route&&(this.cancel+="Route: "+l.headers.Route.toString()+"\r\n"),this.cancel+="To: "+l.headers.To.toString()+"\r\n",this.cancel+="From: "+l.headers.From.toString()+"\r\n",this.cancel+="Call-ID: "+l.headers["Call-ID"].toString()+"\r\n",this.cancel+="CSeq: "+l.headers.CSeq.toString().split(" ")[0]+" CANCEL\r\n",t&&(this.cancel+="Reason: "+t+"\r\n"),this.cancel+="Content-Length: 0\r\n\r\n",this.state===r.STATUS_PROCEEDING&&this.transport.send(this.cancel)},this.receiveResponse=function(t){var l=this,i=t.status_code;if(i>=100&&199>=i)switch(this.state){case r.STATUS_CALLING:this.state=r.STATUS_PROCEEDING,this.request_sender.receiveResponse(t),this.cancel&&this.transport.send(this.cancel);break;case r.STATUS_PROCEEDING:this.request_sender.receiveResponse(t)}else if(i>=200&&299>=i)switch(this.state){case r.STATUS_CALLING:case r.STATUS_PROCEEDING:this.state=r.STATUS_ACCEPTED,this.M=e.setTimeout(function(){l.timer_M()},n.Timers.TIMER_M),this.request_sender.receiveResponse(t);break;case r.STATUS_ACCEPTED:this.request_sender.receiveResponse(t)}else if(i>=300&&699>=i)switch(this.state){case r.STATUS_CALLING:case r.STATUS_PROCEEDING:this.state=r.STATUS_COMPLETED,this.sendACK(t),this.request_sender.receiveResponse(t);break;case r.STATUS_COMPLETED:this.sendACK(t)}}};s.prototype=new i;var u=function(){this.init=function(e,n){this.id=e.via_branch,this.request=e,this.transport=e.transport,this.ua=n,this.last_response="",e.server_transaction=this}},a=function(){this.timer_J=function(){Plivo.logNull(l+"Timer J expired for non-INVITE server transaction "+this.id),this.state=r.STATUS_TERMINATED,delete this.ua.transactions.nist[this.id]},this.onTransportError=function(){this.transportError||(this.transportError=!0,Plivo.logNull(l+"transport error occurred, deleting non-INVITE server transaction "+this.id),e.clearTimeout(this.J),delete this.ua.transactions.nist[this.id])},this.receiveResponse=function(t,l,i,o){var s=this;if(100===t)switch(this.state){case r.STATUS_TRYING:this.state=r.STATUS_PROCEEDING,this.transport.send(l)||this.onTransportError();break;case r.STATUS_PROCEEDING:this.last_response=l,this.transport.send(l)?i&&i():(this.onTransportError(),o&&o())}else if(t>=200&&699>=t)switch(this.state){case r.STATUS_TRYING:case r.STATUS_PROCEEDING:this.state=r.STATUS_COMPLETED,this.last_response=l,this.J=e.setTimeout(function(){s.timer_J()},n.Timers.TIMER_J),this.transport.send(l)?i&&i():(this.onTransportError(),o&&o());break;case r.STATUS_COMPLETED:}}};a.prototype=new u;var c=function(){this.timer_H=function(){Plivo.logNull(l+"Timer H expired for INVITE server transaction "+this.id),
this.state===r.STATUS_COMPLETED&&(Plivo.logNull(l+"transactions","ACK for INVITE server transaction was never received, call will be terminated"),this.state=r.STATUS_TERMINATED),delete this.ua.transactions.ist[this.id]},this.timer_I=function(){this.state=r.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id]},this.timer_L=function(){Plivo.logNull(l+"Timer L expired for INVITE server transaction "+this.id),this.state===r.STATUS_ACCEPTED&&(this.state=r.STATUS_TERMINATED,delete this.ua.transactions.ist[this.id])},this.onTransportError=function(){this.transportError||(this.transportError=!0,Plivo.logNull(l+"transport error occurred, deleting INVITE server transaction "+this.id),e.clearTimeout(this.reliableProvisionalTimer),e.clearTimeout(this.L),e.clearTimeout(this.H),e.clearTimeout(this.I),delete this.ua.transactions.ist[this.id])},this.timer_reliableProvisional=function(t){var l=this,r=this.last_response,i=n.Timers.T1*Math.pow(2,t+1);t>8?e.clearTimeout(this.reliableProvisionalTimer):(t+=1,this.transport.send(r)||this.onTransportError(),this.reliableProvisionalTimer=e.setTimeout(function(){l.timer_reliableProvisional(t)},i))},this.receiveResponse=function(t,l,i,o){var s=this;if(t>=100&&199>=t)switch(this.state){case r.STATUS_PROCEEDING:this.transport.send(l)||this.onTransportError(),this.last_response=l}if(t>100&&199>=t)this.reliableProvisionalTimer||(this.reliableProvisionalTimer=e.setTimeout(function(){s.timer_reliableProvisional(1)},n.Timers.T1));else if(t>=200&&299>=t)switch(this.state){case r.STATUS_PROCEEDING:this.state=r.STATUS_ACCEPTED,this.last_response=l,this.L=e.setTimeout(function(){s.timer_L()},n.Timers.TIMER_L),e.clearTimeout(this.reliableProvisionalTimer);case r.STATUS_ACCEPTED:this.transport.send(l)?i&&i():(this.onTransportError(),o&&o())}else if(t>=300&&699>=t)switch(this.state){case r.STATUS_PROCEEDING:e.clearTimeout(this.reliableProvisionalTimer),this.transport.send(l)?(this.state=r.STATUS_COMPLETED,this.H=e.setTimeout(function(){s.timer_H()},n.Timers.TIMER_H),i&&i()):(this.onTransportError(),o&&o())}}};c.prototype=new u,t.NonInviteClientTransaction=function(e,n,t){this.init(e,n,t),this.request_sender.ua.transactions.nict[this.id]=this},t.NonInviteClientTransaction.prototype=new o,t.InviteClientTransaction=function(e,n,t){var l=this;this.init(e,n,t),this.request_sender.ua.transactions.ict[this.id]=this,this.request.cancel=function(e){l.cancel_request(l,e)}},t.InviteClientTransaction.prototype=new s,t.AckClientTransaction=function(e,n,t){this.init(e,n,t),this.send=function(){this.transport.send(n)}},t.AckClientTransaction.prototype=new o,t.NonInviteServerTransaction=function(e,n){this.init(e,n),this.state=r.STATUS_TRYING,n.transactions.nist[this.id]=this},t.NonInviteServerTransaction.prototype=new a,t.InviteServerTransaction=function(e,n){this.init(e,n),this.state=r.STATUS_PROCEEDING,n.transactions.ist[this.id]=this,this.reliableProvisionalTimer=null,e.reply(100)},t.InviteServerTransaction.prototype=new c,t.checkTransaction=function(t,l){var i;switch(l.method){case n.C.INVITE:if(i=t.transactions.ist[l.via_branch]){switch(i.state){case r.STATUS_PROCEEDING:i.transport.send(i.last_response);break;case r.STATUS_ACCEPTED:}return!0}break;case n.C.ACK:if(i=t.transactions.ist[l.via_branch],!i)return!1;if(i.state===r.STATUS_ACCEPTED)return!1;if(i.state===r.STATUS_COMPLETED)return i.state=r.STATUS_CONFIRMED,i.I=e.setTimeout(function(){i.timer_I()},n.Timers.TIMER_I),!0;break;case n.C.CANCEL:return i=t.transactions.ist[l.via_branch],i?i.state!==r.STATUS_PROCEEDING:(l.reply_sl(481),!0);default:if(i=t.transactions.nist[l.via_branch]){switch(i.state){case r.STATUS_TRYING:break;case r.STATUS_PROCEEDING:case r.STATUS_COMPLETED:i.transport.send(i.last_response)}return!0}}},t.C=r,n.Transactions=t}(n),function(e){var n,t=e.name+" | DIALOG | ",l={STATUS_EARLY:1,STATUS_CONFIRMED:2};n=function(n,r,i,o){var s;return r.hasHeader("contact")?(o=r instanceof e.IncomingResponse?r.status_code<200?l.STATUS_EARLY:l.STATUS_CONFIRMED:o||l.STATUS_CONFIRMED,s=r.parseHeader("contact"),"UAS"===i?(this.id={call_id:r.call_id,local_tag:r.to_tag,remote_tag:r.from_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=o,this.remote_seqnum=r.cseq,this.local_uri=r.parseHeader("to").uri,this.remote_uri=r.parseHeader("from").uri,this.remote_target=s.uri,this.route_set=r.getHeaderAll("record-route")):"UAC"===i&&(this.id={call_id:r.call_id,local_tag:r.from_tag,remote_tag:r.to_tag,toString:function(){return this.call_id+this.local_tag+this.remote_tag}},this.state=o,this.local_seqnum=r.cseq,this.local_uri=r.parseHeader("from").uri,this.remote_uri=r.parseHeader("to").uri,this.remote_target=s.uri,this.route_set=r.getHeaderAll("record-route").reverse()),this.session=n,n.ua.dialogs[this.id.toString()]=this,void Plivo.logNull(t+"new "+i+" dialog created with status "+(this.state===l.STATUS_EARLY?"EARLY":"CONFIRMED"))):(Plivo.logNull(t+"unable to create a Dialog without Contact header field"),!1)},n.prototype={update:function(e,n){this.state=l.STATUS_CONFIRMED,Plivo.logNull(t+"dialog "+this.id.toString()+"  changed to CONFIRMED state"),"UAC"===n&&(this.route_set=e.getHeaderAll("record-route").reverse())},terminate:function(){Plivo.logNull(t+"dialog "+this.id.toString()+" deleted"),delete this.session.ua.dialogs[this.id.toString()]},createRequest:function(n,t){var l,r;return t=t||[],this.local_seqnum||(this.local_seqnum=Math.floor(1e4*Math.random())),l=n===e.C.CANCEL||n===e.C.ACK?this.local_seqnum:this.local_seqnum+=1,r=new e.OutgoingRequest(n,this.remote_target,this.session.ua,{cseq:l,call_id:this.id.call_id,from_uri:this.local_uri,from_tag:this.id.local_tag,to_uri:this.remote_uri,to_tag:this.id.remote_tag,route_set:this.route_set},t),r.dialog=this,r},checkInDialogRequest:function(n){if(this.remote_seqnum){if(n.method!==e.C.INVITE&&n.cseq<this.remote_seqnum)return n.method!==e.C.ACK&&n.reply(500),!1;n.cseq>this.remote_seqnum&&(this.remote_seqnum=n.cseq)}else this.remote_seqnum=n.cseq;switch(n.method){case e.C.INVITE:if(n.cseq<this.remote_seqnum){if(this.state===l.STATUS_EARLY){var t=(10*Math.random()|0)+1;n.reply(500,null,["Retry-After:"+t])}else n.reply(500);return!1}if(this.state===l.STATUS_EARLY)return n.reply(491),!1;n.hasHeader("contact")&&(this.remote_target=n.parseHeader("contact").uri);break;case e.C.NOTIFY:n.hasHeader("contact")&&(this.remote_target=n.parseHeader("contact").uri)}return!0},receiveRequest:function(e){this.checkInDialogRequest(e)&&this.session.receiveRequest(e)}},n.C=l,e.Dialog=n}(n),function(e){var n,t=e.name+" | REQUEST SENDER | ";n=function(n,t){this.ua=t,this.applicant=n,this.method=n.request.method,this.request=n.request,this.credentials=null,this.challenged=!1,this.staled=!1,t.status!==e.UA.C.STATUS_USER_CLOSED||this.method===e.C.BYE&&this.method===e.C.ACK||this.onTransportError()},n.prototype={send:function(){switch(this.method){case"INVITE":this.clientTransaction=new e.Transactions.InviteClientTransaction(this,this.request,this.ua.transport);break;case"ACK":this.clientTransaction=new e.Transactions.AckClientTransaction(this,this.request,this.ua.transport);break;default:this.clientTransaction=new e.Transactions.NonInviteClientTransaction(this,this.request,this.ua.transport)}this.clientTransaction.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},receiveResponse:function(n){var l,r,i,o=n.status_code;if(401!==o&&407!==o||null===this.ua.configuration.password)this.applicant.receiveResponse(n);else{if(401===n.status_code?(r=n.parseHeader("www-authenticate"),i="authorization"):(r=n.parseHeader("proxy-authenticate"),i="proxy-authorization"),!r)return Plivo.logNull(t+n.status_code+" with wrong or missing challenge, cannot authenticate"),void this.applicant.receiveResponse(n);if(!this.challenged||!this.staled&&r.stale===!0){if(this.credentials||(this.credentials=new e.DigestAuthentication(this.ua)),!this.credentials.authenticate(this.request,r))return void this.applicant.receiveResponse(n);this.challenged=!0,r.stale&&(this.staled=!0),n.method===e.C.REGISTER?l=this.applicant.cseq+=1:this.request.dialog?l=this.request.dialog.local_seqnum+=1:(l=this.request.cseq+1,this.request.cseq=l),this.request.setHeader("cseq",l+" "+this.method),this.request.setHeader(i,this.credentials.toString()),this.send()}else this.applicant.receiveResponse(n)}}},e.RequestSender=n}(n),function(e){var n;n=function(e){this.applicant=e,this.request=e.request},n.prototype={send:function(){var n=new e.RequestSender(this,this.applicant.session.ua);n.send()},onRequestTimeout:function(){this.applicant.session.onRequestTimeout(),this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.session.onTransportError(),this.applicant.onTransportError()},receiveResponse:function(n){(408===n.status_code||481===n.status_code)&&this.applicant.session.ended("remote",n,e.C.causes.DIALOG_ERROR),this.applicant.receiveResponse(n)}},e.InDialogRequestSender=n}(n),function(n){var t,l=n.name+" | REGISTRATOR | ";t=function(e,t){var l=1;this.ua=e,this.transport=t,this.registrar=e.configuration.registrar_server,this.expires=e.configuration.register_expires,this.min_expires=e.configuration.register_min_expires,this.call_id=n.Utils.createRandomToken(22),this.cseq=80,this.to_uri=e.configuration.uri,this.registrationTimer=null,this.registered=this.registered_before=!1,this.ua.registrator=this,this.contact=this.ua.contact.toString(),l&&(this.contact+=";reg-id="+l,this.contact+=';+sip.instance="<urn:uuid:'+this.ua.configuration.instance_id+'>"')},t.prototype={register:function(t){var r,i,o,s=this;t=t||{},o=t.extraHeaders||[],o.push("Contact: "+this.contact+";expires="+this.expires),o.push("Allow: "+n.Utils.getAllowedMethods(this.ua)),this.request=new n.OutgoingRequest(n.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},o),r=new n.RequestSender(this,this.ua),this.receiveResponse=function(t){var r,o,u,a=t.countHeader("contact");if(t.cseq===this.cseq)switch(!0){case/^1[0-9]{2}$/.test(t.status_code):break;case/^2[0-9]{2}$/.test(t.status_code):if(t.hasHeader("expires")&&(o=t.getHeader("expires")),!a){Plivo.logNull(l+"no Contact header in response to REGISTER, response ignored");break}for(;a--;){if(r=t.parseHeader("contact",a),r.uri.user===this.ua.contact.uri.user){o=r.getParam("expires");break}r=null}if(!r){Plivo.logNull(l+"no Contact header pointing to us, response ignored");break}o||(o=this.expires),this.registrationTimer=e.setTimeout(function(){s.register()},1e3*o-3e3),r.hasParam("temp-gruu")&&(this.ua.contact.temp_gruu=r.getParam("temp-gruu").replace(/"/g,"")),r.hasParam("pub-gruu")&&(this.ua.contact.pub_gruu=r.getParam("pub-gruu").replace(/"/g,"")),this.registered=!0,this.ua.emit("registered",this.ua,{response:t});break;case/^423$/.test(t.status_code):t.hasHeader("min-expires")?(u=t.getHeader("min-expires"),o=u-this.expires,this.registrationTimer=e.setTimeout(function(){s.register()},1e3*this.expires)):(Plivo.logNull(l+"423 response received for REGISTER without Min-Expires"),this.registrationFailure(t,n.C.causes.SIP_FAILURE_CODE));break;default:i=n.Utils.sipErrorCause(t.status_code),this.registrationFailure(t,i)}},this.onRequestTimeout=function(){this.registrationFailure(null,n.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.registrationFailure(null,n.C.causes.CONNECTION_ERROR)},r.send()},unregister:function(t){var r;if(!this.registered)return void Plivo.logNull(l+"already unregistered");t=t||{},r=t.extraHeaders||[],this.registered=!1,e.clearTimeout(this.registrationTimer),t.all?(r.push("Contact: *"),r.push("Expires: 0"),this.request=new n.OutgoingRequest(n.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},r)):(r.push("Contact: "+this.contact+";expires=0"),this.request=new n.OutgoingRequest(n.C.REGISTER,this.registrar,this.ua,{to_uri:this.to_uri,call_id:this.call_id,cseq:this.cseq+=1},r));var i=new n.RequestSender(this,this.ua);this.receiveResponse=function(e){var t;switch(!0){case/^1[0-9]{2}$/.test(e.status_code):break;case/^2[0-9]{2}$/.test(e.status_code):this.unregistered(e);break;default:t=n.Utils.sipErrorCause(e.status_code),this.unregistered(e,t)}},this.onRequestTimeout=function(){this.unregistered(null,n.C.causes.REQUEST_TIMEOUT)},this.onTransportError=function(){this.unregistered(null,n.C.causes.CONNECTION_ERROR)},i.send()},registrationFailure:function(e,n){this.ua.emit("registrationFailed",this.ua,{response:e||null,cause:n}),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua,{response:e||null,cause:n}))},unregistered:function(e,n){this.registered=!1,this.ua.emit("unregistered",this.ua,{response:e||null,cause:n||null})},onTransportClosed:function(){this.registered_before=this.registered,e.clearTimeout(this.registrationTimer),this.registered&&(this.registered=!1,this.ua.emit("unregistered",this.ua))},onTransportConnected:function(){this.register()},close:function(){this.registered_before=this.registered,this.unregister()}},n.Registrator=t}(n),function(n){var t,l=function(n){var t=function(e,t){this.applicant=e,this.request=t||e.request,this.session=e instanceof n.RTCSession?e:e.session,this.reattempt=!1,this.reatemptTimer=null,this.request_sender=new n.InDialogRequestSender(this)};return t.prototype={receiveResponse:function(t){var l=this,r=t.status_code;t.method===n.C.INVITE&&491===r?this.reattempt?this.applicant.receiveResponse(t):(this.request.cseq.value=this.request.dialog.local_seqnum+=1,this.reatemptTimer=e.setTimeout(function(){l.session.status!==n.RTCSession.C.STATUS_TERMINATED&&(l.reattempt=!0,l.request_sender.send())},this.getReattemptTimeout())):this.applicant.receiveResponse(t)},send:function(){this.request_sender.send()},onRequestTimeout:function(){this.applicant.onRequestTimeout()},onTransportError:function(){this.applicant.onTransportError()},getReattemptTimeout:function(){return"outgoing"===this.session.direction?(1.9*Math.random()+2.1).toFixed(2):(2*Math.random()).toFixed(2)}},t}(n),r=function(n){var t=function(e,n){n=n||{},this.session=e,this.localMedia=null,this.peerConnection=null,this.init(n)};return t.prototype={createOffer:function(e,n){var t=this,l=!1;this.onIceCompleted=function(){l||(l=!0,e(t.peerConnection.localDescription.sdp))},this.peerConnection.createOffer(function(e){t.setLocalDescription(e,n)},function(e){Plivo.logNull(o+"unable to create offer"),Plivo.logNull(e),n()})},createAnswer:function(e,n){var t=this,l=!1;this.onIceCompleted=function(){l||(l=!0,e(t.peerConnection.localDescription.sdp))},this.peerConnection.createAnswer(function(e){t.setLocalDescription(e,n)},function(e){Plivo.logNull(o+"unable to create answer"),Plivo.logNull(e),n()})},setLocalDescription:function(e,n){this.peerConnection.setLocalDescription(e,function(){},function(e){Plivo.logNull(o+"unable to set local description"),Plivo.logNull(e),n()})},addStream:function(e,n,t,l){try{this.peerConnection.addStream(e,l)}catch(r){return Plivo.logNull(o+"error adding stream"),Plivo.logNull(r),void t()}n()},init:function(e){var t,l,r,i,s,u=this,a=[],c=this.session.ua.configuration;for(l=c.stun_servers.length,t=0;l>t;t++)r=c.stun_servers[t],a.push({url:r});for(l=c.turn_servers.length,t=0;l>t;t++)r=c.turn_servers[t],s=r.server,i=s.substr(0,s.indexOf(":")),a.push({url:i+":"+r.username+"@"+s.substr(i.length+1),credential:r.password});this.peerConnection=new n.WebRTC.RTCPeerConnection({iceServers:a},e),this.peerConnection.onaddstream=function(e){Plivo.logNull(o+"stream added: "+e.stream.id),"Firefox"==BrowserDetect.browser&&(document.getElementById("plivo_webrtc_remoteview").mozSrcObject=e.stream)},this.peerConnection.onremovestream=function(e){Plivo.logNull(o+"stream removed: "+e.stream.id)},this.peerConnection.onicecandidate=function(e){function n(e){return e.indexOf("udp")>0&&e.indexOf("typ srflx raddr")>0?(Plivo.logNull("Found needed candidate"),!0):!1}e.candidate?(Plivo.logNull(o+"ICE candidate received: "+e.candidate.candidate),n(e.candidate.candidate)&&u.onIceCompleted()):u.onIceCompleted&&u.onIceCompleted()},this.peerConnection.ongatheringchange=function(e){"Firefox"!=BrowserDetect.browser&&"complete"===e.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState&&u.onIceCompleted()},this.peerConnection.onicechange=function(){Plivo.logNull(o+'ICE connection state changed to "'+this.iceConnectionState+'"')},this.peerConnection.oniceconnectionstatechange=function(e){Plivo.logNull(o+'ICE connection state changed to "'+this.iceConnectionState+'"'),Plivo.onIceConnStateChange&&Plivo.onIceConnStateChange(this.iceConnectionState),"complete"===e.currentTarget.iceGatheringState&&"closed"!==this.iceConnectionState&&u.onIceCompleted()},this.peerConnection.onstatechange=function(){Plivo.logNull(o+'PeerConnection state changed to "'+this.readyState+'"')}},close:function(){Plivo.logNull(o+"closing PeerConnection"),this.peerConnection&&(this.peerConnection.close(),this.localMedia)},getUserMedia:function(t,l,r){function i(e){Plivo.logNull(o+"got local media stream"),Plivo.config.perm_on_click&&Plivo.config.mask_page_on_perm&&Plivo.unmaskPage(),u.localMedia=e,t(e),Plivo.onMediaPermission(!0),"Firefox"==BrowserDetect.browser&&(document.getElementById("plivo_webrtc_selfview").mozSrcObject=e)}function s(e){Plivo.logNull(o+"unable to get user media"),Plivo.logNull(e),Plivo.config.perm_on_click&&Plivo.config.mask_page_on_perm&&Plivo.unmaskPage(),l(),Plivo.onMediaPermission(!1)}var u=this;return Plivo.config.listen_mode?void t(null):(Plivo.logNull(o+"requesting access to local media"),void(e.storedStream?i(e.storedStream):(Plivo.config.mask_page_on_perm&&Plivo.maskThePage(),Plivo.onRequirePermission(),n.WebRTC.getUserMedia(r,i,s))))},onMessage:function(e,t,l,r){Plivo.gotEarlyMedia?l():this.peerConnection.setRemoteDescription(new n.WebRTC.RTCSessionDescription({type:e,sdp:t}),l,r)},onMessageEarlyMedia:function(e,t,l,r){this.peerConnection.setRemoteDescription(new n.WebRTC.RTCSessionDescription({type:e,sdp:t}),l,r)}},t}(n),i=function(e){var n,t={MIN_DURATION:70,MAX_DURATION:6e3,DEFAULT_DURATION:100,MIN_INTER_TONE_GAP:50,DEFAULT_INTER_TONE_GAP:500};return n=function(e){var n=["succeeded","failed"];this.session=e,this.direction=null,this.tone=null,this.duration=null,this.initEvents(n)},n.prototype=new e.EventEmitter,n.prototype.send=function(n,r){var i,s,u,a;if(void 0===n)throw new TypeError("Not enough arguments");if(this.direction="outgoing",this.session.status!==e.RTCSession.C.STATUS_CONFIRMED&&this.session.status!==e.RTCSession.C.STATUS_WAITING_FOR_ACK)throw new e.Exceptions.InvalidStateError(this.session.status);if(r=r||{},a=r.extraHeaders?r.extraHeaders.slice():[],u=r.eventHandlers||{},"string"==typeof n)n=n.toUpperCase();else{if("number"!=typeof n)throw new TypeError("Invalid tone: "+n);n=n.toString()}if(!n.match(/^[0-9A-D#*]$/))throw new TypeError("Invalid tone: "+n);if(this.tone=n,r.duration&&!e.Utils.isDecimal(r.duration))throw new TypeError("Invalid tone duration: "+r.duration);r.duration?r.duration<t.MIN_DURATION?(Plivo.logNull(o+'"duration" value is lower than the minimum allowed, setting it to '+t.MIN_DURATION+" milliseconds"),r.duration=t.MIN_DURATION):r.duration>t.MAX_DURATION?(Plivo.logNull(o+'"duration" value is greater than the maximum allowed, setting it to '+t.MAX_DURATION+" milliseconds"),r.duration=t.MAX_DURATION):r.duration=Math.abs(r.duration):r.duration=t.DEFAULT_DURATION,this.duration=r.duration;for(s in u)this.on(s,u[s]);a.push("Content-Type: application/dtmf-relay"),this.request=this.session.dialog.createRequest(e.C.INFO,a),this.request.body="Signal= "+this.tone+"\r\n",this.request.body+="Duration= "+this.duration,i=new l(this),this.session.emit("newDTMF",this.session,{originator:"local",dtmf:this,request:this.request}),i.send()},n.prototype.receiveResponse=function(n){var t;switch(!0){case/^1[0-9]{2}$/.test(n.status_code):break;case/^2[0-9]{2}$/.test(n.status_code):this.emit("succeeded",this,{originator:"remote",response:n});break;default:t=e.Utils.sipErrorCause(n.status_code),this.emit("failed",this,{originator:"remote",response:n,cause:t})}},n.prototype.onRequestTimeout=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.REQUEST_TIMEOUT})},n.prototype.onTransportError=function(){this.emit("failed",this,{originator:"system",cause:e.C.causes.CONNECTION_ERROR})},n.prototype.init_incoming=function(e){var n,t=/^(Signal\s*?=\s*?)([0-9A-D#*]{1})(\s)?.*/,l=/^(Duration\s?=\s?)([0-9]{1,4})(\s)?.*/;this.direction="incoming",this.request=e,e.reply(200),e.body&&(n=e.body.split("\r\n"),2===n.length&&(t.test(n[0])&&(this.tone=n[0].replace(t,"$2")),l.test(n[1])&&(this.duration=parseInt(n[1].replace(l,"$2"),10)))),this.tone&&this.duration?this.session.emit("newDTMF",this.session,{originator:"remote",dtmf:this,request:e}):Plivo.logNull(o+"invalid INFO DTMF received, discarded")},n.C=t,n}(n),o=n.name+" | RTC SESSION | ",s={STATUS_NULL:0,STATUS_INVITE_SENT:1,STATUS_1XX_RECEIVED:2,STATUS_INVITE_RECEIVED:3,STATUS_WAITING_FOR_ANSWER:4,STATUS_WAITING_FOR_ACK:5,STATUS_CANCELED:6,STATUS_TERMINATED:7,STATUS_CONFIRMED:8};t=function(e){var n=["progress","failed","started","ended","newDTMF"];this.ua=e,this.status=s.STATUS_NULL,this.dialog=null,this.earlyDialogs={},this.rtcMediaHandler=null,this.timers={ackTimer:null,expiresTimer:null,invite2xxTimer:null,userNoAnswerTimer:null},this.direction=null,this.local_identity=null,this.remote_identity=null,this.start_time=null,this.end_time=null,this.data={},this.initEvents(n)},t.prototype=new n.EventEmitter,t.prototype.terminate=function(e){e=e||{};var t,l=e.status_code,r=e.reason_phrase,i=e.extraHeaders||[],u=e.body;if(this.status===s.STATUS_TERMINATED)throw new n.Exceptions.InvalidStateError(this.status);switch(this.status){case s.STATUS_NULL:case s.STATUS_INVITE_SENT:case s.STATUS_1XX_RECEIVED:if(Plivo.logNull(o+"canceling RTCSession"),l&&(200>l||l>=700))throw new TypeError("Invalid status_code: "+l);l&&(r=r||n.C.REASON_PHRASE[l]||"",t="SIP ;cause="+l+' ;text="'+r+'"'),this.status===s.STATUS_NULL?(this.isCanceled=!0,this.cancelReason=t):this.status===s.STATUS_INVITE_SENT?this.received_100?this.request.cancel(t):(this.isCanceled=!0,this.cancelReason=t):this.status===s.STATUS_1XX_RECEIVED&&this.request.cancel(t),this.failed("local",null,n.C.causes.CANCELED);break;case s.STATUS_WAITING_FOR_ANSWER:if(Plivo.logNull(o+"rejecting RTCSession"),l=l||480,300>l||l>=700)throw new TypeError("Invalid status_code: "+l);this.request.reply(l,r,i,u),this.failed("local",null,n.C.causes.REJECTED);break;case s.STATUS_WAITING_FOR_ACK:case s.STATUS_CONFIRMED:Plivo.logNull(o+"terminating RTCSession"),this.sendBye(e),this.ended("local",null,n.C.causes.BYE)}this.close()},t.prototype.answer=function(t){t=t||{};var l=this,r=this.request,i=t.extraHeaders||[],u=t.mediaConstraints||{audio:!0,video:!0},a=function(e){return Plivo.config.listen_mode?void h():void l.rtcMediaHandler.addStream(e,h,d)},c=function(){r.reply(480),l.failed("local",null,n.C.causes.USER_DENIED_MEDIA_ACCESS)},h=function(){l.rtcMediaHandler.createAnswer(f,p)},d=function(){l.status!==s.STATUS_TERMINATED&&l.failed("local",null,n.C.causes.WEBRTC_ERROR)},f=function(t){var u=function(){l.status=s.STATUS_WAITING_FOR_ACK,l.timers.invite2xxTimer=e.setTimeout(function i(o){o=o||1;var s=n.Timers.T1*Math.pow(2,o);o*n.Timers.T1<=n.Timers.T2?(o+=1,r.reply(200,null,["Contact: "+l.contact],t),l.timers.invite2xxTimer=e.setTimeout(function(){i(o)},s)):e.clearTimeout(l.timers.invite2xxTimer)},n.Timers.T1),l.timers.ackTimer=e.setTimeout(function(){l.status===s.STATUS_WAITING_FOR_ACK&&(Plivo.logNull(o+"no ACK received, terminating the call"),e.clearTimeout(l.timers.invite2xxTimer),l.sendBye(),l.ended("remote",null,n.C.causes.NO_ACK))},n.Timers.TIMER_H),l.started("local")},a=function(){l.failed("system",null,n.C.causes.CONNECTION_ERROR)};i.push("Contact: "+l.contact),r.reply(200,null,i,t,u,a)},p=function(){l.status!==s.STATUS_TERMINATED&&l.failed("local",null,n.C.causes.WEBRTC_ERROR)};if("incoming"!==this.direction)throw new TypeError('Invalid method "answer" for an outgoing call');if(this.status!==s.STATUS_WAITING_FOR_ANSWER)throw new n.Exceptions.InvalidStateError(this.status);return this.createDialog(r,"UAS")?(e.clearTimeout(this.timers.userNoAnswerTimer),void this.rtcMediaHandler.getUserMedia(a,c,u)):void r.reply(500,"Missing Contact header field")},t.prototype.sendDTMF=function(t,l){function r(){var e,n=new i(h);n.on("failed",function(){d=!1}),e=t[c],c+=1,n.send(e,l)}var u,a,c=0,h=this,d=!0;if(l=l||{},a=l.interToneGap||null,void 0===t)throw new TypeError("Not enough arguments");if(this.status!==s.STATUS_CONFIRMED&&this.status!==s.STATUS_WAITING_FOR_ACK)throw new n.Exceptions.InvalidStateError(this.status);if(!t||"string"!=typeof t&&"number"!=typeof t||!t.toString().match(/^[0-9A-D#*]+$/i))throw new TypeError("Invalid tones: "+t);if(t=t.toString(),a&&!n.Utils.isDecimal(a))throw new TypeError("Invalid interToneGap: "+a);a?a<i.C.MIN_INTER_TONE_GAP?(Plivo.logNull(o+'"interToneGap" value is lower than the minimum allowed, setting it to '+i.C.MIN_INTER_TONE_GAP+" milliseconds"),a=i.C.MIN_INTER_TONE_GAP):a=Math.abs(a):a=i.C.DEFAULT_INTER_TONE_GAP,r(),u=e.setInterval(function(){h.status!==s.STATUS_TERMINATED&&d&&t.length>c?r():e.clearInterval(u)},a)},t.prototype.getLocalStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getLocalStreams()||[]},t.prototype.getRemoteStreams=function(){return this.rtcMediaHandler&&this.rtcMediaHandler.peerConnection&&this.rtcMediaHandler.peerConnection.getRemoteStreams()||[]},t.prototype.init_incoming=function(t){var l,i=this,u=t.getHeader("Content-Type");return t.body&&"application/sdp"===u?(this.status=s.STATUS_INVITE_RECEIVED,this.from_tag=t.from_tag,this.id=t.call_id+this.from_tag,this.request=t,this.contact=this.ua.contact.toString(),this.ua.sessions[this.id]=this,t.hasHeader("expires")&&(l=1e3*t.getHeader("expires")),t.to_tag=n.Utils.newTag(),this.createDialog(t,"UAS",!0)?(this.rtcMediaHandler=new r(this),void this.rtcMediaHandler.onMessage("offer",t.body,function(){t.reply(180,null,["Contact: "+i.contact]),i.status=s.STATUS_WAITING_FOR_ANSWER,i.timers.userNoAnswerTimer=e.setTimeout(function(){t.reply(408),i.failed("local",null,n.C.causes.NO_ANSWER)},i.ua.configuration.no_answer_timeout),l&&(i.timers.expiresTimer=e.setTimeout(function(){i.status===s.STATUS_WAITING_FOR_ANSWER&&(t.reply(487),i.failed("system",null,n.C.causes.EXPIRES))},l)),i.newRTCSession("remote",t)},function(e){Plivo.logNull(o+"invalid SDP"),Plivo.logNull(e),t.reply(488)})):void t.reply(500,"Missing Contact header field")):void t.reply(415)},t.prototype.connect=function(e,t){t=t||{};var l,i,o=!1,u=t.eventHandlers||{},a=t.extraHeaders||[],c=t.mediaConstraints||{audio:!0,video:!0},h=t.RTCConstraints||{};if(void 0===e)throw new TypeError("Not enough arguments");if(this.status!==s.STATUS_NULL)throw new n.Exceptions.InvalidStateError(this.status);for(l in u)this.on(l,u[l]);try{e=n.Utils.normalizeURI(e,this.ua.configuration.hostport_params)}catch(d){e=n.URI.parse(n.C.INVALID_TARGET_URI),o=!0}this.from_tag=n.Utils.newTag(),this.rtcMediaHandler=new r(this,h),this.anonymous=t.anonymous,this.isCanceled=!1,this.received_100=!1,i={from_tag:this.from_tag},this.contact=this.ua.contact.toString({anonymous:this.anonymous,outbound:!0}),this.anonymous&&(i.from_display_name="Anonymous",i.from_uri="sip:anonymous@anonymous.invalid",a.push("P-Preferred-Identity: "+this.ua.configuration.uri.toString()),a.push("Privacy: id")),a.push("Contact: "+this.contact),a.push("Allow: "+n.Utils.getAllowedMethods(this.ua)),a.push("Content-Type: application/sdp"),this.request=new n.OutgoingRequest(n.C.INVITE,e,this.ua,i,a),this.id=this.request.call_id+this.from_tag,this.ua.sessions[this.id]=this,this.newRTCSession("local",this.request),o?this.failed("local",null,n.C.causes.INVALID_TARGET):n.WebRTC.isSupported?this.sendInitialRequest(c):this.failed("local",null,n.C.causes.WEBRTC_NOT_SUPPORTED)},t.prototype.close=function(){var n;if(this.status!==s.STATUS_TERMINATED){Plivo.logNull(o+"closing INVITE session "+this.id),this.rtcMediaHandler&&this.rtcMediaHandler.close();for(n in this.timers)e.clearTimeout(this.timers[n]);this.dialog&&(this.dialog.terminate(),delete this.dialog);for(n in this.earlyDialogs)this.earlyDialogs[n].terminate(),delete this.earlyDialogs[n];this.status=s.STATUS_TERMINATED,delete this.ua.sessions[this.id]}},t.prototype.createDialog=function(e,t,l){var r,i,o="UAS"===t?e.to_tag:e.from_tag,s="UAS"===t?e.from_tag:e.to_tag,u=e.call_id+o+s;return i=this.earlyDialogs[u],l?i?!0:(i=new n.Dialog(this,e,t,n.Dialog.C.STATUS_EARLY),i.id?(this.earlyDialogs[u]=i,!0):(this.failed("remote",e,n.C.causes.INTERNAL_ERROR),!1)):i?(i.update(e,t),this.dialog=i,delete this.earlyDialogs[u],!0):(r=new n.Dialog(this,e,t),r.id?(this.to_tag=e.to_tag,this.dialog=r,!0):(this.failed("remote",e,n.C.causes.INTERNAL_ERROR),!1))},t.prototype.receiveRequest=function(t){var l;if(t.method===n.C.CANCEL)this.request.reply(487),this.status===s.STATUS_WAITING_FOR_ANSWER&&(this.status=s.STATUS_CANCELED,this.failed("remote",t,n.C.causes.CANCELED));else switch(t.method){case n.C.ACK:this.status===s.STATUS_WAITING_FOR_ACK&&(e.clearTimeout(this.timers.ackTimer),e.clearTimeout(this.timers.invite2xxTimer),this.status=s.STATUS_CONFIRMED);break;case n.C.BYE:this.status===s.STATUS_CONFIRMED&&(t.reply(200),this.ended("remote",t,n.C.causes.BYE));break;case n.C.INVITE:this.status===s.STATUS_CONFIRMED&&Plivo.logNull(o+"re-INVITE received");break;case n.C.INFO:(this.status===s.STATUS_CONFIRMED||this.status===s.STATUS_WAITING_FOR_ACK)&&(l=t.getHeader("content-type"),l&&l.match(/^application\/dtmf-relay/i)&&new i(this).init_incoming(t))}},t.prototype.sendInitialRequest=function(e){var t=this,l=new n.RequestSender(t,this.ua),r=function(e){return Plivo.config.listen_mode?void o():void t.rtcMediaHandler.addStream(e,o,u)},i=function(){t.status!==s.STATUS_TERMINATED&&t.failed("local",null,n.C.causes.USER_DENIED_MEDIA_ACCESS)},o=function(){t.rtcMediaHandler.createOffer(a,c)},u=function(){t.status!==s.STATUS_TERMINATED&&t.failed("local",null,n.C.causes.WEBRTC_ERROR)},a=function(e){t.isCanceled||t.status===s.STATUS_TERMINATED||(t.request.body=e,t.status=s.STATUS_INVITE_SENT,l.send())},c=function(){t.status!==s.STATUS_TERMINATED&&t.failed("local",null,n.C.causes.WEBRTC_ERROR)};this.rtcMediaHandler.getUserMedia(r,i,e)},t.prototype.receiveResponse=function(e){var t,l=this;if(this.status===s.STATUS_INVITE_SENT||this.status===s.STATUS_1XX_RECEIVED){if(this.isCanceled)return void(e.status_code>=100&&e.status_code<200?this.request.cancel(this.cancelReason):e.status_code>=200&&e.status_code<299&&this.acceptAndTerminate(e));switch(!0){case/^100$/.test(e.status_code):this.received_100=!0;break;case/^1[0-9]{2}$/.test(e.status_code):if(!e.to_tag){Plivo.logNull(o+"1xx response received without to tag");break}e.hasHeader("contact")&&this.createDialog(e,"UAC",!0),183!=e.status_code||Plivo.gotEarlyMedia||"application/sdp"!==e.getHeader("Content-Type")||(Plivo.logNull("Got SDP in SIP 183"),this.rtcMediaHandler.onMessageEarlyMedia("answer",e.body,function(){Plivo.gotEarlyMedia=!0},function(){Plivo.logNull("Failed to proceed SDP in SIP 183. We will proceed it in SIP 200")})),this.status=s.STATUS_1XX_RECEIVED,this.progress("remote",e);break;case/^2[0-9]{2}$/.test(e.status_code):if(this.dialog)break;if(!e.body){this.acceptAndTerminate(e,400,"Missing session description"),this.failed("remote",e,n.C.causes.BAD_MEDIA_DESCRIPTION);break}this.rtcMediaHandler.onMessage("answer",e.body,function(){l.createDialog(e,"UAC")&&(l.sendACK(),l.status=s.STATUS_CONFIRMED,l.started("remote",e))},function(t){Plivo.logNull(t),l.acceptAndTerminate(e,488,"Not Acceptable Here"),l.failed("remote",e,n.C.causes.BAD_MEDIA_DESCRIPTION)});break;default:t=n.Utils.sipErrorCause(e.status_code),this.failed("remote",e,t)}}},t.prototype.acceptAndTerminate=function(e,n,t){(this.dialog||this.createDialog(e,"UAC"))&&(this.sendACK(),
this.sendBye({status_code:n,reason_phrase:t}))},t.prototype.sendACK=function(){var e=this.dialog.createRequest(n.C.ACK);this.sendRequest(e)},t.prototype.sendBye=function(e){e=e||{};var t,l,r=e.status_code,i=e.reason_phrase||n.C.REASON_PHRASE[r]||"",o=e.extraHeaders||[],s=e.body;if(r&&(200>r||r>=700))throw new TypeError("Invalid status_code: "+r);r&&(l="SIP ;cause="+r+'; text="'+i+'"',o.push("Reason: "+l)),t=this.dialog.createRequest(n.C.BYE,o),t.body=s,this.sendRequest(t)},t.prototype.sendRequest=function(e){var n=new l(this,e);n.send()},t.prototype.onTransportError=function(){this.status!==s.STATUS_TERMINATED&&(this.status===s.STATUS_CONFIRMED?this.ended("system",null,n.C.causes.CONNECTION_ERROR):this.failed("system",null,n.C.causes.CONNECTION_ERROR))},t.prototype.onRequestTimeout=function(){this.status!==s.STATUS_TERMINATED&&(this.status===s.STATUS_CONFIRMED?this.ended("system",null,n.C.causes.REQUEST_TIMEOUT):this.failed("system",null,n.C.causes.CONNECTION_ERROR))},t.prototype.newRTCSession=function(e,n){var t=this,l="newRTCSession";"remote"===e?(t.direction="incoming",t.local_identity=n.to,t.remote_identity=n.from):"local"===e&&(t.direction="outgoing",t.local_identity=n.from,t.remote_identity=n.to),t.ua.emit(l,t.ua,{originator:e,session:t,request:n})},t.prototype.connecting=function(e,n){var t=this,l="connecting";t.emit(l,t,{originator:"local",request:n})},t.prototype.progress=function(e,n){var t=this,l="progress";t.emit(l,t,{originator:e,response:n||null})},t.prototype.started=function(e,n){var t=this,l="started";t.start_time=new Date,t.emit(l,t,{response:n||null})},t.prototype.ended=function(e,n,t){var l=this,r="ended";l.end_time=new Date,l.close(),l.emit(r,l,{originator:e,message:n||null,cause:t})},t.prototype.failed=function(e,n,t){var l=this,r="failed";l.close(),l.emit(r,l,{originator:e,message:n||null,cause:t})},t.C=s,n.RTCSession=t}(n),function(e){var n;n=function(e){this.ua=e,this.direction=null,this.local_identity=null,this.remote_identity=null,this.data={}},n.prototype=new e.EventEmitter,n.prototype.send=function(n,t,l){var r,i,o,s,u,a=["succeeded","failed"],c=!1;if(void 0===n||void 0===t)throw new TypeError("Not enough arguments");this.initEvents(a),l=l||{},u=l.extraHeaders||[],s=l.eventHandlers||{},o=l.contentType||"text/plain";for(i in s)this.on(i,s[i]);try{n=e.Utils.normalizeURI(n,this.ua.configuration.hostport_params)}catch(h){n=e.URI.parse(e.C.INVALID_TARGET_URI),c=!0}this.direction="outgoing",this.local_identity=this.ua.configuration.uri,this.remote_identity=n,this.closed=!1,this.ua.applicants[this]=this,u.push("Content-Type: "+o),this.request=new e.OutgoingRequest(e.C.MESSAGE,n,this.ua,null,u),t&&(this.request.body=t),r=new e.RequestSender(this,this.ua),this.ua.emit("newMessage",this.ua,{originator:"local",message:this,request:this.request}),c?this.emit("failed",this,{originator:"local",cause:e.C.causes.INVALID_TARGET}):r.send()},n.prototype.receiveResponse=function(n){var t;if(!this.closed)switch(!0){case/^1[0-9]{2}$/.test(n.status_code):break;case/^2[0-9]{2}$/.test(n.status_code):delete this.ua.applicants[this],this.emit("succeeded",this,{originator:"remote",response:n});break;default:delete this.ua.applicants[this],t=e.Utils.sipErrorCause(n.status_code),this.emit("failed",this,{originator:"remote",response:n,cause:t})}},n.prototype.onRequestTimeout=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.C.causes.REQUEST_TIMEOUT})},n.prototype.onTransportError=function(){this.closed||this.emit("failed",this,{originator:"system",cause:e.C.causes.CONNECTION_ERROR})},n.prototype.close=function(){this.closed=!0,delete this.ua.applicants[this]},n.prototype.init_incoming=function(n){var t,l=n.getHeader("content-type");this.direction="incoming",this.request=n,this.local_identity=n.to.uri,this.remote_identity=n.from.uri,l&&(l.match(/^text\/plain(\s*;\s*.+)*$/i)||l.match(/^text\/html(\s*;\s*.+)*$/i))?(this.ua.emit("newMessage",this.ua,{originator:"remote",message:this,request:n}),t=this.ua.transactions.nist[n.via_branch],!t||t.state!==e.Transactions.C.STATUS_TRYING&&t.state!==e.Transactions.C.STATUS_PROCEEDING||n.reply(200)):n.reply(415,null,["Accept: text/plain, text/html"])},n.prototype.accept=function(e){e=e||{};var n=e.extraHeaders||[],t=e.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "accept" for an outgoing message');this.request.reply(200,null,n,t)},n.prototype.reject=function(e){e=e||{};var n=e.status_code||480,t=e.reason_phrase,l=e.extraHeaders||[],r=e.body;if("incoming"!==this.direction)throw new TypeError('Invalid method "reject" for an outgoing message');if(300>n||n>=700)throw new TypeError("Invalid status_code: "+n);this.request.reply(n,t,l,r)},e.Message=n}(n),function(n){var t,l=n.name+" | UA | ",r={STATUS_INIT:0,STATUS_READY:1,STATUS_USER_CLOSED:2,STATUS_NOT_READY:3,CONFIGURATION_ERROR:1,NETWORK_ERROR:2,EVENT_METHODS:{newRTCSession:"INVITE",newMessage:"MESSAGE"},ALLOWED_METHODS:["ACK","CANCEL","BYE","OPTIONS"],ACCEPTED_BODY_TYPES:["application/sdp","application/dtmf-relay"],SUPPORTED:"path, outbound, gruu",MAX_FORWARDS:69,TAG_LENGTH:10};t=function(e){var n=["connected","disconnected","registered","unregistered","registrationFailed","newRTCSession","newMessage"];if(r.ACCEPTED_BODY_TYPES=r.ACCEPTED_BODY_TYPES.toString(),this.cache={credentials:{}},this.configuration={},this.dialogs={},this.registrator=null,this.applicants={},this.sessions={},this.transport=null,this.contact=null,this.status=r.STATUS_INIT,this.error=null,this.transactions={nist:{},nict:{},ist:{},ict:{}},this.transportRecoverAttempts=0,void 0===e)throw new TypeError("Not enough arguments");try{this.loadConfig(e),this.initEvents(n)}catch(t){throw this.status=r.STATUS_NOT_READY,this.error=r.CONFIGURATION_ERROR,t}},t.prototype=new n.EventEmitter,t.prototype.register=function(e){this.configuration.register=!0,this.registrator.register(e)},t.prototype.unregister=function(e){this.configuration.register=!1,this.registrator.unregister(e)},t.prototype.isRegistered=function(){return!(!this.registrator||!this.registrator.registered)},t.prototype.isConnected=function(){return this.transport?this.transport.connected:!1},t.prototype.call=function(e,t){var l;l=new n.RTCSession(this),l.connect(e,t)},t.prototype.sendMessage=function(e,t,l){var r;r=new n.Message(this),r.send(e,t,l)},t.prototype.stop=function(){var n,t,i=this;if(Plivo.logNull(l+"user requested closure..."),this.status===r.STATUS_USER_CLOSED)return void Plivo.logNull("UA already closed");this.registrator&&(Plivo.logNull(l+"closing registrator"),this.registrator.close());for(n in this.sessions)Plivo.logNull(l+"closing session "+n),this.sessions[n].terminate();for(t in this.applicants)this.applicants[t].close();this.status=r.STATUS_USER_CLOSED,this.shutdownGraceTimer=e.setTimeout(function(){i.transport.disconnect()},"5000")},t.prototype.start=function(){var e;Plivo.logNull(l+"user requested startup..."),this.status===r.STATUS_INIT?(e=this.getNextWsServer(),new n.Transport(this,e)):this.status===r.STATUS_USER_CLOSED?(Plivo.logNull(l+"resuming"),this.status=r.STATUS_READY,this.transport.connect()):Plivo.logNull(this.status===r.STATUS_READY?l+"UA is in READY status, not resuming":"Connection is down. Auto-Recovery system is trying to connect")},t.prototype.saveCredentials=function(e){this.cache.credentials[e.realm]=this.cache.credentials[e.realm]||{},this.cache.credentials[e.realm][e.uri]=e},t.prototype.getCredentials=function(e){var n,t;return n=e.ruri.host,this.cache.credentials[n]&&this.cache.credentials[n][e.ruri]&&(t=this.cache.credentials[n][e.ruri],t.method=e.method),t},t.prototype.onTransportClosed=function(e){var t,r,i,o=["nict","ict","nist","ist"];for(e.server.status=n.Transport.C.STATUS_DISCONNECTED,Plivo.logNull(l+"connection state set to "+n.Transport.C.STATUS_DISCONNECTED),i=o.length,t=0;i>t;t++)for(r in this.transactions[o[t]])this.transactions[o[t]][r].onTransportError();this.contact.pub_gruu||this.closeSessionsOnTransportError()},t.prototype.onTransportError=function(e){var t;Plivo.logNull(l+"transport "+e.server.ws_uri+" failed | connection state set to "+n.Transport.C.STATUS_ERROR),e.server.status=n.Transport.C.STATUS_ERROR,this.emit("disconnected",this,{transport:e,code:e.lastTransportError.code,reason:e.lastTransportError.reason}),t=this.getNextWsServer(),t?new n.Transport(this,t):(this.closeSessionsOnTransportError(),this.error&&this.error===r.NETWORK_ERROR||(this.status=r.STATUS_NOT_READY,this.error=r.NETWORK_ERROR),this.recoverTransport())},t.prototype.onTransportConnected=function(e){this.transport=e,this.transportRecoverAttempts=0,e.server.status=n.Transport.C.STATUS_READY,Plivo.logNull(l+"connection state set to "+n.Transport.C.STATUS_READY),this.status!==r.STATUS_USER_CLOSED&&(this.status=r.STATUS_READY,this.error=null,this.emit("connected",this,{transport:e}),this.configuration.register?this.registrator?this.registrator.onTransportConnected():(this.registrator=new n.Registrator(this,e),this.register()):this.registrator=new n.Registrator(this,e))},t.prototype.receiveRequest=function(e){var t,i,o,s=e.method;if(e.ruri.user!==this.configuration.uri.user&&e.ruri.user!==this.contact.uri.user)return Plivo.logNull(l+"Request-URI does not point to us"),void(e.method!==n.C.ACK&&e.reply_sl(404));if(!n.Transactions.checkTransaction(this,e)){if(s===n.C.INVITE?new n.Transactions.InviteServerTransaction(e,this):s!==n.C.ACK&&new n.Transactions.NonInviteServerTransaction(e,this),s===n.C.OPTIONS)e.reply(200,null,["Allow: "+n.Utils.getAllowedMethods(this),"Accept: "+r.ACCEPTED_BODY_TYPES]);else if(s===n.C.MESSAGE){if(!this.checkEvent("newMessage")||0===this.listeners("newMessage").length)return void e.reply(405,null,["Allow: "+n.Utils.getAllowedMethods(this)]);o=new n.Message(this),o.init_incoming(e)}if(e.to_tag)t=this.findDialog(e),t?t.receiveRequest(e):s===n.C.NOTIFY?(i=this.findSession(e),i?i.receiveRequest(e):(Plivo.logNull(l+"received NOTIFY request for a non existent session"),e.reply(481,"Subscription does not exist"))):s!==n.C.ACK&&e.reply(481);else{if(!this.isRegistered())return void e.reply(410);switch(s){case n.C.INVITE:n.WebRTC.isSupported?(i=new n.RTCSession(this),i.init_incoming(e)):(Plivo.logNull(l+"INVITE received but WebRTC is not supported"),e.reply(488));break;case n.C.BYE:e.reply(481);break;case n.C.CANCEL:e.reply(200),i=this.findSession(e),i?i.receiveRequest(e):Plivo.logNull(l+"received CANCEL request for a non existent session");break;case n.C.ACK:break;default:e.reply(405)}}}},t.prototype.findSession=function(e){var n=e.call_id+e.from_tag,t=this.sessions[n],l=e.call_id+e.to_tag,r=this.sessions[l];return t?t:r?r:null},t.prototype.findDialog=function(e){var n=e.call_id+e.from_tag+e.to_tag,t=this.dialogs[n];return t?t:(n=e.call_id+e.to_tag+e.from_tag,t=this.dialogs[n],t?t:null)},t.prototype.getNextWsServer=function(){var e,t,l,r=[];for(t=this.configuration.ws_servers.length,e=0;t>e;e++)l=this.configuration.ws_servers[e],l.status!==n.Transport.C.STATUS_ERROR&&(0===r.length?r.push(l):l.weight>r[0].weight?r=[l]:l.weight===r[0].weight&&r.push(l));return e=Math.floor(Math.random()*r.length),r[e]},t.prototype.closeSessionsOnTransportError=function(){var e;for(e in this.sessions)this.sessions[e].onTransportError();this.registrator&&this.registrator.onTransportClosed()},t.prototype.recoverTransport=function(t){var r,i,o,s,u,a;for(t=t||this,u=t.transportRecoverAttempts,i=t.configuration.ws_servers.length,r=0;i>r;r++)t.configuration.ws_servers[r].status=0;a=t.getNextWsServer(),o=Math.floor(Math.random()*Math.pow(2,u)+1),s=o*t.configuration.connection_recovery_min_interval,s>t.configuration.connection_recovery_max_interval&&(Plivo.logNull(l+"time for next connection attempt exceeds connection_recovery_max_interval, resetting counter"),s=t.configuration.connection_recovery_min_interval,u=0),Plivo.logNull(l+"next connection attempt in "+s+" seconds"),e.setTimeout(function(){t.transportRecoverAttempts=u+1,new n.Transport(t,a)},1e3*s)},t.prototype.loadConfig=function(r){var i,o,s,u,a,c={via_host:n.Utils.createRandomToken(12)+".invalid",password:null,register_expires:120,register_min_expires:60,register:!0,registrar_server:null,ws_server_max_reconnection:3,ws_server_reconnection_timeout:4,connection_recovery_min_interval:2,connection_recovery_max_interval:30,use_preloaded_route:!1,no_answer_timeout:60,stun_servers:["stun:stun.l.google.com:19302"],turn_servers:[],trace_sip:!1,hack_via_tcp:!1,hack_ip_in_contact:!1};for(i in t.configuration_check.mandatory){if(!r.hasOwnProperty(i))throw new n.Exceptions.ConfigurationError(i);if(o=r[i],s=t.configuration_check.mandatory[i](o),void 0===s)throw new n.Exceptions.ConfigurationError(i,o);c[i]=s}for(i in t.configuration_check.optional)if(r.hasOwnProperty(i)){if(o=r[i],null===o||""===o||void 0===o)continue;if("number"==typeof o&&e.isNaN(o))continue;if(s=t.configuration_check.optional[i](o),void 0===s)throw new n.Exceptions.ConfigurationError(i,o);c[i]=s}if(c.connection_recovery_max_interval<c.connection_recovery_min_interval)throw new n.Exceptions.ConfigurationError("connection_recovery_max_interval",c.connection_recovery_max_interval);0===c.display_name&&(c.display_name="0"),c.instance_id=n.Utils.newUUID(),c.websdk_id=n.Utils.createRandomToken(5),u=c.uri.clone(),u.user=null,c.hostport_params=u.toString().replace(/^sip:/i,""),c.authorization_user||(c.authorization_user=c.uri.user),c.registrar_server||(a=c.uri.clone(),a.user=null,c.registrar_server=a),c.no_answer_timeout=1e3*c.no_answer_timeout,c.hack_ip_in_contact&&(c.via_host=n.Utils.getRandomTestNetIP()),this.contact={pub_gruu:null,temp_gruu:null,uri:new n.URI("sip",n.Utils.createRandomToken(8),c.via_host,null,{transport:"ws"}),toString:function(e){e=e||{};var n=e.anonymous||null,t=e.outbound||null,l="<";return l+=n?this.temp_gruu||"sip:anonymous@anonymous.invalid;transport=ws":this.pub_gruu||this.uri.toString(),t&&(l+=";ob"),l+=">"}},Plivo.logNull(l+"configuration parameters after validation:");for(i in c){switch(i){case"uri":case"registrar_server":Plivo.logNull(" "+i+": "+c[i]);break;case"password":Plivo.logNull(" "+i+": NOT SHOWN");break;default:Plivo.logNull(" "+i+": "+e.JSON.stringify(c[i]))}t.configuration_skeleton[i].value=c[i]}Object.defineProperties(this.configuration,t.configuration_skeleton);for(i in c)t.configuration_skeleton[i].value=""},t.configuration_skeleton=function(){var e,n,t={},l=["instance_id","websdk_id","register_min_expires","ws_server_max_reconnection","ws_server_reconnection_timeout","hostport_params","uri","ws_servers","authorization_user","connection_recovery_max_interval","connection_recovery_min_interval","display_name","hack_via_tcp","hack_ip_in_contact","no_answer_timeout","password","register_expires","registrar_server","stun_servers","trace_sip","turn_servers","use_preloaded_route","via_core_value","via_host"];for(e in l)n=l[e],t[n]={value:"",writable:!1,configurable:!1};return t.register={value:"",writable:!0,configurable:!1},t}(),t.configuration_check={mandatory:{uri:function(e){var t;return/^sip:/i.test(e)||(e=n.C.SIP+":"+e),t=n.URI.parse(e),t&&t.user?t:void 0},ws_servers:function(e){var t,r,i;if("string"==typeof e)e=[{ws_uri:e}];else{if(!(e instanceof Array))return;for(r=e.length,t=0;r>t;t++)"string"==typeof e[t]&&(e[t]={ws_uri:e[t]})}if(0===e.length)return!1;for(r=e.length,t=0;r>t;t++){if(!e[t].ws_uri)return void Plivo.logNull(l+'missing "ws_uri" attribute in ws_servers parameter');if(e[t].weight&&!Number(e[t].weight))return void Plivo.logNull(l+'"weight" attribute in ws_servers parameter must be a Number');if(i=n.Grammar.parse(e[t].ws_uri,"absoluteURI"),-1===i)return void Plivo.logNull(l+'invalid "ws_uri" attribute in ws_servers parameter: '+e[t].ws_uri);if("wss"!==i.scheme&&"ws"!==i.scheme)return void Plivo.logNull(l+"invalid URI scheme in ws_servers parameter: "+i.scheme);e[t].sip_uri="<sip:"+i.host+(i.port?":"+i.port:"")+";transport=ws;lr>",e[t].weight||(e[t].weight=0),e[t].status=0,e[t].scheme=i.scheme.toUpperCase()}return e}},optional:{authorization_user:function(e){return-1===n.Grammar.parse('"'+e+'"',"quoted_string")?void 0:e},connection_recovery_max_interval:function(t){var l;return n.Utils.isDecimal(t)&&(l=e.Number(t),l>0)?l:void 0},connection_recovery_min_interval:function(t){var l;return n.Utils.isDecimal(t)&&(l=e.Number(t),l>0)?l:void 0},display_name:function(e){return-1===n.Grammar.parse('"'+e+'"',"display_name")?void 0:e},hack_via_tcp:function(e){return"boolean"==typeof e?e:void 0},hack_ip_in_contact:function(e){return"boolean"==typeof e?e:void 0},no_answer_timeout:function(t){var l;return n.Utils.isDecimal(t)&&(l=e.Number(t),l>0)?l:void 0},password:function(e){return String(e)},register:function(e){return"boolean"==typeof e?e:void 0},register_expires:function(t){var l;return n.Utils.isDecimal(t)&&(l=e.Number(t),l>0)?l:void 0},registrar_server:function(e){var t;return/^sip:/i.test(e)||(e=n.C.SIP+":"+e),t=n.URI.parse(e),t?t.user?void 0:t:void 0},stun_servers:function(e){var t,l,r;if("string"==typeof e)e=[e];else if(!(e instanceof Array))return;for(l=e.length,t=0;l>t;t++){if(r=e[t],/^stuns?:/.test(r)||(r="stun:"+r),-1===n.Grammar.parse(r,"stun_URI"))return;e[t]=r}return e},trace_sip:function(e){return"boolean"==typeof e?e:void 0},turn_servers:function(e){var t,l,r;for(e instanceof Array||(e=[e]),l=e.length,t=0;l>t;t++){if(r=e[t],!(r.server&&r.username&&r.password))return;if(/^turns?:/.test(r.server)||(r.server="turn:"+r.server),-1===n.Grammar.parse(r.server,"turn_URI"))return;if(-1===n.Grammar.parse(r.username,"user"))return;if(-1===n.Grammar.parse(r.password,"password"))return}return e},use_preloaded_route:function(e){return"boolean"==typeof e?e:void 0}}},t.C=r,n.UA=t}(n),function(n){var t;t={str_utf8_length:function(n){return e.unescape(encodeURIComponent(n)).length},isFunction:function(e){return void 0!==e&&"[object Function]"===Object.prototype.toString.call(e)},isDecimal:function(e){return!isNaN(e)&&parseFloat(e)===parseInt(e,10)},createRandomToken:function(e,n){var t,l,r="";for(n=n||32,t=0;e>t;t++)l=Math.random()*n|0,r+=l.toString(n);return r},newTag:function(){return n.Utils.createRandomToken(n.UA.C.TAG_LENGTH)},newUUID:function(){var e="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var n=16*Math.random()|0,t="x"===e?n:3&n|8;return t.toString(16)});return e},hostType:function(e){return e?(e=n.Grammar.parse(e,"host"),-1!==e?e.host_type:void 0):void 0},normalizeURI:function(e,t){var l,r,i,o,s=e;if(e){if(e instanceof n.URI)return e;if("string"==typeof e){switch(r=e.split("@"),r.length){case 1:if(!t)throw new n.Exceptions.InvalidTargetError(s);i=e,o=t;break;case 2:i=r[0],o=r[1];break;default:i=r.slice(0,r.length-1).join("@"),o=r[r.length-1]}if(i=i.replace(/^(sips?|tel):/i,""),/^[\-\.\(\)]*\+?[0-9\-\.\(\)]+$/.test(i)&&(i=i.replace(/[\-\.\(\)]/g,"")),e=n.C.SIP+":"+n.Utils.escapeUser(i)+"@"+o,l=n.URI.parse(e))return l;throw new n.Exceptions.InvalidTargetError(s)}throw new n.Exceptions.InvalidTargetError(s)}throw new n.Exceptions.InvalidTargetError(s)},escapeUser:function(n){return e.encodeURIComponent(e.decodeURIComponent(n)).replace(/%3A/gi,":").replace(/%2B/gi,"+").replace(/%3F/gi,"?").replace(/%2F/gi,"/")},headerize:function(e){var n,t={"Call-Id":"Call-ID",Cseq:"CSeq","Www-Authenticate":"WWW-Authenticate"},l=e.toLowerCase().replace(/_/g,"-").split("-"),r="",i=l.length;for(n=0;i>n;n++)0!==n&&(r+="-"),r+=l[n].charAt(0).toUpperCase()+l[n].substring(1);return t[r]&&(r=t[r]),r},sipErrorCause:function(e){var t;for(t in n.C.SIP_ERROR_CAUSES)if(-1!==n.C.SIP_ERROR_CAUSES[t].indexOf(e))return n.C.causes[t];return n.C.causes.SIP_FAILURE_CODE},getRandomTestNetIP:function(){function n(n,t){return e.Math.floor(e.Math.random()*(t-n+1)+n)}return"192.0.2."+n(1,254)},getAllowedMethods:function(e){var t,l=n.UA.C.ALLOWED_METHODS.toString();for(t in n.UA.C.EVENT_METHODS)e.checkEvent(t)&&e.listeners(t).length>0&&(l+=","+n.UA.C.EVENT_METHODS[t]);return l},calculateMD5:function(e){function n(e,n){return e<<n|e>>>32-n}function t(e,n){var t,l,r,i,o;return r=2147483648&e,i=2147483648&n,t=1073741824&e,l=1073741824&n,o=(1073741823&e)+(1073741823&n),t&l?2147483648^o^r^i:t|l?1073741824&o?3221225472^o^r^i:1073741824^o^r^i:o^r^i}function l(e,n,t){return e&n|~e&t}function r(e,n,t){return e&t|n&~t}function i(e,n,t){return e^n^t}function o(e,n,t){return n^(e|~t)}function s(e,r,i,o,s,u,a){return e=t(e,t(t(l(r,i,o),s),a)),t(n(e,u),r)}function u(e,l,i,o,s,u,a){return e=t(e,t(t(r(l,i,o),s),a)),t(n(e,u),l)}function a(e,l,r,o,s,u,a){return e=t(e,t(t(i(l,r,o),s),a)),t(n(e,u),l)}function c(e,l,r,i,s,u,a){return e=t(e,t(t(o(l,r,i),s),a)),t(n(e,u),l)}function h(e){for(var n,t=e.length,l=t+8,r=(l-l%64)/64,i=16*(r+1),o=Array(i-1),s=0,u=0;t>u;)n=(u-u%4)/4,s=u%4*8,o[n]=o[n]|e.charCodeAt(u)<<s,u++;return n=(u-u%4)/4,s=u%4*8,o[n]=o[n]|128<<s,o[i-2]=t<<3,o[i-1]=t>>>29,o}function d(e){var n,t,l="",r="";for(t=0;3>=t;t++)n=e>>>8*t&255,r="0"+n.toString(16),l+=r.substr(r.length-2,2);return l}function f(e){e=e.replace(/\r\n/g,"\n");for(var n="",t=0;t<e.length;t++){var l=e.charCodeAt(t);128>l?n+=String.fromCharCode(l):l>127&&2048>l?(n+=String.fromCharCode(l>>6|192),n+=String.fromCharCode(63&l|128)):(n+=String.fromCharCode(l>>12|224),n+=String.fromCharCode(l>>6&63|128),n+=String.fromCharCode(63&l|128))}return n}var p,g,v,m,_,T,C,A,S,E=[],y=7,b=12,w=17,R=22,I=5,P=9,N=14,D=20,U=4,O=11,M=16,L=23,x=6,F=10,k=15,q=21;for(e=f(e),E=h(e),T=1732584193,C=4023233417,A=2562383102,S=271733878,p=0;p<E.length;p+=16)g=T,v=C,m=A,_=S,T=s(T,C,A,S,E[p+0],y,3614090360),S=s(S,T,C,A,E[p+1],b,3905402710),A=s(A,S,T,C,E[p+2],w,606105819),C=s(C,A,S,T,E[p+3],R,3250441966),T=s(T,C,A,S,E[p+4],y,4118548399),S=s(S,T,C,A,E[p+5],b,1200080426),A=s(A,S,T,C,E[p+6],w,2821735955),C=s(C,A,S,T,E[p+7],R,4249261313),T=s(T,C,A,S,E[p+8],y,1770035416),S=s(S,T,C,A,E[p+9],b,2336552879),A=s(A,S,T,C,E[p+10],w,4294925233),C=s(C,A,S,T,E[p+11],R,2304563134),T=s(T,C,A,S,E[p+12],y,1804603682),S=s(S,T,C,A,E[p+13],b,4254626195),A=s(A,S,T,C,E[p+14],w,2792965006),C=s(C,A,S,T,E[p+15],R,1236535329),T=u(T,C,A,S,E[p+1],I,4129170786),S=u(S,T,C,A,E[p+6],P,3225465664),A=u(A,S,T,C,E[p+11],N,643717713),C=u(C,A,S,T,E[p+0],D,3921069994),T=u(T,C,A,S,E[p+5],I,3593408605),S=u(S,T,C,A,E[p+10],P,38016083),A=u(A,S,T,C,E[p+15],N,3634488961),C=u(C,A,S,T,E[p+4],D,3889429448),T=u(T,C,A,S,E[p+9],I,568446438),S=u(S,T,C,A,E[p+14],P,3275163606),A=u(A,S,T,C,E[p+3],N,4107603335),C=u(C,A,S,T,E[p+8],D,1163531501),T=u(T,C,A,S,E[p+13],I,2850285829),S=u(S,T,C,A,E[p+2],P,4243563512),A=u(A,S,T,C,E[p+7],N,1735328473),C=u(C,A,S,T,E[p+12],D,2368359562),T=a(T,C,A,S,E[p+5],U,4294588738),S=a(S,T,C,A,E[p+8],O,2272392833),A=a(A,S,T,C,E[p+11],M,1839030562),C=a(C,A,S,T,E[p+14],L,4259657740),T=a(T,C,A,S,E[p+1],U,2763975236),S=a(S,T,C,A,E[p+4],O,1272893353),A=a(A,S,T,C,E[p+7],M,4139469664),C=a(C,A,S,T,E[p+10],L,3200236656),T=a(T,C,A,S,E[p+13],U,681279174),S=a(S,T,C,A,E[p+0],O,3936430074),A=a(A,S,T,C,E[p+3],M,3572445317),C=a(C,A,S,T,E[p+6],L,76029189),T=a(T,C,A,S,E[p+9],U,3654602809),S=a(S,T,C,A,E[p+12],O,3873151461),A=a(A,S,T,C,E[p+15],M,530742520),C=a(C,A,S,T,E[p+2],L,3299628645),T=c(T,C,A,S,E[p+0],x,4096336452),S=c(S,T,C,A,E[p+7],F,1126891415),A=c(A,S,T,C,E[p+14],k,2878612391),C=c(C,A,S,T,E[p+5],q,4237533241),T=c(T,C,A,S,E[p+12],x,1700485571),S=c(S,T,C,A,E[p+3],F,2399980690),A=c(A,S,T,C,E[p+10],k,4293915773),C=c(C,A,S,T,E[p+1],q,2240044497),T=c(T,C,A,S,E[p+8],x,1873313359),S=c(S,T,C,A,E[p+15],F,4264355552),A=c(A,S,T,C,E[p+6],k,2734768916),C=c(C,A,S,T,E[p+13],q,1309151649),T=c(T,C,A,S,E[p+4],x,4149444226),S=c(S,T,C,A,E[p+11],F,3174756917),A=c(A,S,T,C,E[p+2],k,718787259),C=c(C,A,S,T,E[p+9],q,3951481745),T=t(T,g),C=t(C,v),A=t(A,m),S=t(S,_);var B=d(T)+d(C)+d(A)+d(S);return B.toLowerCase()}},n.Utils=t}(n),function(e){function n(){return"sip"!==h.s("to").uri.scheme?(a(416),!1):void 0}function t(){return h.to_tag||h.call_id.substr(0,5)!==d.configuration.websdk_id?void 0:(a(482),!1)}function l(){var n=e.Utils.str_utf8_length(h.body),t=h.getHeader("content-length");return t>n?(a(400),!1):void 0}function r(){var n,t,l=h.from_tag,r=h.call_id,i=h.cseq;if(!h.to_tag)if(h.method===e.C.INVITE){if(n=d.transactions.ist[h.via_branch],!n)return;for(t in d.transactions.ist)if(n=d.transactions.ist[t],n.request.from_tag===l&&n.request.call_id===r&&n.request.cseq===i)return a(482),!1}else{if(n=d.transactions.nist[h.via_branch],!n)return;for(t in d.transactions.nist)if(n=d.transactions.nist[t],n.request.from_tag===l&&n.request.call_id===r&&n.request.cseq===i)return a(482),!1}}function i(){return h.countHeader("via")>1?(Plivo.logNull(p+"More than one Via header field present in the response. Dropping the response"),!1):void 0}function o(){var e=d.configuration.via_host;return h.via.host!==e?(Plivo.logNull(p+"Via host in the response does not match UA Via host value. Dropping the response"),!1):void 0}function s(){var n=e.Utils.str_utf8_length(h.body),t=h.getHeader("content-length");return t>n?(Plivo.logNull(p+"Message body length is lower than the value in Content-Length header field. Dropping the response"),!1):void 0}function u(){for(var e=["from","to","call_id","cseq","via"],n=e.length;n--;)if(!h.hasHeader(e[n]))return Plivo.logNull(p+"Missing mandatory header field : "+e[n]+". Dropping the response"),!1}function a(n){var t,l="SIP/2.0 "+n+" "+e.C.REASON_PHRASE[n]+"\r\n",r=h.countHeader("via"),i=0;for(i;r>i;i++)l+="Via: "+h.getHeader("via",i)+"\r\n";t=h.getHeader("To"),h.to_tag||(t+=";tag="+e.Utils.newTag()),l+="To: "+t+"\r\n",l+="From: "+h.getHeader("From")+"\r\n",l+="Call-ID: "+h.call_id+"\r\n",l+="CSeq: "+h.cseq+" "+h.method+"\r\n",l+="\r\n",f.send(l)}var c,h,d,f,p=e.name+" | SANITY CHECK | ",g=[],v=[],m=[];g.push(n),g.push(t),g.push(l),g.push(r),v.push(i),v.push(o),v.push(s),m.push(u),c=function(n,t,l){var r,i;for(h=n,d=t,f=l,r=m.length;r--;)if(i=m[r](h),i===!1)return!1;if(h instanceof e.IncomingRequest){for(r=g.length;r--;)if(i=g[r](h),i===!1)return!1}else if(h instanceof e.IncomingResponse)for(r=v.length;r--;)if(i=v[r](h),i===!1)return!1;return!0},e.sanityCheck=c}(n),function(e){var n,t=e.name+" | DIGEST AUTHENTICATION | ";n=function(e){this.username=e.configuration.authorization_user,this.password=e.configuration.password,this.cnonce=null,this.nc=0,this.ncHex="00000000",this.response=null},n.prototype.authenticate=function(n,l){if(this.algorithm=l.algorithm,this.realm=l.realm,this.nonce=l.nonce,this.opaque=l.opaque,this.stale=l.stale,this.algorithm){if("MD5"!==this.algorithm)return Plivo.logNull(t+'challenge with Digest algorithm different than "MD5", authentication aborted'),!1}else this.algorithm="MD5";if(!this.realm)return Plivo.logNull(t+"challenge without Digest realm, authentication aborted"),!1;if(!this.nonce)return Plivo.logNull(t+"challenge without Digest nonce, authentication aborted"),!1;if(l.qop)if(l.qop.indexOf("auth")>-1)this.qop="auth";else{if(!(l.qop.indexOf("auth-int")>-1))return Plivo.logNull(t+'challenge without Digest qop different than "auth" or "auth-int", authentication aborted'),!1;this.qop="auth-int"}else this.qop=null;return this.method=n.method,this.uri=n.ruri,this.cnonce=e.Utils.createRandomToken(12),this.nc+=1,this.updateNcHex(),4294967296===this.nc&&(this.nc=1,this.ncHex="00000001"),this.calculateResponse(),!0},n.prototype.calculateResponse=function(){var n,t;n=e.Utils.calculateMD5(this.username+":"+this.realm+":"+this.password),"auth"===this.qop?(t=e.Utils.calculateMD5(this.method+":"+this.uri),this.response=e.Utils.calculateMD5(n+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth:"+t)):"auth-int"===this.qop?(t=e.Utils.calculateMD5(this.method+":"+this.uri+":"+e.Utils.calculateMD5(this.body?this.body:"")),this.response=e.Utils.calculateMD5(n+":"+this.nonce+":"+this.ncHex+":"+this.cnonce+":auth-int:"+t)):null===this.qop&&(t=e.Utils.calculateMD5(this.method+":"+this.uri),this.response=e.Utils.calculateMD5(n+":"+this.nonce+":"+t))},n.prototype.toString=function(){var e=[];if(!this.response)throw new Error("response field does not exist, cannot generate Authorization header");return e.push("algorithm="+this.algorithm),e.push('username="'+this.username+'"'),e.push('realm="'+this.realm+'"'),e.push('nonce="'+this.nonce+'"'),e.push('uri="'+this.uri+'"'),e.push('response="'+this.response+'"'),this.opaque&&e.push('opaque="'+this.opaque+'"'),this.qop&&(e.push("qop="+this.qop),e.push('cnonce="'+this.cnonce+'"'),e.push("nc="+this.ncHex)),"Digest "+e.join(", ")},n.prototype.updateNcHex=function(){var e=Number(this.nc).toString(16);this.ncHex="00000000".substr(0,8-e.length)+e},e.DigestAuthentication=n}(n),function(n){var t;t={},e.navigator.webkitGetUserMedia?t.getUserMedia=e.navigator.webkitGetUserMedia.bind(navigator):e.navigator.mozGetUserMedia?t.getUserMedia=e.navigator.mozGetUserMedia.bind(navigator):e.navigator.getUserMedia&&(t.getUserMedia=e.navigator.getUserMedia.bind(navigator)),e.webkitRTCPeerConnection?t.RTCPeerConnection=e.webkitRTCPeerConnection:e.mozRTCPeerConnection?t.RTCPeerConnection=e.mozRTCPeerConnection:e.RTCPeerConnection&&(t.RTCPeerConnection=e.RTCPeerConnection),e.webkitRTCSessionDescription?t.RTCSessionDescription=e.webkitRTCSessionDescription:e.mozRTCSessionDescription?t.RTCSessionDescription=e.mozRTCSessionDescription:e.RTCSessionDescription&&(t.RTCSessionDescription=e.RTCSessionDescription),t.RTCPeerConnection&&t.RTCPeerConnection.prototype&&(t.RTCPeerConnection.prototype.getLocalStreams||(t.RTCPeerConnection.prototype.getLocalStreams=function(){return this.localStreams},t.RTCPeerConnection.prototype.getRemoteStreams=function(){return this.remoteStreams})),t.isSupported=!!(t.getUserMedia&&t.RTCPeerConnection&&t.RTCSessionDescription),n.WebRTC=t}(n),e.WebSDK=n}(window),WebSDK.Grammar=function(){function e(e){return'"'+e.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\x08/g,"\\b").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\f/g,"\\f").replace(/\r/g,"\\r").replace(/[\x00-\x07\x0B\x0E-\x1F\x80-\uFFFF]/g,escape)+'"'}var n={parse:function(n,t){function l(e){ol>rl||(rl>ol&&(ol=rl,sl=[]),sl.push(e))}function r(){var e;return"\r\n"===n.substr(rl,2)?(e="\r\n",rl+=2):(e=null,0===il&&l('"\\r\\n"')),e}function i(){var e;return/^[0-9]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[0-9]")),e}function o(){var e;return/^[a-zA-Z]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[a-zA-Z]")),e}function s(){var e;return/^[0-9a-fA-F]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[0-9a-fA-F]")),e}function u(){var e;return e=h(),null===e&&(e=d()),e}function a(){var e;return/^[\0-\xFF]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[\\0-\\xFF]")),e}function c(){var e;return/^["]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l('["]')),e}function h(){var e;return 32===n.charCodeAt(rl)?(e=" ",rl++):(e=null,0===il&&l('" "')),e}function d(){var e;return 9===n.charCodeAt(rl)?(e="	",rl++):(e=null,0===il&&l('"\\t"')),e}function f(){var e;return/^[a-zA-Z0-9]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[a-zA-Z0-9]")),e}function p(){var e;return 59===n.charCodeAt(rl)?(e=";",rl++):(e=null,0===il&&l('";"')),null===e&&(47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"')),null===e&&(63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(64===n.charCodeAt(rl)?(e="@",rl++):(e=null,0===il&&l('"@"')),null===e&&(38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","'))))))))))),e}function g(){var e;return e=f(),null===e&&(e=v()),e}function v(){var e;return 45===n.charCodeAt(rl)?(e="-",rl++):(e=null,0===il&&l('"-"')),null===e&&(95===n.charCodeAt(rl)?(e="_",rl++):(e=null,0===il&&l('"_"')),null===e&&(46===n.charCodeAt(rl)?(e=".",rl++):(e=null,0===il&&l('"."')),null===e&&(33===n.charCodeAt(rl)?(e="!",rl++):(e=null,0===il&&l('"!"')),
null===e&&(126===n.charCodeAt(rl)?(e="~",rl++):(e=null,0===il&&l('"~"')),null===e&&(42===n.charCodeAt(rl)?(e="*",rl++):(e=null,0===il&&l('"*"')),null===e&&(39===n.charCodeAt(rl)?(e="'",rl++):(e=null,0===il&&l('"\'"')),null===e&&(40===n.charCodeAt(rl)?(e="(",rl++):(e=null,0===il&&l('"("')),null===e&&(41===n.charCodeAt(rl)?(e=")",rl++):(e=null,0===il&&l('")"')))))))))),e}function m(){var e,t,r,i;return i=rl,37===n.charCodeAt(rl)?(e="%",rl++):(e=null,0===il&&l('"%"')),null!==e?(t=s(),null!==t?(r=s(),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function _(){var e,n,t,l,i,o;for(l=rl,i=rl,o=rl,e=[],n=u();null!==n;)e.push(n),n=u();if(null!==e?(n=r(),null!==n?e=[e,n]:(e=null,rl=o)):(e=null,rl=o),e=null!==e?e:"",null!==e){if(t=u(),null!==t)for(n=[];null!==t;)n.push(t),t=u();else n=null;null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(){return" "}(l)),null===e&&(rl=l),e}function T(){var e;return e=_(),e=null!==e?e:""}function C(){var e,t,r,i,o;for(i=rl,o=rl,e=[],t=h(),null===t&&(t=d());null!==t;)e.push(t),t=h(),null===t&&(t=d());return null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return":"}(i)),null===e&&(rl=i),e}function A(){var e,t,l,r,i,o,s;if(i=rl,o=rl,t=S(),null!==t)for(e=[];null!==t;)e.push(t),t=S();else e=null;if(null!==e){for(t=[],s=rl,l=[],r=_();null!==r;)l.push(r),r=_();for(null!==l?(r=S(),null!==r?l=[l,r]:(l=null,rl=s)):(l=null,rl=s);null!==l;){for(t.push(l),s=rl,l=[],r=_();null!==r;)l.push(r),r=_();null!==l?(r=S(),null!==r?l=[l,r]:(l=null,rl=s)):(l=null,rl=s)}null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return null!==e&&(e=function(e){return n.substring(rl,e)}(i)),null===e&&(rl=i),e}function S(){var e;return/^[!-~]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[!-~]")),null===e&&(e=E()),e}function E(){var e;return/^[\x80-\uFFFF]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[\\x80-\\uFFFF]")),e}function y(){var e;return/^[\x80-\xBF]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[\\x80-\\xBF]")),e}function b(){var e;return e=i(),null===e&&(/^[a-f]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[a-f]"))),e}function w(){var e,t,r;if(r=rl,t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"')))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"'))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(rl,e)}(r)),null===e&&(rl=r),e}function R(){var e,t,r;if(r=rl,t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"')))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(rl,e)}(r)),null===e&&(rl=r),e}function I(){var e;return 40===n.charCodeAt(rl)?(e="(",rl++):(e=null,0===il&&l('"("')),null===e&&(41===n.charCodeAt(rl)?(e=")",rl++):(e=null,0===il&&l('")"')),null===e&&(60===n.charCodeAt(rl)?(e="<",rl++):(e=null,0===il&&l('"<"')),null===e&&(62===n.charCodeAt(rl)?(e=">",rl++):(e=null,0===il&&l('">"')),null===e&&(64===n.charCodeAt(rl)?(e="@",rl++):(e=null,0===il&&l('"@"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","')),null===e&&(59===n.charCodeAt(rl)?(e=";",rl++):(e=null,0===il&&l('";"')),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(92===n.charCodeAt(rl)?(e="\\",rl++):(e=null,0===il&&l('"\\\\"')),null===e&&(e=c(),null===e&&(47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"')),null===e&&(91===n.charCodeAt(rl)?(e="[",rl++):(e=null,0===il&&l('"["')),null===e&&(93===n.charCodeAt(rl)?(e="]",rl++):(e=null,0===il&&l('"]"')),null===e&&(63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')),null===e&&(123===n.charCodeAt(rl)?(e="{",rl++):(e=null,0===il&&l('"{"')),null===e&&(125===n.charCodeAt(rl)?(e="}",rl++):(e=null,0===il&&l('"}"')),null===e&&(e=h(),null===e&&(e=d())))))))))))))))))),e}function P(){var e,t,r;if(r=rl,t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"')),null===t&&(40===n.charCodeAt(rl)?(t="(",rl++):(t=null,0===il&&l('"("')),null===t&&(41===n.charCodeAt(rl)?(t=")",rl++):(t=null,0===il&&l('")"')),null===t&&(60===n.charCodeAt(rl)?(t="<",rl++):(t=null,0===il&&l('"<"')),null===t&&(62===n.charCodeAt(rl)?(t=">",rl++):(t=null,0===il&&l('">"')),null===t&&(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null===t&&(92===n.charCodeAt(rl)?(t="\\",rl++):(t=null,0===il&&l('"\\\\"')),null===t&&(t=c(),null===t&&(47===n.charCodeAt(rl)?(t="/",rl++):(t=null,0===il&&l('"/"')),null===t&&(91===n.charCodeAt(rl)?(t="[",rl++):(t=null,0===il&&l('"["')),null===t&&(93===n.charCodeAt(rl)?(t="]",rl++):(t=null,0===il&&l('"]"')),null===t&&(63===n.charCodeAt(rl)?(t="?",rl++):(t=null,0===il&&l('"?"')),null===t&&(123===n.charCodeAt(rl)?(t="{",rl++):(t=null,0===il&&l('"{"')),null===t&&(125===n.charCodeAt(rl)?(t="}",rl++):(t=null,0===il&&l('"}"'))))))))))))))))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=f(),null===t&&(45===n.charCodeAt(rl)?(t="-",rl++):(t=null,0===il&&l('"-"')),null===t&&(46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null===t&&(33===n.charCodeAt(rl)?(t="!",rl++):(t=null,0===il&&l('"!"')),null===t&&(37===n.charCodeAt(rl)?(t="%",rl++):(t=null,0===il&&l('"%"')),null===t&&(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null===t&&(95===n.charCodeAt(rl)?(t="_",rl++):(t=null,0===il&&l('"_"')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(96===n.charCodeAt(rl)?(t="`",rl++):(t=null,0===il&&l('"`"')),null===t&&(39===n.charCodeAt(rl)?(t="'",rl++):(t=null,0===il&&l('"\'"')),null===t&&(126===n.charCodeAt(rl)?(t="~",rl++):(t=null,0===il&&l('"~"')),null===t&&(40===n.charCodeAt(rl)?(t="(",rl++):(t=null,0===il&&l('"("')),null===t&&(41===n.charCodeAt(rl)?(t=")",rl++):(t=null,0===il&&l('")"')),null===t&&(60===n.charCodeAt(rl)?(t="<",rl++):(t=null,0===il&&l('"<"')),null===t&&(62===n.charCodeAt(rl)?(t=">",rl++):(t=null,0===il&&l('">"')),null===t&&(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null===t&&(92===n.charCodeAt(rl)?(t="\\",rl++):(t=null,0===il&&l('"\\\\"')),null===t&&(t=c(),null===t&&(47===n.charCodeAt(rl)?(t="/",rl++):(t=null,0===il&&l('"/"')),null===t&&(91===n.charCodeAt(rl)?(t="[",rl++):(t=null,0===il&&l('"["')),null===t&&(93===n.charCodeAt(rl)?(t="]",rl++):(t=null,0===il&&l('"]"')),null===t&&(63===n.charCodeAt(rl)?(t="?",rl++):(t=null,0===il&&l('"?"')),null===t&&(123===n.charCodeAt(rl)?(t="{",rl++):(t=null,0===il&&l('"{"')),null===t&&(125===n.charCodeAt(rl)?(t="}",rl++):(t=null,0===il&&l('"}"')))))))))))))))))))))))));else e=null;return null!==e&&(e=function(e){return n.substring(rl,e)}(r)),null===e&&(rl=r),e}function N(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(42===n.charCodeAt(rl)?(t="*",rl++):(t=null,0===il&&l('"*"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return"*"}(i)),null===e&&(rl=i),e}function D(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(47===n.charCodeAt(rl)?(t="/",rl++):(t=null,0===il&&l('"/"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return"/"}(i)),null===e&&(rl=i),e}function U(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return"="}(i)),null===e&&(rl=i),e}function O(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(40===n.charCodeAt(rl)?(t="(",rl++):(t=null,0===il&&l('"("')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return"("}(i)),null===e&&(rl=i),e}function M(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(41===n.charCodeAt(rl)?(t=")",rl++):(t=null,0===il&&l('")"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return")"}(i)),null===e&&(rl=i),e}function L(){var e,t,r,i;return r=rl,i=rl,62===n.charCodeAt(rl)?(e=">",rl++):(e=null,0===il&&l('">"')),null!==e?(t=T(),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(){return">"}(r)),null===e&&(rl=r),e}function x(){var e,t,r,i;return r=rl,i=rl,e=T(),null!==e?(60===n.charCodeAt(rl)?(t="<",rl++):(t=null,0===il&&l('"<"')),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(){return"<"}(r)),null===e&&(rl=r),e}function F(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(44===n.charCodeAt(rl)?(t=",",rl++):(t=null,0===il&&l('","')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return","}(i)),null===e&&(rl=i),e}function k(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(59===n.charCodeAt(rl)?(t=";",rl++):(t=null,0===il&&l('";"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return";"}(i)),null===e&&(rl=i),e}function q(){var e,t,r,i,o;return i=rl,o=rl,e=T(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=T(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){return":"}(i)),null===e&&(rl=i),e}function B(){var e,n,t,l;return t=rl,l=rl,e=T(),null!==e?(n=c(),null!==n?e=[e,n]:(e=null,rl=l)):(e=null,rl=l),null!==e&&(e=function(){return'"'}(t)),null===e&&(rl=t),e}function H(){var e,n,t,l;return t=rl,l=rl,e=c(),null!==e?(n=T(),null!==n?e=[e,n]:(e=null,rl=l)):(e=null,rl=l),null!==e&&(e=function(){return'"'}(t)),null===e&&(rl=t),e}function G(){var e,n,t,l;if(l=rl,e=O(),null!==e){for(n=[],t=V(),null===t&&(t=K(),null===t&&(t=G()));null!==t;)n.push(t),t=V(),null===t&&(t=K(),null===t&&(t=G()));null!==n?(t=M(),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)}else e=null,rl=l;return e}function V(){var e;return/^[!-']/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[!-']")),null===e&&(/^[*-[]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[*-[]")),null===e&&(/^[\]-~]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[\\]-~]")),null===e&&(e=E(),null===e&&(e=_())))),e}function W(){var e,t,l,r,i,o;if(i=rl,o=rl,e=T(),null!==e)if(t=c(),null!==t){for(l=[],r=Y(),null===r&&(r=K());null!==r;)l.push(r),r=Y(),null===r&&(r=K());null!==l?(r=c(),null!==r?e=[e,t,l,r]:(e=null,rl=o)):(e=null,rl=o)}else e=null,rl=o;else e=null,rl=o;return null!==e&&(e=function(e){return n.substring(rl,e)}(i)),null===e&&(rl=i),e}function z(){var e,t,l,r,i,o;if(i=rl,o=rl,e=T(),null!==e)if(t=c(),null!==t){for(l=[],r=Y(),null===r&&(r=K());null!==r;)l.push(r),r=Y(),null===r&&(r=K());null!==l?(r=c(),null!==r?e=[e,t,l,r]:(e=null,rl=o)):(e=null,rl=o)}else e=null,rl=o;else e=null,rl=o;return null!==e&&(e=function(e){return n.substring(rl-1,e+1)}(i)),null===e&&(rl=i),e}function Y(){var e;return e=_(),null===e&&(33===n.charCodeAt(rl)?(e="!",rl++):(e=null,0===il&&l('"!"')),null===e&&(/^[#-[]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[#-[]")),null===e&&(/^[\]-~]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[\\]-~]")),null===e&&(e=E())))),e}function K(){var e,t,r;return r=rl,92===n.charCodeAt(rl)?(e="\\",rl++):(e=null,0===il&&l('"\\\\"')),null!==e?(/^[\0-\t]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[\\0-\\t]")),null===t&&(/^[\x0B-\f]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[\\x0B-\\f]")),null===t&&(/^[\x0E-]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[\\x0E-]")))),null!==t?e=[e,t]:(e=null,rl=r)):(e=null,rl=r),e}function j(){var e,t,r,i,o,s;return o=rl,s=rl,e=J(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=X(),r=null!==r?r:"",null!==r?(i=ne(),null!==i?e=[e,t,r,i]:(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s),null!==e&&(e=function(){try{ul.uri=new WebSDK.URI(ul.scheme,ul.user,ul.host,ul.port),delete ul.scheme,delete ul.user,delete ul.host,delete ul.host_type,delete ul.port}catch(e){ul=-1}}(o)),null===e&&(rl=o),e}function $(){var e,r,i,o,s,u,a,c;return a=rl,c=rl,e=J(),null!==e?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=X(),i=null!==i?i:"",null!==i?(o=ne(),null!==o?(s=fe(),null!==s?(u=we(),u=null!==u?u:"",null!==u?e=[e,r,i,o,s,u]:(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c),null!==e&&(e=function(){try{ul.uri=new WebSDK.URI(ul.scheme,ul.user,ul.host,ul.port,ul.uri_params,ul.uri_headers),delete ul.scheme,delete ul.user,delete ul.host,delete ul.host_type,delete ul.port,delete ul.uri_params,"SIP_URI"===t&&(ul=ul.uri)}catch(e){ul=-1}}(a)),null===e&&(rl=a),e}function J(){var e,t;return t=rl,"sip"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"sip"')),null!==e&&(e=function(e,n){ul.scheme=n.toLowerCase()}(t,e)),null===e&&(rl=t),e}function X(){var e,t,r,i,o,s;return i=rl,o=rl,e=Z(),null!==e?(s=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ee(),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s),t=null!==t?t:"",null!==t?(64===n.charCodeAt(rl)?(r="@",rl++):(r=null,0===il&&l('"@"')),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e){ul.user=window.decodeURIComponent(n.substring(rl-1,e))}(i)),null===e&&(rl=i),e}function Z(){var e,n;if(n=g(),null===n&&(n=m(),null===n&&(n=Q())),null!==n)for(e=[];null!==n;)e.push(n),n=g(),null===n&&(n=m(),null===n&&(n=Q()));else e=null;return e}function Q(){var e;return 38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","')),null===e&&(59===n.charCodeAt(rl)?(e=";",rl++):(e=null,0===il&&l('";"')),null===e&&(63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null===e&&(47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"'))))))))),e}function ee(){var e,t,r;for(r=rl,e=[],t=g(),null===t&&(t=m(),null===t&&(38===n.charCodeAt(rl)?(t="&",rl++):(t=null,0===il&&l('"&"')),null===t&&(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(36===n.charCodeAt(rl)?(t="$",rl++):(t=null,0===il&&l('"$"')),null===t&&(44===n.charCodeAt(rl)?(t=",",rl++):(t=null,0===il&&l('","'))))))));null!==t;)e.push(t),t=g(),null===t&&(t=m(),null===t&&(38===n.charCodeAt(rl)?(t="&",rl++):(t=null,0===il&&l('"&"')),null===t&&(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')),null===t&&(36===n.charCodeAt(rl)?(t="$",rl++):(t=null,0===il&&l('"$"')),null===t&&(44===n.charCodeAt(rl)?(t=",",rl++):(t=null,0===il&&l('","'))))))));return null!==e&&(e=function(e){ul.password=n.substring(rl,e)}(r)),null===e&&(rl=r),e}function ne(){var e,t,r,i,o;return i=rl,e=te(),null!==e?(o=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,rl=o)):(t=null,rl=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),e}function te(){var e,t;return t=rl,e=le(),null===e&&(e=ce(),null===e&&(e=oe())),null!==e&&(e=function(e){return ul.host=n.substring(rl,e).toLowerCase(),ul.host}(t)),null===e&&(rl=t),e}function le(){var e,t,r,i,o,s;for(i=rl,o=rl,e=[],s=rl,t=re(),null!==t?(46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."')),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s);null!==t;)e.push(t),s=rl,t=re(),null!==t?(46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."')),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s);return null!==e?(t=ie(),null!==t?(46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."')),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e){return ul.host_type="domain",n.substring(rl,e)}(i)),null===e&&(rl=i),e}function re(){var e,t;if(/^[a-zA-Z0-9_\-]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[a-zA-Z0-9_\\-]")),null!==t)for(e=[];null!==t;)e.push(t),/^[a-zA-Z0-9_\-]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[a-zA-Z0-9_\\-]"));else e=null;return e}function ie(){var e,t;if(/^[a-zA-Z_\-]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[a-zA-Z_\\-]")),null!==t)for(e=[];null!==t;)e.push(t),/^[a-zA-Z_\-]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[a-zA-Z_\\-]"));else e=null;return e}function oe(){var e,t,r,i,o;return i=rl,o=rl,91===n.charCodeAt(rl)?(e="[",rl++):(e=null,0===il&&l('"["')),null!==e?(t=se(),null!==t?(93===n.charCodeAt(rl)?(r="]",rl++):(r=null,0===il&&l('"]"')),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e){return ul.host_type="IPv6",n.substring(rl,e)}(i)),null===e&&(rl=i),e}function se(){var e,t,r,i,o,s,u,a,c,h,d,f,p,g,v,m;return g=rl,v=rl,e=ue(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?(58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?(58===n.charCodeAt(rl)?(s=":",rl++):(s=null,0===il&&l('":"')),null!==s?(u=ue(),null!==u?(58===n.charCodeAt(rl)?(a=":",rl++):(a=null,0===il&&l('":"')),null!==a?(c=ue(),null!==c?(58===n.charCodeAt(rl)?(h=":",rl++):(h=null,0===il&&l('":"')),null!==h?(d=ue(),null!==d?(58===n.charCodeAt(rl)?(f=":",rl++):(f=null,0===il&&l('":"')),null!==f?(p=ae(),null!==p?e=[e,t,r,i,o,s,u,a,c,h,d,f,p]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?(58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?(58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ue(),null!==a?(58===n.charCodeAt(rl)?(c=":",rl++):(c=null,0===il&&l('":"')),null!==c?(h=ue(),null!==h?(58===n.charCodeAt(rl)?(d=":",rl++):(d=null,0===il&&l('":"')),null!==d?(f=ae(),null!==f?e=[e,t,r,i,o,s,u,a,c,h,d,f]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?(58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?(58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ue(),null!==a?(58===n.charCodeAt(rl)?(c=":",rl++):(c=null,0===il&&l('":"')),null!==c?(h=ae(),null!==h?e=[e,t,r,i,o,s,u,a,c,h]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?(58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?(58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ae(),null!==a?e=[e,t,r,i,o,s,u,a]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?(58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ae(),null!==s?e=[e,t,r,i,o,s]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?(58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ae(),null!==i?e=[e,t,r,i]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ae(),null!==t?e=[e,t]:(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,"::"===n.substr(rl,2)?(e="::",rl+=2):(e=null,0===il&&l('"::"')),null!==e?(t=ue(),null!==t?e=[e,t]:(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?("::"===n.substr(rl,2)?(t="::",rl+=2):(t=null,0===il&&l('"::"')),null!==t?(r=ue(),null!==r?(58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?(58===n.charCodeAt(rl)?(s=":",rl++):(s=null,0===il&&l('":"')),null!==s?(u=ue(),null!==u?(58===n.charCodeAt(rl)?(a=":",rl++):(a=null,0===il&&l('":"')),null!==a?(c=ue(),null!==c?(58===n.charCodeAt(rl)?(h=":",rl++):(h=null,0===il&&l('":"')),null!==h?(d=ae(),null!==d?e=[e,t,r,i,o,s,u,a,c,h,d]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?("::"===n.substr(rl,2)?(r="::",rl+=2):(r=null,0===il&&l('"::"')),null!==r?(i=ue(),null!==i?(58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?(58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ue(),null!==a?(58===n.charCodeAt(rl)?(c=":",rl++):(c=null,0===il&&l('":"')),null!==c?(h=ae(),null!==h?e=[e,t,r,i,o,s,u,a,c,h]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?(m=rl,58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?r=[r,i]:(r=null,rl=m)):(r=null,rl=m),r=null!==r?r:"",null!==r?("::"===n.substr(rl,2)?(i="::",rl+=2):(i=null,0===il&&l('"::"')),null!==i?(o=ue(),null!==o?(58===n.charCodeAt(rl)?(s=":",rl++):(s=null,0===il&&l('":"')),null!==s?(u=ue(),null!==u?(58===n.charCodeAt(rl)?(a=":",rl++):(a=null,0===il&&l('":"')),null!==a?(c=ae(),null!==c?e=[e,t,r,i,o,s,u,a,c]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?(m=rl,58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?r=[r,i]:(r=null,rl=m)):(r=null,rl=m),r=null!==r?r:"",null!==r?(m=rl,58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?i=[i,o]:(i=null,rl=m)):(i=null,rl=m),i=null!==i?i:"",null!==i?("::"===n.substr(rl,2)?(o="::",rl+=2):(o=null,0===il&&l('"::"')),null!==o?(s=ue(),null!==s?(58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ae(),null!==a?e=[e,t,r,i,o,s,u,a]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?(m=rl,58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?r=[r,i]:(r=null,rl=m)):(r=null,rl=m),r=null!==r?r:"",null!==r?(m=rl,58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?i=[i,o]:(i=null,rl=m)):(i=null,rl=m),i=null!==i?i:"",null!==i?(m=rl,58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?o=[o,s]:(o=null,rl=m)):(o=null,rl=m),o=null!==o?o:"",null!==o?("::"===n.substr(rl,2)?(s="::",rl+=2):(s=null,0===il&&l('"::"')),null!==s?(u=ae(),null!==u?e=[e,t,r,i,o,s,u]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?(m=rl,58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?r=[r,i]:(r=null,rl=m)):(r=null,rl=m),r=null!==r?r:"",null!==r?(m=rl,58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?i=[i,o]:(i=null,rl=m)):(i=null,rl=m),i=null!==i?i:"",null!==i?(m=rl,58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?o=[o,s]:(o=null,rl=m)):(o=null,rl=m),o=null!==o?o:"",null!==o?(m=rl,58===n.charCodeAt(rl)?(s=":",rl++):(s=null,0===il&&l('":"')),null!==s?(u=ue(),null!==u?s=[s,u]:(s=null,rl=m)):(s=null,rl=m),s=null!==s?s:"",null!==s?("::"===n.substr(rl,2)?(u="::",rl+=2):(u=null,0===il&&l('"::"')),null!==u?(a=ue(),null!==a?e=[e,t,r,i,o,s,u,a]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v),null===e&&(v=rl,e=ue(),null!==e?(m=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?t=[t,r]:(t=null,rl=m)):(t=null,rl=m),t=null!==t?t:"",null!==t?(m=rl,58===n.charCodeAt(rl)?(r=":",rl++):(r=null,0===il&&l('":"')),null!==r?(i=ue(),null!==i?r=[r,i]:(r=null,rl=m)):(r=null,rl=m),r=null!==r?r:"",null!==r?(m=rl,58===n.charCodeAt(rl)?(i=":",rl++):(i=null,0===il&&l('":"')),null!==i?(o=ue(),null!==o?i=[i,o]:(i=null,rl=m)):(i=null,rl=m),i=null!==i?i:"",null!==i?(m=rl,58===n.charCodeAt(rl)?(o=":",rl++):(o=null,0===il&&l('":"')),null!==o?(s=ue(),null!==s?o=[o,s]:(o=null,rl=m)):(o=null,rl=m),o=null!==o?o:"",null!==o?(m=rl,58===n.charCodeAt(rl)?(s=":",rl++):(s=null,0===il&&l('":"')),null!==s?(u=ue(),null!==u?s=[s,u]:(s=null,rl=m)):(s=null,rl=m),s=null!==s?s:"",null!==s?(m=rl,58===n.charCodeAt(rl)?(u=":",rl++):(u=null,0===il&&l('":"')),null!==u?(a=ue(),null!==a?u=[u,a]:(u=null,rl=m)):(u=null,rl=m),u=null!==u?u:"",null!==u?("::"===n.substr(rl,2)?(a="::",rl+=2):(a=null,0===il&&l('"::"')),null!==a?e=[e,t,r,i,o,s,u,a]:(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v)):(e=null,rl=v))))))))))))))),null!==e&&(e=function(e){return ul.host_type="IPv6",n.substring(rl,e)}(g)),null===e&&(rl=g),e}function ue(){var e,n,t,l,r;return r=rl,e=s(),null!==e?(n=s(),n=null!==n?n:"",null!==n?(t=s(),t=null!==t?t:"",null!==t?(l=s(),l=null!==l?l:"",null!==l?e=[e,n,t,l]:(e=null,rl=r)):(e=null,rl=r)):(e=null,rl=r)):(e=null,rl=r),e}function ae(){var e,t,r,i;return i=rl,e=ue(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=ue(),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),null===e&&(e=ce()),e}function ce(){var e,t,r,i,o,s,u,a,c;return a=rl,c=rl,e=he(),null!==e?(46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null!==t?(r=he(),null!==r?(46===n.charCodeAt(rl)?(i=".",rl++):(i=null,0===il&&l('"."')),null!==i?(o=he(),null!==o?(46===n.charCodeAt(rl)?(s=".",rl++):(s=null,0===il&&l('"."')),null!==s?(u=he(),null!==u?e=[e,t,r,i,o,s,u]:(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c)):(e=null,rl=c),null!==e&&(e=function(e){return ul.host_type="IPv4",n.substring(rl,e)}(a)),null===e&&(rl=a),e}function he(){var e,t,r,o;return o=rl,"25"===n.substr(rl,2)?(e="25",rl+=2):(e=null,0===il&&l('"25"')),null!==e?(/^[0-5]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[0-5]")),null!==t?e=[e,t]:(e=null,rl=o)):(e=null,rl=o),null===e&&(o=rl,50===n.charCodeAt(rl)?(e="2",rl++):(e=null,0===il&&l('"2"')),null!==e?(/^[0-4]/.test(n.charAt(rl))?(t=n.charAt(rl),rl++):(t=null,0===il&&l("[0-4]")),null!==t?(r=i(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null===e&&(o=rl,49===n.charCodeAt(rl)?(e="1",rl++):(e=null,0===il&&l('"1"')),null!==e?(t=i(),null!==t?(r=i(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null===e&&(o=rl,/^[1-9]/.test(n.charAt(rl))?(e=n.charAt(rl),rl++):(e=null,0===il&&l("[1-9]")),null!==e?(t=i(),null!==t?e=[e,t]:(e=null,rl=o)):(e=null,rl=o),null===e&&(e=i())))),e}function de(){var e,n,t,l,r,o,s;return o=rl,s=rl,e=i(),e=null!==e?e:"",null!==e?(n=i(),n=null!==n?n:"",
null!==n?(t=i(),t=null!==t?t:"",null!==t?(l=i(),l=null!==l?l:"",null!==l?(r=i(),r=null!==r?r:"",null!==r?e=[e,n,t,l,r]:(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s),null!==e&&(e=function(e,n){return n=parseInt(n.join("")),ul.port=n,n}(o,e)),null===e&&(rl=o),e}function fe(){var e,t,r,i;for(e=[],i=rl,59===n.charCodeAt(rl)?(t=";",rl++):(t=null,0===il&&l('";"')),null!==t?(r=pe(),null!==r?t=[t,r]:(t=null,rl=i)):(t=null,rl=i);null!==t;)e.push(t),i=rl,59===n.charCodeAt(rl)?(t=";",rl++):(t=null,0===il&&l('";"')),null!==t?(r=pe(),null!==r?t=[t,r]:(t=null,rl=i)):(t=null,rl=i);return e}function pe(){var e;return e=ge(),null===e&&(e=ve(),null===e&&(e=me(),null===e&&(e=_e(),null===e&&(e=Te(),null===e&&(e=Ce(),null===e&&(e=Ae())))))),e}function ge(){var e,t,r,i;return r=rl,i=rl,"transport="===n.substr(rl,10).toLowerCase()?(e=n.substr(rl,10),rl+=10):(e=null,0===il&&l('"transport="')),null!==e?("udp"===n.substr(rl,3).toLowerCase()?(t=n.substr(rl,3),rl+=3):(t=null,0===il&&l('"udp"')),null===t&&("tcp"===n.substr(rl,3).toLowerCase()?(t=n.substr(rl,3),rl+=3):(t=null,0===il&&l('"tcp"')),null===t&&("sctp"===n.substr(rl,4).toLowerCase()?(t=n.substr(rl,4),rl+=4):(t=null,0===il&&l('"sctp"')),null===t&&("tls"===n.substr(rl,3).toLowerCase()?(t=n.substr(rl,3),rl+=3):(t=null,0===il&&l('"tls"')),null===t&&(t=w())))),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(e,n){ul.uri_params||(ul.uri_params={}),ul.uri_params.transport=n.toLowerCase()}(r,e[1])),null===e&&(rl=r),e}function ve(){var e,t,r,i;return r=rl,i=rl,"user="===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"user="')),null!==e?("phone"===n.substr(rl,5).toLowerCase()?(t=n.substr(rl,5),rl+=5):(t=null,0===il&&l('"phone"')),null===t&&("ip"===n.substr(rl,2).toLowerCase()?(t=n.substr(rl,2),rl+=2):(t=null,0===il&&l('"ip"')),null===t&&(t=w())),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(e,n){ul.uri_params||(ul.uri_params={}),ul.uri_params.user=n.toLowerCase()}(r,e[1])),null===e&&(rl=r),e}function me(){var e,t,r,i;return r=rl,i=rl,"method="===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"method="')),null!==e?(t=on(),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(e,n){ul.uri_params||(ul.uri_params={}),ul.uri_params.method=n}(r,e[1])),null===e&&(rl=r),e}function _e(){var e,t,r,i;return r=rl,i=rl,"ttl="===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"ttl="')),null!==e?(t=Ht(),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(e,n){ul.params||(ul.params={}),ul.params.ttl=n}(r,e[1])),null===e&&(rl=r),e}function Te(){var e,t,r,i;return r=rl,i=rl,"maddr="===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"maddr="')),null!==e?(t=te(),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),null!==e&&(e=function(e,n){ul.uri_params||(ul.uri_params={}),ul.uri_params.maddr=n}(r,e[1])),null===e&&(rl=r),e}function Ce(){var e,t,r,i,o,s;return i=rl,o=rl,"lr"===n.substr(rl,2).toLowerCase()?(e=n.substr(rl,2),rl+=2):(e=null,0===il&&l('"lr"')),null!==e?(s=rl,61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null!==t?(r=w(),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(){ul.uri_params||(ul.uri_params={}),ul.uri_params.lr=void 0}(i)),null===e&&(rl=i),e}function Ae(){var e,t,r,i,o,s;return i=rl,o=rl,e=Se(),null!==e?(s=rl,61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null!==t?(r=Ee(),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n,t){ul.uri_params||(ul.uri_params={}),t="undefined"==typeof t?void 0:t[1],ul.uri_params[n.toLowerCase()]=t&&t.toLowerCase()}(i,e[0],e[1])),null===e&&(rl=i),e}function Se(){var e,n,t;if(t=rl,n=ye(),null!==n)for(e=[];null!==n;)e.push(n),n=ye();else e=null;return null!==e&&(e=function(e,n){return n.join("")}(t,e)),null===e&&(rl=t),e}function Ee(){var e,n,t;if(t=rl,n=ye(),null!==n)for(e=[];null!==n;)e.push(n),n=ye();else e=null;return null!==e&&(e=function(e,n){return n.join("")}(t,e)),null===e&&(rl=t),e}function ye(){var e;return e=be(),null===e&&(e=g(),null===e&&(e=m())),e}function be(){var e;return 91===n.charCodeAt(rl)?(e="[",rl++):(e=null,0===il&&l('"["')),null===e&&(93===n.charCodeAt(rl)?(e="]",rl++):(e=null,0===il&&l('"]"')),null===e&&(47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"')),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')))))))),e}function we(){var e,t,r,i,o,s,u;if(s=rl,63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null!==e)if(t=Re(),null!==t){for(r=[],u=rl,38===n.charCodeAt(rl)?(i="&",rl++):(i=null,0===il&&l('"&"')),null!==i?(o=Re(),null!==o?i=[i,o]:(i=null,rl=u)):(i=null,rl=u);null!==i;)r.push(i),u=rl,38===n.charCodeAt(rl)?(i="&",rl++):(i=null,0===il&&l('"&"')),null!==i?(o=Re(),null!==o?i=[i,o]:(i=null,rl=u)):(i=null,rl=u);null!==r?e=[e,t,r]:(e=null,rl=s)}else e=null,rl=s;else e=null,rl=s;return e}function Re(){var e,t,r,i,o;return i=rl,o=rl,e=Ie(),null!==e?(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null!==t?(r=Pe(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n,t){n=n.join("").toLowerCase(),t=t.join(""),ul.uri_headers||(ul.uri_headers={}),ul.uri_headers[n]?ul.uri_headers[n].push(t):ul.uri_headers[n]=[t]}(i,e[0],e[2])),null===e&&(rl=i),e}function Ie(){var e,n;if(n=Ne(),null===n&&(n=g(),null===n&&(n=m())),null!==n)for(e=[];null!==n;)e.push(n),n=Ne(),null===n&&(n=g(),null===n&&(n=m()));else e=null;return e}function Pe(){var e,n;for(e=[],n=Ne(),null===n&&(n=g(),null===n&&(n=m()));null!==n;)e.push(n),n=Ne(),null===n&&(n=g(),null===n&&(n=m()));return e}function Ne(){var e;return 91===n.charCodeAt(rl)?(e="[",rl++):(e=null,0===il&&l('"["')),null===e&&(93===n.charCodeAt(rl)?(e="]",rl++):(e=null,0===il&&l('"]"')),null===e&&(47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"')),null===e&&(63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')))))))),e}function De(){var e;return e=sn(),null===e&&(e=Ue()),e}function Ue(){var e,n,t,l,r,i;return i=rl,e=on(),null!==e?(n=h(),null!==n?(t=Oe(),null!==t?(l=h(),null!==l?(r=Je(),null!==r?e=[e,n,t,l,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function Oe(){var e;return e=$(),null===e&&(e=Me()),e}function Me(){var e,t,r,i;return i=rl,e=ze(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=Le(),null===r&&(r=ke()),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function Le(){var e,t,r,i,o;return i=rl,e=xe(),null===e&&(e=Fe()),null!==e?(o=rl,63===n.charCodeAt(rl)?(t="?",rl++):(t=null,0===il&&l('"?"')),null!==t?(r=$e(),null!==r?t=[t,r]:(t=null,rl=o)):(t=null,rl=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),e}function xe(){var e,t,r,i;return i=rl,"//"===n.substr(rl,2)?(e="//",rl+=2):(e=null,0===il&&l('"//"')),null!==e?(t=Ye(),null!==t?(r=Fe(),r=null!==r?r:"",null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function Fe(){var e,t,r;return r=rl,47===n.charCodeAt(rl)?(e="/",rl++):(e=null,0===il&&l('"/"')),null!==e?(t=He(),null!==t?e=[e,t]:(e=null,rl=r)):(e=null,rl=r),e}function ke(){var e,n,t,l;if(l=rl,e=Be(),null!==e){for(n=[],t=qe();null!==t;)n.push(t),t=qe();null!==n?e=[e,n]:(e=null,rl=l)}else e=null,rl=l;return e}function qe(){var e;return e=p(),null===e&&(e=g(),null===e&&(e=m())),e}function Be(){var e;return e=g(),null===e&&(e=m(),null===e&&(59===n.charCodeAt(rl)?(e=";",rl++):(e=null,0===il&&l('";"')),null===e&&(63===n.charCodeAt(rl)?(e="?",rl++):(e=null,0===il&&l('"?"')),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(64===n.charCodeAt(rl)?(e="@",rl++):(e=null,0===il&&l('"@"')),null===e&&(38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","')))))))))))),e}function He(){var e,t,r,i,o,s;if(o=rl,e=Ge(),null!==e){for(t=[],s=rl,47===n.charCodeAt(rl)?(r="/",rl++):(r=null,0===il&&l('"/"')),null!==r?(i=Ge(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)t.push(r),s=rl,47===n.charCodeAt(rl)?(r="/",rl++):(r=null,0===il&&l('"/"')),null!==r?(i=Ge(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return e}function Ge(){var e,t,r,i,o,s;for(o=rl,e=[],t=We();null!==t;)e.push(t),t=We();if(null!==e){for(t=[],s=rl,59===n.charCodeAt(rl)?(r=";",rl++):(r=null,0===il&&l('";"')),null!==r?(i=Ve(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)t.push(r),s=rl,59===n.charCodeAt(rl)?(r=";",rl++):(r=null,0===il&&l('";"')),null!==r?(i=Ve(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return e}function Ve(){var e,n;for(e=[],n=We();null!==n;)e.push(n),n=We();return e}function We(){var e;return e=g(),null===e&&(e=m(),null===e&&(58===n.charCodeAt(rl)?(e=":",rl++):(e=null,0===il&&l('":"')),null===e&&(64===n.charCodeAt(rl)?(e="@",rl++):(e=null,0===il&&l('"@"')),null===e&&(38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","')))))))))),e}function ze(){var e,t,r,s,u;if(s=rl,u=rl,e=o(),null!==e){for(t=[],r=o(),null===r&&(r=i(),null===r&&(43===n.charCodeAt(rl)?(r="+",rl++):(r=null,0===il&&l('"+"')),null===r&&(45===n.charCodeAt(rl)?(r="-",rl++):(r=null,0===il&&l('"-"')),null===r&&(46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."'))))));null!==r;)t.push(r),r=o(),null===r&&(r=i(),null===r&&(43===n.charCodeAt(rl)?(r="+",rl++):(r=null,0===il&&l('"+"')),null===r&&(45===n.charCodeAt(rl)?(r="-",rl++):(r=null,0===il&&l('"-"')),null===r&&(46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."'))))));null!==t?e=[e,t]:(e=null,rl=u)}else e=null,rl=u;return null!==e&&(e=function(e){ul.scheme=n.substring(rl,e)}(s)),null===e&&(rl=s),e}function Ye(){var e;return e=Ke(),null===e&&(e=je()),e}function Ke(){var e,t,r,i;return r=rl,i=rl,e=X(),null!==e?(64===n.charCodeAt(rl)?(t="@",rl++):(t=null,0===il&&l('"@"')),null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),e=null!==e?e:"",null!==e?(t=ne(),null!==t?e=[e,t]:(e=null,rl=r)):(e=null,rl=r),e=null!==e?e:""}function je(){var e,t;if(t=g(),null===t&&(t=m(),null===t&&(36===n.charCodeAt(rl)?(t="$",rl++):(t=null,0===il&&l('"$"')),null===t&&(44===n.charCodeAt(rl)?(t=",",rl++):(t=null,0===il&&l('","')),null===t&&(59===n.charCodeAt(rl)?(t=";",rl++):(t=null,0===il&&l('";"')),null===t&&(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null===t&&(64===n.charCodeAt(rl)?(t="@",rl++):(t=null,0===il&&l('"@"')),null===t&&(38===n.charCodeAt(rl)?(t="&",rl++):(t=null,0===il&&l('"&"')),null===t&&(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"'))))))))))),null!==t)for(e=[];null!==t;)e.push(t),t=g(),null===t&&(t=m(),null===t&&(36===n.charCodeAt(rl)?(t="$",rl++):(t=null,0===il&&l('"$"')),null===t&&(44===n.charCodeAt(rl)?(t=",",rl++):(t=null,0===il&&l('","')),null===t&&(59===n.charCodeAt(rl)?(t=";",rl++):(t=null,0===il&&l('";"')),null===t&&(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null===t&&(64===n.charCodeAt(rl)?(t="@",rl++):(t=null,0===il&&l('"@"')),null===t&&(38===n.charCodeAt(rl)?(t="&",rl++):(t=null,0===il&&l('"&"')),null===t&&(61===n.charCodeAt(rl)?(t="=",rl++):(t=null,0===il&&l('"="')),null===t&&(43===n.charCodeAt(rl)?(t="+",rl++):(t=null,0===il&&l('"+"')))))))))));else e=null;return e}function $e(){var e,n;for(e=[],n=qe();null!==n;)e.push(n),n=qe();return e}function Je(){var e,t,r,o,s,u,a,c;if(a=rl,c=rl,"sip"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"SIP"')),null!==e)if(47===n.charCodeAt(rl)?(t="/",rl++):(t=null,0===il&&l('"/"')),null!==t){if(o=i(),null!==o)for(r=[];null!==o;)r.push(o),o=i();else r=null;if(null!==r)if(46===n.charCodeAt(rl)?(o=".",rl++):(o=null,0===il&&l('"."')),null!==o){if(u=i(),null!==u)for(s=[];null!==u;)s.push(u),u=i();else s=null;null!==s?e=[e,t,r,o,s]:(e=null,rl=c)}else e=null,rl=c;else e=null,rl=c}else e=null,rl=c;else e=null,rl=c;return null!==e&&(e=function(e){ul.sip_version=n.substring(rl,e)}(a)),null===e&&(rl=a),e}function Xe(){var e;return"INVITE"===n.substr(rl,6)?(e="INVITE",rl+=6):(e=null,0===il&&l('"INVITE"')),e}function Ze(){var e;return"ACK"===n.substr(rl,3)?(e="ACK",rl+=3):(e=null,0===il&&l('"ACK"')),e}function Qe(){var e;return"OPTIONS"===n.substr(rl,7)?(e="OPTIONS",rl+=7):(e=null,0===il&&l('"OPTIONS"')),e}function en(){var e;return"BYE"===n.substr(rl,3)?(e="BYE",rl+=3):(e=null,0===il&&l('"BYE"')),e}function nn(){var e;return"CANCEL"===n.substr(rl,6)?(e="CANCEL",rl+=6):(e=null,0===il&&l('"CANCEL"')),e}function tn(){var e;return"REGISTER"===n.substr(rl,8)?(e="REGISTER",rl+=8):(e=null,0===il&&l('"REGISTER"')),e}function ln(){var e;return"SUBSCRIBE"===n.substr(rl,9)?(e="SUBSCRIBE",rl+=9):(e=null,0===il&&l('"SUBSCRIBE"')),e}function rn(){var e;return"NOTIFY"===n.substr(rl,6)?(e="NOTIFY",rl+=6):(e=null,0===il&&l('"NOTIFY"')),e}function on(){var e,t;return t=rl,e=Xe(),null===e&&(e=Ze(),null===e&&(e=Qe(),null===e&&(e=en(),null===e&&(e=nn(),null===e&&(e=tn(),null===e&&(e=ln(),null===e&&(e=rn(),null===e&&(e=w())))))))),null!==e&&(e=function(e){return ul.method=n.substring(rl,e),ul.method}(t)),null===e&&(rl=t),e}function sn(){var e,n,t,l,r,i;return i=rl,e=Je(),null!==e?(n=h(),null!==n?(t=un(),null!==t?(l=h(),null!==l?(r=cn(),null!==r?e=[e,n,t,l,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function un(){var e,n;return n=rl,e=an(),null!==e&&(e=function(e,n){ul.status_code=parseInt(n.join(""))}(n,e)),null===e&&(rl=n),e}function an(){var e,n,t,l;return l=rl,e=i(),null!==e?(n=i(),null!==n?(t=i(),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)):(e=null,rl=l),e}function cn(){var e,t,l;for(l=rl,e=[],t=p(),null===t&&(t=g(),null===t&&(t=m(),null===t&&(t=E(),null===t&&(t=y(),null===t&&(t=h(),null===t&&(t=d()))))));null!==t;)e.push(t),t=p(),null===t&&(t=g(),null===t&&(t=m(),null===t&&(t=E(),null===t&&(t=y(),null===t&&(t=h(),null===t&&(t=d()))))));return null!==e&&(e=function(e){ul.reason_phrase=n.substring(rl,e)}(l)),null===e&&(rl=l),e}function hn(){var e,n,t,l,r,i;if(r=rl,e=Wn(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=Wn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=Wn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function dn(){var e,t,r,i,o,s;return i=rl,o=rl,e=P(),null!==e?(s=rl,64===n.charCodeAt(rl)?(t="@",rl++):(t=null,0===il&&l('"@"')),null!==t?(r=P(),null!==r?t=[t,r]:(t=null,rl=s)):(t=null,rl=s),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e){ul=n.substring(rl,e)}(i)),null===e&&(rl=i),e}function fn(){var e,n,t,l,r,i,o;if(r=rl,e=N(),null===e)if(i=rl,e=pn(),null!==e){for(n=[],o=rl,t=F(),null!==t?(l=pn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=F(),null!==t?(l=pn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(){var e,n;for(n=ul.multi_header.length,e=0;n>e;e++)if(null===ul.multi_header[e].parsed){ul=null;break}ul=null!==ul?ul.multi_header:-1}(r)),null===e&&(rl=r),e}function pn(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=j(),null===e&&(e=gn()),null!==e){for(n=[],o=rl,t=k(),null!==t?(l=mn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=k(),null!==t?(l=mn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(e){var n;ul.multi_header||(ul.multi_header=[]);try{n=new WebSDK.NameAddrHeader(ul.uri,ul.display_name,ul.params),delete ul.uri,delete ul.display_name,delete ul.params}catch(t){n=null}ul.multi_header.push({possition:rl,offset:e,parsed:n})}(r)),null===e&&(rl=r),e}function gn(){var e,n,t,l,r;return r=rl,e=vn(),e=null!==e?e:"",null!==e?(n=x(),null!==n?(t=$(),null!==t?(l=L(),null!==l?e=[e,n,t,l]:(e=null,rl=r)):(e=null,rl=r)):(e=null,rl=r)):(e=null,rl=r),e}function vn(){var e,t,l,r,i,o,s;if(i=rl,o=rl,e=w(),null!==e){for(t=[],s=rl,l=_(),null!==l?(r=w(),null!==r?l=[l,r]:(l=null,rl=s)):(l=null,rl=s);null!==l;)t.push(l),s=rl,l=_(),null!==l?(r=w(),null!==r?l=[l,r]:(l=null,rl=s)):(l=null,rl=s);null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return null===e&&(e=W()),null!==e&&(e=function(e,t){t=n.substring(rl,e).trim(),'"'===t[0]&&(t=t.substring(1,t.length-1)),ul.display_name=t}(i,e)),null===e&&(rl=i),e}function mn(){var e;return e=_n(),null===e&&(e=Tn(),null===e&&(e=Sn())),e}function _n(){var e,t,r,i,o;return i=rl,o=rl,"q"===n.substr(rl,1).toLowerCase()?(e=n.substr(rl,1),rl++):(e=null,0===il&&l('"q"')),null!==e?(t=U(),null!==t?(r=An(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.params||(ul.params={}),ul.params.q=n}(i,e[2])),null===e&&(rl=i),e}function Tn(){var e,t,r,i,o;return i=rl,o=rl,"expires"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"expires"')),null!==e?(t=U(),null!==t?(r=Cn(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.params||(ul.params={}),ul.params.expires=n}(i,e[2])),null===e&&(rl=i),e}function Cn(){var e,n,t;if(t=rl,n=i(),null!==n)for(e=[];null!==n;)e.push(n),n=i();else e=null;return null!==e&&(e=function(e,n){return parseInt(n.join(""))}(t,e)),null===e&&(rl=t),e}function An(){var e,t,r,o,s,u,a,c;return u=rl,a=rl,48===n.charCodeAt(rl)?(e="0",rl++):(e=null,0===il&&l('"0"')),null!==e?(c=rl,46===n.charCodeAt(rl)?(t=".",rl++):(t=null,0===il&&l('"."')),null!==t?(r=i(),r=null!==r?r:"",null!==r?(o=i(),o=null!==o?o:"",null!==o?(s=i(),s=null!==s?s:"",null!==s?t=[t,r,o,s]:(t=null,rl=c)):(t=null,rl=c)):(t=null,rl=c)):(t=null,rl=c),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=a)):(e=null,rl=a),null!==e&&(e=function(e){return parseFloat(n.substring(rl,e))}(u)),null===e&&(rl=u),e}function Sn(){var e,n,t,l,r,i;return l=rl,r=rl,e=w(),null!==e?(i=rl,n=U(),null!==n?(t=En(),null!==t?n=[n,t]:(n=null,rl=i)):(n=null,rl=i),n=null!==n?n:"",null!==n?e=[e,n]:(e=null,rl=r)):(e=null,rl=r),null!==e&&(e=function(e,n,t){ul.params||(ul.params={}),t="undefined"==typeof t?void 0:t[1],ul.params[n.toLowerCase()]=t}(l,e[0],e[1])),null===e&&(rl=l),e}function En(){var e;return e=w(),null===e&&(e=te(),null===e&&(e=W())),e}function yn(){var e,n,t,l,r,i;if(r=rl,e=bn(),null!==e){for(n=[],i=rl,t=k(),null!==t?(l=wn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=k(),null!==t?(l=wn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function bn(){var e;return"render"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"render"')),null===e&&("session"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"session"')),null===e&&("icon"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"icon"')),null===e&&("alert"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"alert"')),null===e&&(e=w())))),e}function wn(){var e;return e=Rn(),null===e&&(e=Sn()),e}function Rn(){var e,t,r,i;return i=rl,"handling"===n.substr(rl,8).toLowerCase()?(e=n.substr(rl,8),rl+=8):(e=null,0===il&&l('"handling"')),null!==e?(t=U(),null!==t?("optional"===n.substr(rl,8).toLowerCase()?(r=n.substr(rl,8),rl+=8):(r=null,0===il&&l('"optional"')),null===r&&("required"===n.substr(rl,8).toLowerCase()?(r=n.substr(rl,8),rl+=8):(r=null,0===il&&l('"required"')),null===r&&(r=w())),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function In(){var e,n,t,l,r,i;if(r=rl,e=w(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function Pn(){var e,n,t;if(t=rl,n=i(),null!==n)for(e=[];null!==n;)e.push(n),n=i();else e=null;return null!==e&&(e=function(e,n){ul=parseInt(n.join(""))}(t,e)),null===e&&(rl=t),e}function Nn(){var e,t;return t=rl,e=Dn(),null!==e&&(e=function(e){ul=n.substring(rl,e)}(t)),null===e&&(rl=t),e}function Dn(){var e,n,t,l,r,i,o,s;if(o=rl,e=Un(),null!==e)if(n=D(),null!==n)if(t=Fn(),null!==t){for(l=[],s=rl,r=k(),null!==r?(i=kn(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)l.push(r),s=rl,r=k(),null!==r?(i=kn(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==l?e=[e,n,t,l]:(e=null,rl=o)}else e=null,rl=o;else e=null,rl=o;else e=null,rl=o;return e}function Un(){var e;return e=On(),null===e&&(e=Mn()),e}function On(){var e;return"text"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"text"')),null===e&&("image"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"image"')),null===e&&("audio"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"audio"')),null===e&&("video"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"video"')),null===e&&("application"===n.substr(rl,11).toLowerCase()?(e=n.substr(rl,11),rl+=11):(e=null,0===il&&l('"application"')),null===e&&(e=Ln()))))),e}function Mn(){var e;return"message"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"message"')),null===e&&("multipart"===n.substr(rl,9).toLowerCase()?(e=n.substr(rl,9),rl+=9):(e=null,0===il&&l('"multipart"')),null===e&&(e=Ln())),e}function Ln(){var e;return e=w(),null===e&&(e=xn()),e}function xn(){var e,t,r;return r=rl,"x-"===n.substr(rl,2).toLowerCase()?(e=n.substr(rl,2),rl+=2):(e=null,0===il&&l('"x-"')),null!==e?(t=w(),null!==t?e=[e,t]:(e=null,rl=r)):(e=null,rl=r),e}function Fn(){var e;return e=Ln(),null===e&&(e=w()),e}function kn(){var e,n,t,l;return l=rl,e=w(),null!==e?(n=U(),null!==n?(t=qn(),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)):(e=null,rl=l),e}function qn(){var e;return e=w(),null===e&&(e=W()),e}function Bn(){var e,n,t,l;return l=rl,e=Hn(),null!==e?(n=_(),null!==n?(t=on(),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)):(e=null,rl=l),e}function Hn(){var e,n,t;if(t=rl,n=i(),null!==n)for(e=[];null!==n;)e.push(n),n=i();else e=null;return null!==e&&(e=function(e,n){ul.value=parseInt(n.join(""))}(t,e)),null===e&&(rl=t),e}function Gn(){var e,n;return n=rl,e=Cn(),null!==e&&(e=function(e,n){ul=n}(n,e)),null===e&&(rl=n),e}function Vn(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=Wn(),null!==e){for(n=[],o=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(e,n){ul.event=n.join("").toLowerCase()}(r,e[0])),null===e&&(rl=r),e}function Wn(){var e,t,r,i,o,s;if(o=rl,e=R(),null!==e){for(t=[],s=rl,46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."')),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)t.push(r),s=rl,46===n.charCodeAt(rl)?(r=".",rl++):(r=null,0===il&&l('"."')),null!==r?(i=R(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return e}function zn(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=j(),null===e&&(e=gn()),null!==e){for(n=[],o=rl,t=k(),null!==t?(l=Yn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=k(),null!==t?(l=Yn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(){var e=ul.tag;try{ul=new WebSDK.NameAddrHeader(ul.uri,ul.display_name,ul.params),e&&ul.setParam("tag",e)}catch(n){ul=-1}}(r)),null===e&&(rl=r),e}function Yn(){var e;return e=Kn(),null===e&&(e=Sn()),e}function Kn(){var e,t,r,i,o;return i=rl,o=rl,"tag"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"tag"')),null!==e?(t=U(),null!==t?(r=w(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.tag=n}(i,e[2])),null===e&&(rl=i),e}function jn(){var e,n,t;if(t=rl,n=i(),null!==n)for(e=[];null!==n;)e.push(n),n=i();else e=null;return null!==e&&(e=function(e,n){ul=parseInt(n.join(""))}(t,e)),null===e&&(rl=t),e}function $n(){var e,n;return n=rl,e=Cn(),null!==e&&(e=function(e,n){ul=n}(n,e)),null===e&&(rl=n),e}function Jn(){var e,n,t,l,r,i,o,s,u,a;for(s=rl,u=rl,e=[],n=vn();null!==n;)e.push(n),n=vn();if(null!==e)if(n=x(),null!==n)if(t=$(),null!==t)if(l=L(),null!==l){for(r=[],a=rl,i=k(),null!==i?(o=Sn(),null!==o?i=[i,o]:(i=null,rl=a)):(i=null,rl=a);null!==i;)r.push(i),a=rl,i=k(),null!==i?(o=Sn(),null!==o?i=[i,o]:(i=null,rl=a)):(i=null,rl=a);null!==r?e=[e,n,t,l,r]:(e=null,rl=u)}else e=null,rl=u;else e=null,rl=u;else e=null,rl=u;else e=null,rl=u;return null!==e&&(e=function(){try{ul=new WebSDK.NameAddrHeader(ul.uri,ul.display_name,ul.params)}catch(e){ul=-1}}(s)),null===e&&(rl=s),e}function Xn(){var e;return e=Zn()}function Zn(){var e,t,r,i,o,s,u,a;if(u=rl,"digest"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"Digest"')),null!==e)if(t=_(),null!==t)if(r=nt(),null!==r){for(i=[],a=rl,o=F(),null!==o?(s=nt(),null!==s?o=[o,s]:(o=null,rl=a)):(o=null,rl=a);null!==o;)i.push(o),a=rl,o=F(),null!==o?(s=nt(),null!==s?o=[o,s]:(o=null,rl=a)):(o=null,rl=a);null!==i?e=[e,t,r,i]:(e=null,rl=u)}else e=null,rl=u;else e=null,rl=u;else e=null,rl=u;return null===e&&(e=Qn()),e}function Qn(){var e,n,t,l,r,i,o,s;if(o=rl,e=w(),null!==e)if(n=_(),null!==n)if(t=et(),null!==t){for(l=[],s=rl,r=F(),null!==r?(i=et(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)l.push(r),s=rl,r=F(),null!==r?(i=et(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==l?e=[e,n,t,l]:(e=null,rl=o)}else e=null,rl=o;else e=null,rl=o;else e=null,rl=o;return e}function et(){var e,n,t,l;return l=rl,e=w(),null!==e?(n=U(),null!==n?(t=w(),null===t&&(t=W()),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)):(e=null,rl=l),e}function nt(){var e;return e=tt(),null===e&&(e=rt(),null===e&&(e=ot(),null===e&&(e=ut(),null===e&&(e=at(),null===e&&(e=ct(),null===e&&(e=ht(),null===e&&(e=et()))))))),e}function tt(){var e,t,r,i;return i=rl,"realm"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"realm"')),null!==e?(t=U(),null!==t?(r=lt(),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function lt(){var e,n;return n=rl,e=z(),null!==e&&(e=function(e,n){ul.realm=n}(n,e)),null===e&&(rl=n),e}function rt(){var e,t,r,i,o,s,u,a,c;if(a=rl,"domain"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"domain"')),null!==e)if(t=U(),null!==t)if(r=B(),null!==r)if(i=it(),null!==i){if(o=[],c=rl,u=h(),null!==u)for(s=[];null!==u;)s.push(u),u=h();else s=null;for(null!==s?(u=it(),null!==u?s=[s,u]:(s=null,rl=c)):(s=null,rl=c);null!==s;){if(o.push(s),c=rl,u=h(),null!==u)for(s=[];null!==u;)s.push(u),u=h();else s=null;null!==s?(u=it(),null!==u?s=[s,u]:(s=null,rl=c)):(s=null,rl=c)}null!==o?(s=H(),null!==s?e=[e,t,r,i,o,s]:(e=null,rl=a)):(e=null,rl=a)}else e=null,rl=a;else e=null,rl=a;else e=null,rl=a;else e=null,rl=a;return e}function it(){var e;return e=Me(),null===e&&(e=Fe()),e}function ot(){var e,t,r,i;return i=rl,"nonce"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"nonce"')),null!==e?(t=U(),null!==t?(r=st(),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function st(){var e,n;return n=rl,e=z(),null!==e&&(e=function(e,n){ul.nonce=n}(n,e)),null===e&&(rl=n),e}function ut(){var e,t,r,i,o;return i=rl,o=rl,"opaque"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"opaque"')),null!==e?(t=U(),null!==t?(r=z(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.opaque=n}(i,e[2])),null===e&&(rl=i),e}function at(){var e,t,r,i,o;return i=rl,"stale"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"stale"')),null!==e?(t=U(),null!==t?(o=rl,"true"===n.substr(rl,4).toLowerCase()?(r=n.substr(rl,4),rl+=4):(r=null,0===il&&l('"true"')),null!==r&&(r=function(){ul.stale=!0}(o)),null===r&&(rl=o),null===r&&(o=rl,"false"===n.substr(rl,5).toLowerCase()?(r=n.substr(rl,5),rl+=5):(r=null,0===il&&l('"false"')),null!==r&&(r=function(){ul.stale=!1}(o)),null===r&&(rl=o)),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function ct(){var e,t,r,i,o;return i=rl,o=rl,"algorithm"===n.substr(rl,9).toLowerCase()?(e=n.substr(rl,9),rl+=9):(e=null,0===il&&l('"algorithm"')),null!==e?(t=U(),null!==t?("md5"===n.substr(rl,3).toLowerCase()?(r=n.substr(rl,3),rl+=3):(r=null,0===il&&l('"MD5"')),null===r&&("md5-sess"===n.substr(rl,8).toLowerCase()?(r=n.substr(rl,8),rl+=8):(r=null,0===il&&l('"MD5-sess"')),null===r&&(r=w())),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.algorithm=n.toUpperCase()}(i,e[2])),null===e&&(rl=i),e}function ht(){var e,t,r,i,o,s,u,a,c,h;if(a=rl,"qop"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"qop"')),null!==e)if(t=U(),null!==t)if(r=B(),null!==r){if(c=rl,i=dt(),null!==i){for(o=[],h=rl,44===n.charCodeAt(rl)?(s=",",rl++):(s=null,0===il&&l('","')),null!==s?(u=dt(),null!==u?s=[s,u]:(s=null,rl=h)):(s=null,rl=h);null!==s;)o.push(s),h=rl,44===n.charCodeAt(rl)?(s=",",rl++):(s=null,0===il&&l('","')),null!==s?(u=dt(),null!==u?s=[s,u]:(s=null,rl=h)):(s=null,rl=h);null!==o?i=[i,o]:(i=null,rl=c)}else i=null,rl=c;null!==i?(o=H(),null!==o?e=[e,t,r,i,o]:(e=null,rl=a)):(e=null,rl=a)}else e=null,rl=a;else e=null,rl=a;else e=null,rl=a;return e}function dt(){var e,t;return t=rl,"auth-int"===n.substr(rl,8).toLowerCase()?(e=n.substr(rl,8),rl+=8):(e=null,0===il&&l('"auth-int"')),null===e&&("auth"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"auth"')),null===e&&(e=w())),null!==e&&(e=function(e,n){ul.qop||(ul.qop=[]),ul.qop.push(n.toLowerCase())}(t,e)),null===e&&(rl=t),e}function ft(){var e,n,t,l,r,i;if(r=rl,e=w(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function pt(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=gt(),null!==e){for(n=[],o=rl,t=F(),null!==t?(l=gt(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=F(),null!==t?(l=gt(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(){var e,n;for(n=ul.multi_header.length,e=0;n>e;e++)if(null===ul.multi_header[e].parsed){ul=null;break}ul=null!==ul?ul.multi_header:-1}(r)),null===e&&(rl=r),e}function gt(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=gn(),null!==e){for(n=[],o=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(e){var n;ul.multi_header||(ul.multi_header=[]);try{n=new WebSDK.NameAddrHeader(ul.uri,ul.display_name,ul.params),
delete ul.uri,delete ul.display_name,delete ul.params}catch(t){n=null}ul.multi_header.push({possition:rl,offset:e,parsed:n})}(r)),null===e&&(rl=r),e}function vt(){var e,n,t,l,r,i;if(r=rl,e=w(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function mt(){var e,n,t,l,r,i;if(r=rl,e=_t(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=_t(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=_t(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function _t(){var e,n,t,l,r,i;if(r=rl,e=gn(),null!==e){for(n=[],i=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=k(),null!==t?(l=Sn(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function Tt(){var e,n,t,l,r,i;if(r=rl,e=Ct(),null!==e){for(n=[],i=rl,t=k(),null!==t?(l=At(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=k(),null!==t?(l=At(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function Ct(){var e,t;return t=rl,"active"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"active"')),null===e&&("pending"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"pending"')),null===e&&("terminated"===n.substr(rl,10).toLowerCase()?(e=n.substr(rl,10),rl+=10):(e=null,0===il&&l('"terminated"')),null===e&&(e=w()))),null!==e&&(e=function(e){ul.state=n.substring(rl,e)}(t)),null===e&&(rl=t),e}function At(){var e,t,r,i,o;return i=rl,o=rl,"reason"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"reason"')),null!==e?(t=U(),null!==t?(r=St(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){"undefined"!=typeof n&&(ul.reason=n)}(i,e[2])),null===e&&(rl=i),null===e&&(i=rl,o=rl,"expires"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"expires"')),null!==e?(t=U(),null!==t?(r=Cn(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){"undefined"!=typeof n&&(ul.expires=n)}(i,e[2])),null===e&&(rl=i),null===e&&(i=rl,o=rl,"retry_after"===n.substr(rl,11).toLowerCase()?(e=n.substr(rl,11),rl+=11):(e=null,0===il&&l('"retry_after"')),null!==e?(t=U(),null!==t?(r=Cn(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){"undefined"!=typeof n&&(ul.retry_after=n)}(i,e[2])),null===e&&(rl=i),null===e&&(e=Sn()))),e}function St(){var e;return"deactivated"===n.substr(rl,11).toLowerCase()?(e=n.substr(rl,11),rl+=11):(e=null,0===il&&l('"deactivated"')),null===e&&("probation"===n.substr(rl,9).toLowerCase()?(e=n.substr(rl,9),rl+=9):(e=null,0===il&&l('"probation"')),null===e&&("rejected"===n.substr(rl,8).toLowerCase()?(e=n.substr(rl,8),rl+=8):(e=null,0===il&&l('"rejected"')),null===e&&("timeout"===n.substr(rl,7).toLowerCase()?(e=n.substr(rl,7),rl+=7):(e=null,0===il&&l('"timeout"')),null===e&&("giveup"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"giveup"')),null===e&&("noresource"===n.substr(rl,10).toLowerCase()?(e=n.substr(rl,10),rl+=10):(e=null,0===il&&l('"noresource"')),null===e&&("invariant"===n.substr(rl,9).toLowerCase()?(e=n.substr(rl,9),rl+=9):(e=null,0===il&&l('"invariant"')),null===e&&(e=w()))))))),e}function Et(){var e;return e=A(),e=null!==e?e:""}function yt(){var e,n,t,l,r,i;if(r=rl,e=w(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=w(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e=null!==e?e:""}function bt(){var e,n,t,l,r,i,o;if(r=rl,i=rl,e=j(),null===e&&(e=gn()),null!==e){for(n=[],o=rl,t=k(),null!==t?(l=wt(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==t;)n.push(t),o=rl,t=k(),null!==t?(l=wt(),null!==l?t=[t,l]:(t=null,rl=o)):(t=null,rl=o);null!==n?e=[e,n]:(e=null,rl=i)}else e=null,rl=i;return null!==e&&(e=function(){var e=ul.tag;try{ul=new WebSDK.NameAddrHeader(ul.uri,ul.display_name,ul.params),e&&ul.setParam("tag",e)}catch(n){ul=-1}}(r)),null===e&&(rl=r),e}function wt(){var e;return e=Kn(),null===e&&(e=Sn()),e}function Rt(){var e,n,t,l,r,i;if(r=rl,e=It(),null!==e){for(n=[],i=rl,t=F(),null!==t?(l=It(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==t;)n.push(t),i=rl,t=F(),null!==t?(l=It(),null!==l?t=[t,l]:(t=null,rl=i)):(t=null,rl=i);null!==n?e=[e,n]:(e=null,rl=r)}else e=null,rl=r;return e}function It(){var e,n,t,l,r,i,o,s;if(o=rl,e=Lt(),null!==e)if(n=_(),null!==n)if(t=kt(),null!==t){for(l=[],s=rl,r=k(),null!==r?(i=Pt(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==r;)l.push(r),s=rl,r=k(),null!==r?(i=Pt(),null!==i?r=[r,i]:(r=null,rl=s)):(r=null,rl=s);null!==l?e=[e,n,t,l]:(e=null,rl=o)}else e=null,rl=o;else e=null,rl=o;else e=null,rl=o;return e}function Pt(){var e;return e=Nt(),null===e&&(e=Dt(),null===e&&(e=Ut(),null===e&&(e=Ot(),null===e&&(e=Mt(),null===e&&(e=Sn()))))),e}function Nt(){var e,t,r,i,o;return i=rl,o=rl,"ttl"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"ttl"')),null!==e?(t=U(),null!==t?(r=Ht(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.ttl=n}(i,e[2])),null===e&&(rl=i),e}function Dt(){var e,t,r,i,o;return i=rl,o=rl,"maddr"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"maddr"')),null!==e?(t=U(),null!==t?(r=te(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.maddr=n}(i,e[2])),null===e&&(rl=i),e}function Ut(){var e,t,r,i,o;return i=rl,o=rl,"received"===n.substr(rl,8).toLowerCase()?(e=n.substr(rl,8),rl+=8):(e=null,0===il&&l('"received"')),null!==e?(t=U(),null!==t?(r=ce(),null===r&&(r=se()),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.received=n}(i,e[2])),null===e&&(rl=i),e}function Ot(){var e,t,r,i,o;return i=rl,o=rl,"branch"===n.substr(rl,6).toLowerCase()?(e=n.substr(rl,6),rl+=6):(e=null,0===il&&l('"branch"')),null!==e?(t=U(),null!==t?(r=w(),null!==r?e=[e,t,r]:(e=null,rl=o)):(e=null,rl=o)):(e=null,rl=o),null!==e&&(e=function(e,n){ul.branch=n}(i,e[2])),null===e&&(rl=i),e}function Mt(){var e,t,r,o,s,u,a;if(s=rl,u=rl,"rport"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"rport"')),null!==e){if(a=rl,t=U(),null!==t){for(r=[],o=i();null!==o;)r.push(o),o=i();null!==r?t=[t,r]:(t=null,rl=a)}else t=null,rl=a;t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=u)}else e=null,rl=u;return null!==e&&(e=function(){"undefined"!=typeof response_port&&(ul.rport=response_port.join(""))}(s)),null===e&&(rl=s),e}function Lt(){var e,n,t,l,r,i;return i=rl,e=xt(),null!==e?(n=D(),null!==n?(t=w(),null!==t?(l=D(),null!==l?(r=Ft(),null!==r?e=[e,n,t,l,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function xt(){var e,t;return t=rl,"sip"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"SIP"')),null===e&&(e=w()),null!==e&&(e=function(e,n){ul.protocol=n}(t,e)),null===e&&(rl=t),e}function Ft(){var e,t;return t=rl,"udp"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"UDP"')),null===e&&("tcp"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"TCP"')),null===e&&("tls"===n.substr(rl,3).toLowerCase()?(e=n.substr(rl,3),rl+=3):(e=null,0===il&&l('"TLS"')),null===e&&("sctp"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"SCTP"')),null===e&&(e=w())))),null!==e&&(e=function(e,n){ul.transport=n}(t,e)),null===e&&(rl=t),e}function kt(){var e,n,t,l,r;return l=rl,e=qt(),null!==e?(r=rl,n=q(),null!==n?(t=Bt(),null!==t?n=[n,t]:(n=null,rl=r)):(n=null,rl=r),n=null!==n?n:"",null!==n?e=[e,n]:(e=null,rl=l)):(e=null,rl=l),e}function qt(){var e,t;return t=rl,e=le(),null===e&&(e=ce(),null===e&&(e=oe())),null!==e&&(e=function(e){ul.host=n.substring(rl,e)}(t)),null===e&&(rl=t),e}function Bt(){var e,n,t,l,r,o,s;return o=rl,s=rl,e=i(),e=null!==e?e:"",null!==e?(n=i(),n=null!==n?n:"",null!==n?(t=i(),t=null!==t?t:"",null!==t?(l=i(),l=null!==l?l:"",null!==l?(r=i(),r=null!==r?r:"",null!==r?e=[e,n,t,l,r]:(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s),null!==e&&(e=function(e,n){ul.port=parseInt(n.join(""))}(o,e)),null===e&&(rl=o),e}function Ht(){var e,n,t,l,r;return l=rl,r=rl,e=i(),null!==e?(n=i(),n=null!==n?n:"",null!==n?(t=i(),t=null!==t?t:"",null!==t?e=[e,n,t]:(e=null,rl=r)):(e=null,rl=r)):(e=null,rl=r),null!==e&&(e=function(e,n){return parseInt(n.join(""))}(l,e)),null===e&&(rl=l),e}function Gt(){var e;return e=Zn()}function Vt(){var e,n,t,l;return l=rl,e=w(),null!==e?(n=C(),null!==n?(t=Wt(),null!==t?e=[e,n,t]:(e=null,rl=l)):(e=null,rl=l)):(e=null,rl=l),e}function Wt(){var e,n;for(e=[],n=S(),null===n&&(n=y(),null===n&&(n=_()));null!==n;)e.push(n),n=S(),null===n&&(n=y(),null===n&&(n=_()));return e}function zt(){var e,n;for(e=[],n=a();null!==n;)e.push(n),n=a();return e}function Yt(){var e,t,r,i;return i=rl,e=Kt(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=jt(),null!==r?e=[e,t,r]:(e=null,rl=i)):(e=null,rl=i)):(e=null,rl=i),e}function Kt(){var e,t;return t=rl,"stuns"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"stuns"')),null===e&&("stun"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"stun"'))),null!==e&&(e=function(e,n){ul.scheme=n}(t,e)),null===e&&(rl=t),e}function jt(){var e,t,r,i,o;return i=rl,e=$t(),null!==e?(o=rl,58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=de(),null!==r?t=[t,r]:(t=null,rl=o)):(t=null,rl=o),t=null!==t?t:"",null!==t?e=[e,t]:(e=null,rl=i)):(e=null,rl=i),e}function $t(){var e,n;return n=rl,e=ce(),null===e&&(e=oe(),null===e&&(e=je())),null!==e&&(e=function(e,n){ul.host=n}(n,e)),null===e&&(rl=n),e}function je(){var e,t,l;for(l=rl,e=[],t=Jt(),null===t&&(t=m(),null===t&&(t=Xt()));null!==t;)e.push(t),t=Jt(),null===t&&(t=m(),null===t&&(t=Xt()));return null!==e&&(e=function(e){return n.substring(rl,e)}(l)),null===e&&(rl=l),e}function Jt(){var e;return e=o(),null===e&&(e=i(),null===e&&(45===n.charCodeAt(rl)?(e="-",rl++):(e=null,0===il&&l('"-"')),null===e&&(46===n.charCodeAt(rl)?(e=".",rl++):(e=null,0===il&&l('"."')),null===e&&(95===n.charCodeAt(rl)?(e="_",rl++):(e=null,0===il&&l('"_"')),null===e&&(126===n.charCodeAt(rl)?(e="~",rl++):(e=null,0===il&&l('"~"'))))))),e}function Xt(){var e;return 33===n.charCodeAt(rl)?(e="!",rl++):(e=null,0===il&&l('"!"')),null===e&&(36===n.charCodeAt(rl)?(e="$",rl++):(e=null,0===il&&l('"$"')),null===e&&(38===n.charCodeAt(rl)?(e="&",rl++):(e=null,0===il&&l('"&"')),null===e&&(39===n.charCodeAt(rl)?(e="'",rl++):(e=null,0===il&&l('"\'"')),null===e&&(40===n.charCodeAt(rl)?(e="(",rl++):(e=null,0===il&&l('"("')),null===e&&(41===n.charCodeAt(rl)?(e=")",rl++):(e=null,0===il&&l('")"')),null===e&&(42===n.charCodeAt(rl)?(e="*",rl++):(e=null,0===il&&l('"*"')),null===e&&(43===n.charCodeAt(rl)?(e="+",rl++):(e=null,0===il&&l('"+"')),null===e&&(44===n.charCodeAt(rl)?(e=",",rl++):(e=null,0===il&&l('","')),null===e&&(59===n.charCodeAt(rl)?(e=";",rl++):(e=null,0===il&&l('";"')),null===e&&(61===n.charCodeAt(rl)?(e="=",rl++):(e=null,0===il&&l('"="')))))))))))),e}function Zt(){var e,t,r,i,o,s,u;return s=rl,e=Qt(),null!==e?(58===n.charCodeAt(rl)?(t=":",rl++):(t=null,0===il&&l('":"')),null!==t?(r=jt(),null!==r?(u=rl,"?transport="===n.substr(rl,11)?(i="?transport=",rl+=11):(i=null,0===il&&l('"?transport="')),null!==i?(o=Ft(),null!==o?i=[i,o]:(i=null,rl=u)):(i=null,rl=u),i=null!==i?i:"",null!==i?e=[e,t,r,i]:(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s)):(e=null,rl=s),e}function Qt(){var e,t;return t=rl,"turns"===n.substr(rl,5).toLowerCase()?(e=n.substr(rl,5),rl+=5):(e=null,0===il&&l('"turns"')),null===e&&("turn"===n.substr(rl,4).toLowerCase()?(e=n.substr(rl,4),rl+=4):(e=null,0===il&&l('"turn"'))),null!==e&&(e=function(e,n){ul.scheme=n}(t,e)),null===e&&(rl=t),e}function el(){var e,t,r,i,o;if(i=rl,o=rl,e=Ft(),null!==e){if("udp"===n.substr(rl,3).toLowerCase()?(t=n.substr(rl,3),rl+=3):(t=null,0===il&&l('"udp"')),null===t&&("tcp"===n.substr(rl,3).toLowerCase()?(t=n.substr(rl,3),rl+=3):(t=null,0===il&&l('"tcp"')),null===t))for(t=[],r=g();null!==r;)t.push(r),r=g();null!==t?e=[e,t]:(e=null,rl=o)}else e=null,rl=o;return null!==e&&(e=function(){ul.transport=transport}(i)),null===e&&(rl=i),e}function nl(e){e.sort();for(var n=null,t=[],l=0;l<e.length;l++)e[l]!==n&&(t.push(e[l]),n=e[l]);return t}function tl(){for(var e=1,t=1,l=!1,r=0;r<Math.max(rl,ol);r++){var i=n.charAt(r);"\n"===i?(l||e++,t=1,l=!1):"\r"===i||"\u2028"===i||"\u2029"===i?(e++,t=1,l=!0):(t++,l=!1)}return{line:e,column:t}}var ll={CRLF:r,DIGIT:i,ALPHA:o,HEXDIG:s,WSP:u,OCTET:a,DQUOTE:c,SP:h,HTAB:d,alphanum:f,reserved:p,unreserved:g,mark:v,escaped:m,LWS:_,SWS:T,HCOLON:C,TEXT_UTF8_TRIM:A,TEXT_UTF8char:S,UTF8_NONASCII:E,UTF8_CONT:y,LHEX:b,token:w,token_nodot:R,separators:I,word:P,STAR:N,SLASH:D,EQUAL:U,LPAREN:O,RPAREN:M,RAQUOT:L,LAQUOT:x,COMMA:F,SEMI:k,COLON:q,LDQUOT:B,RDQUOT:H,comment:G,ctext:V,quoted_string:W,quoted_string_clean:z,qdtext:Y,quoted_pair:K,SIP_URI_noparams:j,SIP_URI:$,uri_scheme:J,userinfo:X,user:Z,user_unreserved:Q,password:ee,hostport:ne,host:te,hostname:le,domainlabel:re,toplabel:ie,IPv6reference:oe,IPv6address:se,h16:ue,ls32:ae,IPv4address:ce,dec_octet:he,port:de,uri_parameters:fe,uri_parameter:pe,transport_param:ge,user_param:ve,method_param:me,ttl_param:_e,maddr_param:Te,lr_param:Ce,other_param:Ae,pname:Se,pvalue:Ee,paramchar:ye,param_unreserved:be,headers:we,header:Re,hname:Ie,hvalue:Pe,hnv_unreserved:Ne,Request_Response:De,Request_Line:Ue,Request_URI:Oe,absoluteURI:Me,hier_part:Le,net_path:xe,abs_path:Fe,opaque_part:ke,uric:qe,uric_no_slash:Be,path_segments:He,segment:Ge,param:Ve,pchar:We,scheme:ze,authority:Ye,srvr:Ke,reg_name:je,query:$e,SIP_Version:Je,INVITEm:Xe,ACKm:Ze,OPTIONSm:Qe,BYEm:en,CANCELm:nn,REGISTERm:tn,SUBSCRIBEm:ln,NOTIFYm:rn,Method:on,Status_Line:sn,Status_Code:un,extension_code:an,Reason_Phrase:cn,Allow_Events:hn,Call_ID:dn,Contact:fn,contact_param:pn,name_addr:gn,display_name:vn,contact_params:mn,c_p_q:_n,c_p_expires:Tn,delta_seconds:Cn,qvalue:An,generic_param:Sn,gen_value:En,Content_Disposition:yn,disp_type:bn,disp_param:wn,handling_param:Rn,Content_Encoding:In,Content_Length:Pn,Content_Type:Nn,media_type:Dn,m_type:Un,discrete_type:On,composite_type:Mn,extension_token:Ln,x_token:xn,m_subtype:Fn,m_parameter:kn,m_value:qn,CSeq:Bn,CSeq_value:Hn,Expires:Gn,Event:Vn,event_type:Wn,From:zn,from_param:Yn,tag_param:Kn,Max_Forwards:jn,Min_Expires:$n,Name_Addr_Header:Jn,Proxy_Authenticate:Xn,challenge:Zn,other_challenge:Qn,auth_param:et,digest_cln:nt,realm:tt,realm_value:lt,domain:rt,URI:it,nonce:ot,nonce_value:st,opaque:ut,stale:at,algorithm:ct,qop_options:ht,qop_value:dt,Proxy_Require:ft,Record_Route:pt,rec_route:gt,Require:vt,Route:mt,route_param:_t,Subscription_State:Tt,substate_value:Ct,subexp_params:At,event_reason_value:St,Subject:Et,Supported:yt,To:bt,to_param:wt,Via:Rt,via_parm:It,via_params:Pt,via_ttl:Nt,via_maddr:Dt,via_received:Ut,via_branch:Ot,response_port:Mt,sent_protocol:Lt,protocol_name:xt,transport:Ft,sent_by:kt,via_host:qt,via_port:Bt,ttl:Ht,WWW_Authenticate:Gt,extension_header:Vt,header_value:Wt,message_body:zt,stun_URI:Yt,stun_scheme:Kt,stun_host_port:jt,stun_host:$t,reg_name:je,stun_unreserved:Jt,sub_delims:Xt,turn_URI:Zt,turn_scheme:Qt,turn_transport:el};if(void 0!==t){if(void 0===ll[t])throw new Error("Invalid rule name: "+e(t)+".")}else t="CRLF";var rl=0,il=0,ol=0,sl=[],ul={},al=ll[t]();if(null===al||rl!==n.length){var cl=Math.max(rl,ol),hl=cl<n.length?n.charAt(cl):null,dl=tl();return new this.SyntaxError(nl(sl),hl,cl,dl.line,dl.column),-1}return ul},toSource:function(){return this._source}};return n.SyntaxError=function(n,t,l,r,i){function o(n,t){var l,r;switch(n.length){case 0:l="end of input";break;case 1:l=n[0];break;default:l=n.slice(0,n.length-1).join(", ")+" or "+n[n.length-1]}return r=t?e(t):"end of input","Expected "+l+" but "+r+" found."}this.name="SyntaxError",this.expected=n,this.found=t,this.message=o(n,t),this.offset=l,this.line=r,this.column=i},n.SyntaxError.prototype=Error.prototype,n}(),function(){var e;e=function(){function e(){h()}function n(e,n){var t={};Plivo.logDevel("recvExtraHeader");for(var l in n){var r=e.getHeader(l);Plivo.checkExtraHeader(l,r)&&(t[l]=r)}return t}var t,l,r="plivojs",i="phone.plivo.com",o=!1,s="plivo_webrtc_selfview",u="plivo_webrtc_remoteview",a=null,c=!1;e.prototype.init=function(){c=!0,Plivo.onReady(),Plivo.config.perm_on_click||Plivo.config.listen_mode||this._getLocalMedia()};var h=function(){var e=document.createElement("video");e.id=s,e.hidden=!0,e.autoplay=!0,e.muted=!0,e.width=0,e.height=0,document.body.appendChild(e);var n=document.createElement("video");n.id=u,n.hidden=!0,n.autoplay=!0,n.muted="Chrome"==BrowserDetect.browser&&25==BrowserDetect.version,n.width=0,n.height=0,document.body.appendChild(n)};e.prototype._getLocalMedia=function(){window.storedStream=null;var e=function(e){window.storedStream=e,Plivo.config.mask_page_on_perm&&Plivo.unmaskPage(),Plivo.onMediaPermission(!0),"Firefox"==BrowserDetect.browser&&(document.getElementById("plivo_webrtc_selfview").mozSrcObject=e,a=e)},n=function(){Plivo.config.mask_page_on_perm&&Plivo.unmaskPage(),Plivo.onMediaPermission(!1)};Plivo.config.mask_page_on_perm&&Plivo.maskThePage(),Plivo.onRequirePermission(),WebSDK.WebRTC.getUserMedia({audio:!0,video:!1},e,n)},e.prototype.login=function(e,n){if(!c)return Plivo.logDebug("error : plivo websdk is not ready yet"),!1;if(void 0===e||void 0===n||null===e||null===n)return Plivo.logDebug("username & password cant be null"),!1;if(e.length<=0||0>=n)return Plivo.logDebug("username & password length should be more than 0"),!1;var l={ws_servers:["wss://phone.plivo.com:5063"],register_expires:120,stun_servers:["stun:23.21.150.121:3478","stun:216.93.246.18:3478","stun:66.228.45.110:3478","stun:173.194.78.127:19302"],uri:e+"@"+i,password:n,trace_sip:!0};try{t=new WebSDK.UA(l)}catch(r){return Plivo.logDebug("failed to create UA"),!1}return t.on("connected",f),t.on("disconnected",p),t.on("registered",g),t.on("unregistered",m),t.on("registrationFailed",v),t.on("newRTCSession",C),t.start(),!0},e.prototype.logout=function(){return l?(Plivo.logDebug("logging out when there is active call. Terminate the call"),l.terminate(),!0):(t.unregister("all"),!0)},e.prototype.call=function(e,n){var r,i={};if(Plivo.gotEarlyMedia=!1,!c)return Plivo.logDebug("error : plivo websdk is not ready yet"),!1;if(!o)return Plivo.logDebug("error : you need to be logged in before make a call"),!1;if(void 0===e||null===e||e.length<=0)return Plivo.logDebug("destination address can't be null and it's lenght must be > 0"),!1;if(l)return Plivo.logDebug("Can't make another call while in call"),!1;n=n||{};var a=[];for(var h in n){var d=n[h];Plivo.checkExtraHeader(h,d)===!0?(a.push(h+": "+d),Plivo.logDevel("valid hdr = "+h+" -> "+d)):Plivo.logDebug("invalid hdr = "+h+" -> "+d)}r="sip:"!=e.substring(0,4)?"sip:"+e:e,{selfView:document.getElementById(s),remoteView:document.getElementById(u)},i.mediaConstraints={audio:!0,video:!1},i.eventHandlers={progress:A,failed:E,started:b,ended:w},i.extraHeaders=a,t.call(r,i);try{Plivo.onCalling()}catch(f){return Plivo.logDebug("Failed to execute Plivo.onCalling event handler"),!1}return!0},e.prototype.answer=function(){return Plivo.gotEarlyMedia=!1,l?(opts={mediaConstraints:{audio:!0,video:!1}},l.answer(opts),Plivo.conn.ringToneStop(),!0):(Plivo.logDebug("answer() failed : no incoming call"),!1)},e.prototype.hangup=function(){return l?(l.terminate(),Plivo.conn.rbToneStop(),!0):(Plivo.logDebug("hangup() failed:no call session exist"),!1)},e.prototype.reject=function(){if(!l)return Plivo.logDebug("reject() failed : no incoming call"),!1;var e={status_code:486,reason_phrase:"Busy Here"};return l.terminate(e),Plivo.conn.ringToneStop(),!0},e.prototype.send_dtmf=function(e){return void 0===e||null===e?(Plivo.logDebug("DTMF digit can't be null"),!1):l?(l.sendDTMF(e),Plivo.conn.dtmfTonePlay(e),!0):!1},e.prototype.mute=function(){if(!l)return Plivo.logDebug("there is no active call session"),!1;var e=P();if(e)for(var n=0;n<e.length;n++)e[n].enabled=!1;return!0},e.prototype.unmute=function(){if(!l)return Plivo.logDebug("There is no active call session"),!1;var e=P();if(e)for(var n=0;n<e.length;n++)e[n].enabled=!0;return!0};var d,f=function(){Plivo.logDevel("websocket connection established")},p=function(){Plivo.logDevel("websocket connection closed")},g=function(){o===!1&&(o=!0,Plivo.logDevel("onLogin"),Plivo.onLogin())},v=function(){o=!1,Plivo.logDebug("Login failed"),Plivo.onLoginFailed()},m=function(){Plivo.logDevel("_onLogout"),o=!1,Plivo.conn.rbToneStop(),Plivo.conn.ringToneStop(),Plivo.onLogout()},_=function(e){d="incoming",l.on("progress",S),l.on("failed",E),l.on("started",b),l.on("ended",w);var t=e.data.request,r=t.headers,i=n(t,r);Plivo.conn.ringTonePlay();var o=l.remote_identity.uri.toString();Plivo.onIncomingCall(o.substring(4,o.indexOf("@"))+"@phone.plivo.com",i)},T=function(){d="outgoing"},C=function(e){if(Plivo.logDevel(r+":_onNewSession"),l){Plivo.logDebug("Multiple calls detected. Can't support it yet. Reject it");var n=e.data.session;return opts={status_code:408,reason_phrase:"Busy Here"},void n.terminate(opts)}l=e.data.session,"remote"==e.data.originator?_(e):T(e)},A=function(){Plivo.logDevel(r+"_onOutCallProgress"),Plivo.conn.rbTonePlay(),Plivo.onCallRemoteRinging()},S=function(){Plivo.logDevel(r+"_onIncCallProgress")},E=function(e){Plivo.gotEarlyMedia=!1,Plivo.logDevel(r+":call failed:"+e.data.cause),"Chrome"==BrowserDetect.browser&&25==BrowserDetect.version&&(document.getElementById(u).muted=!0),l=null,e.data.cause==WebSDK.C.causes.CANCELED&&"incoming"==d?(Plivo.conn.ringToneStop(),Plivo.onIncomingCallCanceled()):(Plivo.conn.rbToneStop(),Plivo.onCallFailed(e.data.cause)),d=null},y=function(){var e=document.getElementById(u);l.getRemoteStreams().length>0&&(e.src=window.URL.createObjectURL(l.getRemoteStreams()[0])),25==BrowserDetect.version&&(e.muted=!1)},b=function(){var e=document.getElementById(s);document.getElementById(u),Plivo.logDevel(r+":onCallStarted"),"Chrome"==BrowserDetect.browser&&(l.getLocalStreams().length>0&&(e.src=window.URL.createObjectURL(l.getLocalStreams()[0])),y()),Plivo.conn.rbToneStop(),Plivo.conn.ringToneStop(),"undefined"!=typeof PlivoDebug&&null!==PlivoDebug&&PlivoDebug.setPC(l.rtcMediaHandler.peerConnection),Plivo.onCallAnswered()},w=function(){Plivo.gotEarlyMedia=!1,Plivo.logDevel("onCallEnded"),"Chrome"==BrowserDetect.browser&&25==BrowserDetect.version&&(document.getElementById(u).muted=!0),Plivo.config.listen_mode||Plivo.conn.unmute(),Plivo.conn.ringToneStop(),l=null,d=null,Plivo.onCallTerminated()},R=function(e){try{document.getElementById(e).play()}catch(n){Plivo.logDebug("failed to play audio:"+n)}},I=function(e){try{document.getElementById(e).pause()}catch(n){Plivo.logDebug("failed to stop audio:"+n)}};e.prototype.ringTonePlay=function(){Plivo.ringToneFlag!==!1&&R("plivo_ringtone")},e.prototype.ringToneStop=function(){Plivo.ringToneFlag!==!1&&I("plivo_ringtone")},e.prototype.rbTonePlay=function(){Plivo.ringToneBackFlag!==!1&&R("plivo_ringbacktone")},e.prototype.rbToneStop=function(){Plivo.ringToneBackFlag!==!1&&I("plivo_ringbacktone")},e.prototype.dtmfTonePlay=function(e){Plivo.getDtmfToneFlag(e)!==!1&&(elem_name=null,elem_name="*"==e?"dtmfstar":"#"==e?"dtmfpound":"dtmf"+e,R(elem_name))};var P=function(){var e=null;return"Chrome"==BrowserDetect.browser?e=l.getLocalStreams()[0].audioTracks||l.getLocalStreams()[0].getAudioTracks():"Firefox"==BrowserDetect.browser&&(e=a.getAudioTracks()),e};return e}(),window.plivojs=e}.call(this);